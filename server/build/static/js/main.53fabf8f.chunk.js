(this.webpackJsonpjamnsync=this.webpackJsonpjamnsync||[]).push([[0],{140:function(e,t,r){},145:function(e,t,r){},150:function(e,t,r){},152:function(e,t,r){},153:function(e,t,r){},154:function(e,t,r){},155:function(e,t,r){},186:function(e,t,r){},187:function(e,t,r){"use strict";r.r(t);var a=r(1),n=r(0),s=r(6),o=r.n(s),i=r(14),c=r(15),l=r(21),u=r(20),p=r(49),d=r(17),h=r(32),m=r(74),g=r(5),j=r.n(g),b=r(9);var f=function(e){return Object(a.jsx)("div",{children:Object(a.jsx)(m.GoogleLogin,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Login",onSuccess:function(t){!function(e){var t=1e3*(e.tokenObj.expires_in||3300),r=function(){var a=Object(b.a)(j.a.mark((function a(){var n;return j.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.reloadAuthResponse();case 2:n=a.sent,t=1e3*(n.expires_in||3300),console.log("newAuthRes:",n),localStorage.setItem("authToken",n.id_token),setTimeout(r,t);case 7:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();setTimeout(r,t)}(t),e.onSuccessfulLogin(t)},onFailure:function(e){console.log("Attempt to login failed. Error:",e),alert("Login error: "+e.error+". ")},cookiePolicy:"single_host_origin",style:{marginTop:"100px"},isSignedIn:!0})})};var k=function(e){return Object(a.jsx)("div",{children:Object(a.jsx)(m.GoogleLogout,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:function(){e.onSuccessfulLogout()}})})},O=r(16),x=r(31),y=(r(140),r(76)),v=r.n(y),T=(r(102),r(7)),S=r(50),w=(r(82),r(210)),_=r(216),C=r(214),R=r(217),L=r(56),G=r.n(L),I=r(88),P=r.n(I),M=r(89),D=r.n(M),U=r(122),E=r.n(U),A=r(123),F=r.n(A),N="Realign Take",q="Rename Part",B="Delete Part",K="+ Upload File",V=[B,N,q,K],z=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(e){var a;if(Object(i.a)(this,r),(a=t.call(this,e)).stop=function(){a.audioFile.currentTime=0,a.audioFile.pause(),a.setState({playing:!1})},a.changeVolume=function(e){var t=e;a.audioFile.volume=a.props.masterVolume/100*t,a.setState({volume:t})},a.seek=function(e){a.audioFile.currentTime=e,a.audioFile.pause(),a.state.playing&&a.audioFile.play()},a.fastForward=function(){a.audioFile.pause();var e=a.audioFile.duration,t=a.audioFile.currentTime,r=t+5;if(r>=e)return a.audioFile.currentTime=0,void a.audioFile.pause();console.log("ff: "+t+" -> "+r),a.audioFile.currentTime=r,a.state.playing&&a.audioFile.play()},a.rewind=function(){a.audioFile.pause();var e=a.audioFile.currentTime,t=e-5;t<=0&&(t=0),console.log("rewind: "+e+" -> "+t),a.audioFile.currentTime=t,a.state.playing&&a.audioFile.play()},a.mute=function(){a.props.updateMutedTracks(a.props.trackId),a.audioFile.muted=!a.state.muted,a.setState({muted:!a.state.muted})},a.solo=function(){a.props.updateSoloTracks(a.props.trackId),a.state.soloing?a.setState({soloing:!1}):(a.audioFile.muted=!1,a.setState({soloing:!0,muted:!1}))},a.selectToRecord=function(){var e=a.state.selected?null:a.props.trackId;a.props.setSelectedTrack(e),a.setState({selected:!a.state.selected})},a._onSelect=function(e){console.log("Selected "+e.label),a.audioFile.currentTime=0,a.audioFile.pause();var t=a.props.takes[e.value].s3_info;a.setState({playing:!1,selectedTake:e.value,s3URL:t}),a.audioFile=document.getElementById("audio-file-".concat(a.props.trackId)),a.audioFile.onloadedmetadata=function(){var e=a.audioFile.duration;console.log("track duration",e),a.props.updateTrackTimesInMillis(a.props.trackId,e)}},a.clickThreeDotsMenu=function(e){a.setState({threeDotsAnchorElement:e.currentTarget})},a.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===K?document.getElementById("file-upload-".concat(a.props.trackId)).click():t===q?a.props.renameTrack(a.props.trackId,a.props.trackName):t===B?a.props.deleteTrack(a.props.trackId,a.props.trackName):t===N&&a.props.realignTake(a.props.trackId,a.state.s3URL),a.setState({threeDotsAnchorElement:null})},a.state={selected:!1,playing:!1,muted:!1,s3URL:null,selectedTake:null,latestTake:0,soloing:!1,volume:84.95,threeDotsAnchorElement:null,claimedBy:null},a.audioFile=null,0!==Object.keys(e.takes).length){var n=Object.keys(e.takes).pop(),s=e.takes[n].s3_info;s&&(a.state.s3URL=s,a.state.selectedTake=n,a.audioFile=document.getElementById("audio-file-".concat(a.props.trackId)))}return a.deleteTake=a.deleteTake.bind(Object(O.a)(a)),a}return Object(c.a)(r,[{key:"componentDidMount",value:function(){var e=this;if(0!==Object.keys(this.props.takes).length){var t=Object.keys(this.props.takes).pop(),r=this.props.takes[t].s3_info;r&&(this.setState({s3URL:r,selectedTake:t,latestTake:t}),this.audioFile=document.getElementById("audio-file-".concat(this.props.trackId)),this.audioFile.onloadedmetadata=function(){var t=e.audioFile.duration;console.log("track duration",t),e.props.updateTrackTimesInMillis(e.props.trackId,t)})}else this.setState({selectedTake:null,s3URL:null,latestTake:0})}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.state.s3URL&&null===this.audioFile?(this.audioFile=document.getElementById("audio-file-".concat(this.props.trackId)),this.audioFile.onloadedmetadata=function(){var e=t.audioFile.duration;console.log("track duration",e),t.props.updateTrackTimesInMillis(t.props.trackId,e)}):null===this.state.s3URL&&null!==this.audioFile&&(this.audioFile=null,console.log("track duration is 0"),this.props.updateTrackTimesInMillis(this.props.trackId,0)),this.state.selected&&this.props.selectedTrackId!==this.props.trackId&&this.setState({selected:!1}),e.claimedBy!==this.props.claimedBy&&this.setState({claimedBy:this.props.claimedBy}),null!==this.state.selectedTake&&this.state.latestTake===Object.keys(this.props.takes).pop()||0===Object.keys(this.props.takes).length)0===Object.keys(this.props.takes).length&&this.state.s3URL&&this.setState({selectedTake:null,s3URL:null,latestTake:0});else{var r=Object.keys(this.props.takes).pop(),a=this.props.takes[r].s3_info;a&&this.setState({latestTake:r,selectedTake:r,s3URL:a})}this.props.masterPlay&&this.audioFile&&!this.state.playing&&(!this.state.selected||this.state.selected&&!this.props.masterRecord)?(console.log("[TRACK: ".concat(this.props.trackName,"] playing: ").concat(this.state.s3URL)),this.audioFile.currentTime=0,this.audioFile.play(),this.setState({playing:!0})):this.props.masterStop&&this.audioFile&&this.state.playing&&(this.audioFile.pause(),this.setState({playing:!1})),this.state.soloing||0===this.props.soloTracks.length||this.state.muted||!this.state.s3URL?0===this.props.soloTracks.length&&this.state.muted&&this.state.s3URL&&0!==e.soloTracks.length&&(this.audioFile.muted=!1,this.setState({muted:!1})):(this.audioFile.muted=!0,this.setState({muted:!0})),this.state.s3URL&&e.masterVolume!==this.props.masterVolume&&(this.audioFile.volume=Math.min(1,this.props.masterVolume))}},{key:"componentWillUnmount",value:function(){this.audioFile&&this.audioFile.pause()}},{key:"deleteTake",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,r,a,n,s,o,i,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting take"),t=this.state.selectedTake,r=this.props.takes[t],a=new Date(r.date_uploaded),n=a.toLocaleString("en-US"),s="Take ".concat(t," - ").concat(n),e.next=8,Object(T.b)('Are you sure you want to delete "'.concat(s,'"?'),"Delete Take");case 8:if(!e.sent){e.next=15;break}return this.audioFile&&(this.audioFile.currentTime=0,this.audioFile.pause()),e.next=13,this.props.deleteTake(this.props.trackId,t,r.id);case 13:o=null,Object.keys(this.props.takes).length>1?((i=Object.keys(this.props.takes)).splice(i.indexOf(t),1),o=Math.max.apply(Math,i),c=this.props.takes[o].s3_info,this.setState({playing:!1,selectedTake:o,s3URL:c,latestTake:o})):(console.log("unsetting audio file"),this.setState({playing:!1,selectedTake:o,s3URL:null,latestTake:0}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t=this,r={value:this.state.selectedTake},n=Object.keys(this.props.takes).reduce((function(e,a){if(parseInt(a)<=parseInt(t.state.latestTake)){var n=t.props.takes[a].date_uploaded,s=new Date(n).toLocaleString("en-US");a===t.state.selectedTake&&(r.label="Take ".concat(a," - ").concat(s)),e.push({value:a,label:"Take ".concat(a," - ").concat(s)})}return e}),[]).reverse();return e=null!==this.state.claimedBy?"Selected by ".concat(this.state.claimedBy):this.state.selected?"Unselect":"Select to Record",Object(a.jsxs)("div",{style:{marginLeft:"5px"},children:[Object(a.jsx)("hr",{}),Object(a.jsxs)("div",{style:this.state.selected?{backgroundColor:"#eee",padding:"1px 12px",borderLeft:"4px solid #2153c9",marginBottom:"15px",fontWeight:"bold"}:null!==this.state.claimedBy?{backgroundColor:"#f6f6f6",color:"#a8a8a8",padding:"1px 12px",borderLeft:"4px solid #d1e0f8",marginBottom:"15px"}:{marginBottom:"17px"},children:[Object(a.jsxs)("div",{style:{display:"inline-block"},children:["Part: ",this.props.trackName," "]}),Object(a.jsx)("button",{title:"Select/unselect track for recording",onClick:this.selectToRecord,style:null===this.state.claimedBy?{marginLeft:"10px",height:"25px",cursor:"pointer"}:{marginLeft:"10px",height:"25px"},disabled:null!==this.state.claimedBy,children:e}),Object(a.jsx)(w.a,{"aria-label":"more","aria-controls":"track-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"2px"},children:Object(a.jsx)(G.a,{})}),Object(a.jsx)("input",{type:"file",id:"file-upload-".concat(this.props.trackId),hidden:!0,onChange:function(e){t.props.handleFileUpload(e.target.files,t.props.trackId)}}),Object(a.jsx)(C.a,{id:"track-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:V.map((function(e){return Object(a.jsx)(R.a,{onClick:t.closeThreeDotsMenu,children:e},e)}))})]}),this.state.s3URL&&Object.keys(this.props.takes).length>0&&Object(a.jsxs)("div",{style:{display:"flex",marginBottom:"10px"},children:[Object(a.jsx)("div",{style:{marginTop:"-13px"},children:Object(a.jsx)(_.a,{title:"Solo",arrow:!0,children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Solo this track",onClick:this.solo,children:this.state.soloing?Object(a.jsx)(P.a,{style:{fontSize:20},color:"secondary"}):Object(a.jsx)(P.a,{style:{fontSize:20}})})})}),Object(a.jsx)("div",{style:{marginTop:"-14px"},children:Object(a.jsx)(_.a,{title:"Mute",arrow:!0,children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Mute this track",onClick:this.mute,children:this.state.muted?Object(a.jsx)(D.a,{style:{fontSize:20},color:"secondary"}):Object(a.jsx)(D.a,{style:{fontSize:20}})})})}),Object(a.jsx)("div",{style:{width:"55px"},children:Object(a.jsx)(S.a,{min:0,max:100,defaultValue:100,onChange:this.changeVolume})}),Object(a.jsx)("audio",{id:"audio-file-".concat(this.props.trackId),src:"".concat(this.state.s3URL,"?cacheblock=true"),preload:"auto",autobuffer:"true"}),Object(a.jsx)("div",{style:{flex:"0 1 300px",marginLeft:"25px",marginTop:"-8px"},children:Object(a.jsx)(v.a,{options:n,onChange:this._onSelect,value:r,placeholder:"Select an option"})}),Object(a.jsx)("div",{style:{flex:"0 0 20px",marginLeft:"10px",marginTop:"-14px"},children:Object(a.jsx)("form",{method:"get",action:"".concat(this.state.s3URL,"?cacheblock=true"),children:Object(a.jsx)(_.a,{title:"Download take",arrow:!0,children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Download this take",type:"submit",children:Object(a.jsx)(E.a,{style:{fontSize:23}})})})})}),Object(a.jsx)("div",{style:{marginTop:"-15px"},children:Object(a.jsx)(_.a,{title:"Delete take",arrow:!0,children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Delete this take",onClick:this.deleteTake,disabled:this.props.masterPlay,children:Object(a.jsx)(F.a,{style:{fontSize:22}})})})})]})]})}}]),r}(n.Component),H=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"render",value:function(){return Object(a.jsxs)("div",{style:{display:"flex",marginBottom:"-8px"},children:[Object(a.jsx)("img",{style:{marginLeft:"10px",marginRight:"5px",marginTop:"10px"},src:"images/daw/loading.gif",alt:"loading",width:"32",height:"32"}),Object(a.jsx)("p",{children:" ".concat(this.props.text)})]})}}]),r}(n.Component),W=r(124),J=r(13),Y=(r(145),r(90)),$=r.n(Y),Q=r(91),X=r.n(Q),Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.sampleRate,a=void 0===r?44100:r;Object(i.a)(this,e),this._sampleRate=a,this._context=this._createContext()}return Object(c.a)(e,[{key:"_createContext",value:function(){return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,console.log("setting audio context to "+this._sampleRate),new AudioContext({sampleRate:this._sampleRate})}},{key:"fetchAudio",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,r,a,n,s=this,o=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=o.length,r=new Array(t),a=0;a<t;a++)r[a]=o[a];return n=r.map(function(){var e=Object(b.a)(j.a.mark((function e(t){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof File)){e.next=6;break}return e.next=3,t.arrayBuffer();case 3:r=e.sent,e.next=9;break;case 6:return e.next=8,fetch(t).then((function(e){return e.arrayBuffer()}));case 8:r=e.sent;case 9:return console.log("decoding audio context with "+s._context.sampleRate),e.next=12,s._context.decodeAudioData(r);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"mergeAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._sampleRate*this._maxDuration(e),this._sampleRate);return e.forEach((function(e){for(var r=0;r<e.numberOfChannels;r+=1){for(var a=t.getChannelData(r),n=e.getChannelData(r),s=e.getChannelData(r).length-1;s>=0;s-=1)a[s]+=n[s];t.getChannelData(r).set(a)}})),t}},{key:"concatAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._totalLength(e),this._sampleRate),r=0;return e.forEach((function(e){for(var a=0;a<e.numberOfChannels;a+=1)t.getChannelData(a).set(e.getChannelData(a),r);r+=e.length})),t}},{key:"padAudio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===r)return e;if(t<0)throw new Error('Crunker: Parameter "padStart" in padAudio must be positive');if(r<0)throw new Error('Crunker: Parameter "seconds" in padAudio must be positive');for(var a=this._context.createBuffer(e.numberOfChannels,e.length+r*e.sampleRate,e.sampleRate),n=0;n<e.numberOfChannels;n+=1){var s=e.getChannelData(n);a.getChannelData(n).set(s.subarray(0,t*e.sampleRate+1),0),a.getChannelData(n).set(s.subarray(t*e.sampleRate+2,a.length+1),(t+r)*e.sampleRate)}return a}},{key:"play",value:function(e){var t=this._context.createBufferSource();return t.buffer=e,t.connect(this._context.destination),t.start(),t}},{key:"export",value:function(e,t){var r=t||"audio/mp3",a=this._interleave(e),n=this._writeHeaders(a),s=new Blob([n],{type:r});return{blob:s,url:this._renderURL(s),element:this._renderAudioElement(s,r)}}},{key:"download",value:function(e,t){var r=t||"crunker",a=document.createElement("a");return a.style="display: none",a.href=this._renderURL(e),a.download="".concat(r,".").concat(e.type.split("/")[1]),a.click(),a}},{key:"notSupported",value:function(e){return!this._isSupported()&&e()}},{key:"close",value:function(){return this._context.close(),this}},{key:"_maxDuration",value:function(e){return Math.max.apply(Math,e.map((function(e){return e.duration})))}},{key:"_maxNumberOfChannels",value:function(e){return Math.max.apply(Math,e.map((function(e){return e.numberOfChannels})))}},{key:"_totalLength",value:function(e){return e.map((function(e){return e.length})).reduce((function(e,t){return e+t}),0)}},{key:"_isSupported",value:function(){return"AudioContext"in window}},{key:"_writeHeaders",value:function(e){var t=new ArrayBuffer(44+2*e.length),r=new DataView(t);return this._writeString(r,0,"RIFF"),r.setUint32(4,32+2*e.length,!0),this._writeString(r,8,"WAVE"),this._writeString(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,2,!0),r.setUint32(24,this._sampleRate,!0),r.setUint32(28,4*this._sampleRate,!0),r.setUint16(32,4,!0),r.setUint16(34,16,!0),this._writeString(r,36,"data"),r.setUint32(40,2*e.length,!0),this._floatTo16BitPCM(r,e,44)}},{key:"_floatTo16BitPCM",value:function(e,t,r){for(var a=0;a<t.length;a++,r+=2){var n=Math.max(-1,Math.min(1,t[a]));e.setInt16(r,n<0?32768*n:32767*n,!0)}return e}},{key:"_writeString",value:function(e,t,r){for(var a=0;a<r.length;a++)e.setUint8(t+a,r.charCodeAt(a))}},{key:"_interleave",value:function(e){for(var t=e.getChannelData(0),r=2*t.length,a=new Float32Array(r),n=0,s=0;n<r;)a[n++]=t[s],a[n++]=t[s],s++;return a}},{key:"_renderAudioElement",value:function(e,t){var r=document.createElement("audio");return r.controls="controls",r.type=t,r.src=this._renderURL(e),r}},{key:"_renderURL",value:function(e){return(window.URL||window.webkitURL).createObjectURL(e)}}]),e}(),ee=r(92),te=r.n(ee),re=r(93),ae=r.n(re);function ne(e){var t=Object(T.h)(),r=Object(n.useState)(!1),s=Object(J.a)(r,2),o=s[0],i=s[1],c=Object(n.useState)(null),l=Object(J.a)(c,2),u=l[0],p=l[1],d=Object(n.useState)(null),h=Object(J.a)(d,2),m=h[0],g=h[1],f=Object(n.useState)(null),k=Object(J.a)(f,2),O=k[0],y=k[1],v=Object(n.useState)(null),w=Object(J.a)(v,2),_=w[0],C=w[1],R=Object(n.useState)(!1),L=Object(J.a)(R,2),G=L[0],I=L[1],P=Object(n.useState)(0),M=Object(J.a)(P,2),D=M[0],U=M[1],E=Object(n.useState)(0),A=Object(J.a)(E,2),F=A[0],N=A[1],q=Object(n.useCallback)((function(e,t){console.log("stopped:",t.x);var r=12.5053*t.x+7.3617;console.log(r),U(t.x),N(r)}),[]);return Object(n.useEffect)((function(){y($.a.create({container:"#bg_waveform",waveColor:"#D9DCFF",progressColor:"#4353ff",cursorColor:"#4353ff",cursorWidth:1,height:200,width:1e3,interact:!1,hideScrollbar:!0})),C($.a.create({container:"#rec_waveform",waveColor:"#D9DCFF",progressColor:"#4353ff",cursorColor:"#4353ff",cursorWidth:1,height:200,width:1e3,interact:!1,hideScrollbar:!0}))}),[]),Object(n.useEffect)((function(){O&&_&&t&&!t.isOpen&&(O.stop(),_.stop())}),[O,_,G,t]),Object(n.useEffect)((function(){if(O&&_&&!G){var t=new Z,r=e.backingTrackURLs;r.length>1?(console.log("using crunker to combine recordings"),t.fetchAudio.apply(t,Object(x.a)(r)).then((function(e){return console.log(e),t.mergeAudio(e)})).then((function(e){return console.log(e),t.export(e,"audio/mp3")})).then((function(t){O.load(t.url),_.load(e.recordedURL),O.setVolume(.3),_.setVolume(.3),O.zoom(80),_.zoom(80),I(!0)}))):(console.log("using single track as backing track"),O.load(r[0]),_.load(e.recordedURL),O.setVolume(.3),_.setVolume(.4),O.zoom(80),_.zoom(80),I(!0))}}),[O,_,G,e]),Object(a.jsx)("div",{className:"outerDiv",children:Object(a.jsxs)("div",{children:[G&&Object(a.jsx)(X.a,{axis:"x",bounds:{left:-285,right:285},children:Object(a.jsx)("div",{className:"ruler"})}),Object(a.jsxs)(T.e,{children:[G?Object(a.jsx)("p",{children:'Recordings in the browser are sometimes delayed. Click "play" to check for delays, and drag your recording left/right to align it with the backing tracks. Move the ruler to help you find and align peaks between tracks!'}):Object(a.jsx)("div",{style:{marginBottom:"10px"},children:Object(a.jsx)(H,{text:"Preparing alignment tool..."})}),Object(a.jsxs)("div",{style:{marginBottom:"5px"},children:[Object(a.jsx)("b",{children:"Backing Tracks"}),G&&O&&Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)(te.a,{style:{fontSize:20,marginLeft:"125px",marginTop:"-18px"},color:"action"}),Object(a.jsx)("div",{style:{width:"55px",marginLeft:"5px",marginTop:"-15px"},children:Object(a.jsx)(S.a,{min:0,max:100,defaultValue:30,onChange:function(e){O.setVolume(e/100)}})}),Object(a.jsx)(ae.a,{style:{fontSize:20,marginLeft:"12px",marginTop:"-18px"},color:"action"})]})]}),Object(a.jsx)("div",{id:"bg_timeline"}),Object(a.jsx)("div",{className:"backingTrack",id:"bg_waveform"}),Object(a.jsxs)("div",{style:{marginBottom:"5px"},children:[Object(a.jsx)("b",{children:"Recording"}),G&&_&&Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)(te.a,{style:{fontSize:20,marginLeft:"87px",marginTop:"-18px"},color:"action"}),Object(a.jsx)("div",{style:{width:"55px",marginTop:"-15px"},children:Object(a.jsx)(S.a,{min:0,max:100,defaultValue:40,onChange:function(e){_.setVolume(e/100)}})}),Object(a.jsx)(ae.a,{style:{fontSize:20,marginLeft:"10px",marginTop:"-18px"},color:"action"})]})]}),Object(a.jsx)(X.a,{axis:"x",onStop:q,children:Object(a.jsx)("div",{className:"recordedTrack",id:"rec_waveform",style:e.hasCountdownLatency?{marginLeft:"-240px"}:{}})})]}),Object(a.jsxs)(T.f,{children:[Object(a.jsx)(T.d,{onClick:Object(b.a)(j.a.mark((function r(){return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return O.stop(),_.stop(),clearTimeout(u),r.next=5,Object(T.b)("Are you sure you want to scrap?",e.hasCountdownLatency?"Scrap Recording":"Scrap Realignment");case 5:r.sent&&(console.log("scrapping recording/realignment"),t.close("scrap"));case 7:case"end":return r.stop()}}),r)}))),type:"danger",children:e.hasCountdownLatency?"Scrap Recording":"Scrap Realignment"}),Object(a.jsx)(T.d,{onClick:function(){if(o)O.pause(),_.pause(),clearTimeout(u),clearTimeout(m);else if(console.log("offset:",D),O.params.scrollParent=!1,_.params.scrollParent=!1,O.seekTo(0),e.hasCountdownLatency?_.seekAndCenter(3/_.getDuration()):_.seekTo(0),D>0)console.log("[recorded early]: user wants to playback later"),console.log(F),p(setTimeout((function(){i(!1)}),7e3)),O.play(null,7),g(setTimeout((function(){e.hasCountdownLatency?_.play(3,10-F/1e3):_.play(0,7-F/1e3)}),F));else if(D<0){console.log("[recorded late]: user wants to playback earlier");var t=-F;console.log(t),p(setTimeout((function(){i(!1)}),7e3)),O.play(null,7),e.hasCountdownLatency?_.play(3+t/1e3,10+t/1e3):_.play(t/1e3,7+t/1e3)}else p(setTimeout((function(){i(!1)}),7e3)),O.play(null,7),e.hasCountdownLatency?_.play(3,10):_.play(null,7);i(!o)},children:o?"Stop":"Play"}),Object(a.jsx)(T.d,{onClick:function(){O.stop(),_.stop(),clearTimeout(u),console.log("returning value:",F),t.close(Math.round(F))},children:"Submit"})]})]})})}var se=r(95),oe=r.n(se),ie=r(126),ce=r.n(ie),le=r(94),ue=r.n(le),pe=r(125),de=r.n(pe),he=window.AudioContext||window.webkitAudioContext,me=window.WebAudioRecorder,ge=new de.a,je=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.call(this)).beginGroupPlayListener=function(){console.log("[SOCKET.IO] receiving begin group play"),e.toggleMasterPlay(),e.setState({requestingGroupPlayback:!1,preparedGroupAction:null,withGroup:!0})},e.beginGroupStopListener=function(){var t=Object(b.a)(j.a.mark((function t(r){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("[SOCKET.IO] receiving begin group stop for "+e.props.projectName),e.state.receivedImmediateStop){t.next=20;break}if("string"!==typeof r.stopped_by||r.stopped_by===e.username){t.next=16;break}if(!e.state.masterRecord){t.next=10;break}return t.next=6,Object(T.a)("".concat(r.stopped_by," wants to stop! Press OK when you're done recording."),"Group record stopped");case 6:e.setState({receivedImmediateStop:!0,withGroup:!1}),e.toggleMasterStop(),t.next=14;break;case 10:return e.setState({receivedImmediateStop:!0,withGroup:!1}),e.toggleMasterStop(),t.next=14,Object(T.a)("".concat(r.stopped_by," stopped!"),"Group rehearsal stopped");case 14:t.next=18;break;case 16:e.setState({receivedImmediateStop:!0,withGroup:!1}),e.toggleMasterStop();case 18:t.next=34;break;case 20:if(console.log("begin group stop listener being called again..?"),"string"!==typeof r.stopped_by||r.stopped_by===e.username){t.next=33;break}if(!e.state.masterRecord){t.next=28;break}return t.next=25,Object(T.a)("".concat(r.stopped_by," wants to stop! Press OK when you're done recording."),"Group record stopped");case 25:e.toggleMasterStop(),t.next=31;break;case 28:return e.toggleMasterStop(),t.next=31,Object(T.a)("".concat(r.stopped_by," stopped!!"),"Group rehearsal stopped");case 31:t.next=34;break;case 33:e.toggleMasterStop();case 34:e.setState({requestingGroupRecord:!1,requestingGroupPlayback:!1,numGroupMembersPrepared:0,preparedGroupAction:null});case 35:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.beginGroupRecordListener=function(){console.log("[SOCKET.IO] receiving begin group record"),e.toggleMasterRecord(),e.setState({requestingGroupRecord:!1,preparedGroupAction:null,withGroup:!0})},e.updateNumPreparedListener=function(t){console.log("[SOCKET.IO] updating number of prepared group members",t),0===t.num_prepared?e.setState({numGroupMembersPrepared:t.num_prepared,preparedGroupAction:null}):e.setState({numGroupMembersPrepared:t.num_prepared,preparedGroupAction:t.action})},e.notifyWaitingGroupMember=function(){var t=Object(b.a)(j.a.mark((function t(r){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("[SOCKET.IO] received request from group member "+r.requester+" to request "+r.action+" | num prepared: "+r.num_prepared),!("play"===r.action&&e.state.requestingGroupPlayback||"record"===r.action&&e.state.requestingGroupRecord||r.num_prepared>1)){t.next=4;break}return console.log("[SOCKET.IO] no need to notify me, already ready to go"),t.abrupt("return");case 4:if(null!==r.requester){t.next=8;break}return console.log("disconnected client attempting to start session"),alert('A group member tried to initiate "group '.concat(r.action,'" but their connection is faulty. Please ask them to refresh their page.')),t.abrupt("return");case 8:return t.next=10,Object(T.b)("".concat(r.requester," wants to group ").concat(r.action,". Ready to join?"),"Incoming Request","Yes","No");case 10:t.sent?(console.log("[SOCKET.IO] ready to join for ".concat(r.action,"!")),"play"===r.action?e.requestGroupPlay():e.requestGroupRecord()):(console.log("[SOCKET.IO] not ready to join for ".concat(r.action,"...")),e.setState({preparedGroupAction:r.action}));case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.updateClaimedTracksListener=function(t){console.log("[SOCKET.IO] updating claimed tracks",t);var r=Object.assign({},e.state.claimedTrackIds);null===t.track_id?delete r[t.claimed_by]:r[t.claimed_by]=t.track_id,e.setState({claimedTrackIds:r})},e.retrieveCurrentClaimedTracksListener=function(t){console.log("[SOCKET.IO] received request to catch up new member: ",e.state.claimedTrackIds);var r=Object.assign({},e.state.claimedTrackIds);r[e.username]=e.state.selectedTrackId,t(r)},e.resetGroupControls=function(){console.log("resetting group controls"),e.setState({requestingGroupRecord:!1,requestingGroupPlayback:!1,receivedImmediateStop:!1,numGroupMembersPrepared:0,preparedGroupAction:null,withGroup:!1})},e.createTrack=function(){e.props.createTrack()},e.renameTrack=function(t,r){e.props.renameTrack(t,r)},e.deleteTrack=function(t,r){e.props.deleteTrack(t,r)&&e.setState({selectedTrackId:null})},e.createTake=function(t,r,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.props.createTake(t,r,a,n)},e.deleteTake=function(t,r,a){e.props.deleteTake(t,r,a)},e.toggleMasterPlay=function(){console.log("> master play"),e.state.masterPlay||e.setState((function(t){var r=Date.now()-e.state.runningTime;return e.timer=setInterval((function(){e.setState({runningTime:Date.now()-r})})),{masterPlay:!0}}))},e.startMicrophone=function(){e.audioContext=new he,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){console.log("[RECORDING] getUserMedia() success, stream created, initializing WebAudioRecorder..."),e.gumStream=t,e.input=e.audioContext.createMediaStreamSource(t),e.recorder=new me(e.input,{workerDir:"js/",encoding:"mp3",numChannels:2}),e.recorder.setOptions({timeLimit:600,encodeAfterRecord:!0,mp3:{bitRate:256}}),e.recorder.onComplete=function(){var t=Object(b.a)(j.a.mark((function t(r,a){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.state.masterRecord){t.next=3;break}return console.log("[RECORDING] alignment tool is trying to pop up but shouldn't..."),t.abrupt("return");case 3:return console.log("[RECORDING] encoding complete"),e.gumStream.getAudioTracks()[0].stop(),t.next=7,e.stopMicrophone(a);case 7:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),e.recorder.startRecording()}))},e.findNonRecordedTrackURLs=function(t){var r;return r=e.state.soloTracks.length>0?Object.keys(e.props.trackMetadata).filter((function(r){return r!==t&&e.state.soloTracks.includes(r)&&!e.state.mutedTracks.includes(r)&&Object.keys(e.props.trackMetadata[r].takes).length>0})).map((function(t){var r=Object.keys(e.props.trackMetadata[t].takes).pop();return e.props.trackMetadata[t].takes[r].s3_info+"?cacheblock=true"})):Object.keys(e.props.trackMetadata).filter((function(r){return r!==t&&!e.state.mutedTracks.includes(r)&&Object.keys(e.props.trackMetadata[r].takes).length>0})).map((function(t){var r=Object.keys(e.props.trackMetadata[t].takes).pop();return e.props.trackMetadata[t].takes[r].s3_info+"?cacheblock=true"})),console.log("# tracks to be stacked for align tool backing track = "+r.length),r},e.stopMicrophone=function(){var t=Object(b.a)(j.a.mark((function t(r){var n,s,o,i,c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new File([r],"recording_track_".concat(e.state.selectedTrackId,".mp3")),s=URL.createObjectURL(n),o=0,e.setState({stopMicProcessing:!1}),i=Object.keys(e.props.trackMetadata).length,console.log("[RECORDING] stopping microphone, not sending these muted tracks to alignment tool:",e.state.mutedTracks),c=e.findNonRecordedTrackURLs(e.state.selectedTrackId),!(i>1&&c.length>0&&null!==e.state.selectedTrackId)||e.state.alreadyAligning){t.next=15;break}return e.setState({alreadyAligning:!0}),t.next=11,Object(T.c)(Object(a.jsx)(ne,{recordedURL:s,backingTrackURLs:c,hasCountdownLatency:!0}),{title:"Check Recording",isCanClose:!1});case 11:if("scrap"!==(o=t.sent)){t.next=15;break}return e.setState({isRecording:!1,masterRecord:!1,alreadyAligning:!1}),t.abrupt("return");case 15:!1,e.createTake(e.state.selectedTrackId,n,false,o),e.setState({isRecording:!1,masterRecord:!1,alreadyAligning:!1});case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleFileUpload=function(t,r){if(console.log("handling file upload for target track id",r),null!==t&&null!==t[0]&&"undefined"!==typeof t[0])if(/\.(mp3|ogg|wav|flac|aac|aiff|m4a)$/i.test(t[0].name)){console.log("> validated file: ",t[0].name);e.createTake(r,t[0],!0)}else alert("Please upload valid audio file type (mp3, ogg, wav, flac, aac, aiff, m4a)")},e.setSelectedTrack=function(t){var r=null!==t?t:null;console.log("selecting track to record: "+r),e.setState({selectedTrackId:r}),console.log("> [SOCKET.IO] broadcasting update claimed tracks"),Ae.emit("broadcast update claimed tracks",{channel:e.props.projectHash,track_id:t,claimed_by:e.username})},e.formattedTime=function(e){var t=Math.floor(e/6e4),r=(e%6e4/1e3).toFixed(2);return t+":"+(r<10?"0":"")+r},e.updateSoloTracks=function(t){var r=Object(x.a)(e.state.soloTracks),a=r.indexOf(t);-1!==a?r.splice(a,1):r.push(t),console.log("new solo tracks:",r),e.setState({soloTracks:r})},e.updateMutedTracks=function(t){var r=Object(x.a)(e.state.mutedTracks),a=r.indexOf(t);-1!==a?r.splice(a,1):r.push(t),console.log("new muted tracks:",r),e.setState({mutedTracks:r})},e.changeVolume=function(t){e.setState({masterVolume:t/100})},e.rehearse=function(){console.log("currently rehearsing:",e.state.isRehearsing),e.setState({isRehearsing:!e.state.isRehearsing})},e.downloadMixedTrack=Object(b.a)(j.a.mark((function t(){var r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(T.b)("This will create a MP3 file containing the latest take from all parts. Are you sure you want to download?","Download Mix");case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:r=Object.keys(e.props.trackMetadata).filter((function(t){return 0!==Object.keys(e.props.trackMetadata[t].takes).length})).map((function(t){var r=e.props.trackMetadata[t].takes;return r[Object.keys(r).pop()].s3_info+"?cacheblock=true"})),ge.fetchAudio.apply(ge,Object(x.a)(r)).then((function(e){return ge.mergeAudio(e)})).then((function(e){return ge.export(e,"audio/mp3")})).then((function(t){var r=document.createElement("a");r.href=t.url;var a=new Date,n="".concat(a.getFullYear(),"_").concat(a.getMonth()+1,"_").concat(a.getDate()),s="".concat(a.getHours(),"_").concat(a.getMinutes(),"_").concat(a.getDate(),"_").concat(a.getHours()>=12?"PM":"AM"),o="".concat(e.props.projectName,"_").concat(n,"-").concat(s);r.setAttribute("download",o),document.body.appendChild(r),r.click(),r.parentNode.removeChild(r)}));case 7:case"end":return t.stop()}}),t)}))),e.requestGroupPlay=function(){console.log("[SOCKET.IO] requesting group play"),Ae.emit("get current online users",{channel:e.props.projectHash}),Ae.emit("prepare group play",{channel:e.props.projectHash},(function(t){t||e.setState({requestingGroupPlayback:!0,preparedGroupAction:"play"})}))},e.requestImmediateGroupPlay=function(){console.log("[SOCKET.IO] request immediate group play"),Ae.emit("immediate group play",{channel:e.props.projectHash})},e.requestGroupStop=function(){console.log("[SOCKET.IO] request immediate group stop"),e.state.withGroup?Ae.emit("immediate group stop",{channel:e.props.projectHash,user:e.username}):console.log("wanted to stop again but not with group anymore")},e.requestGroupRecord=function(){console.log("[SOCKET.IO] request group record"),null===e.state.selectedTrackId?alert("Select a part before recording!"):(Ae.emit("get current online users",{channel:e.props.projectHash}),Ae.emit("prepare group record",{channel:e.props.projectHash},(function(t){t||e.setState({requestingGroupRecord:!0,preparedGroupAction:"record"})})))},e.requestImmediateGroupRecord=function(){console.log("[SOCKET.IO] request immediate group record"),Ae.emit("immediate group record",{channel:e.props.projectHash})},e.cancelRequest=function(){console.log("[SOCKET.IO] cancel current request"),Ae.emit("cancel request",{channel:e.props.projectHash},(function(){e.setState({requestingGroupPlayback:!1,requestingGroupRecord:!1,preparedGroupAction:null})}))},e.realignTake=function(){var t=Object(b.a)(j.a.mark((function t(r,n){var s,o,i,c,l;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==(s=e.findNonRecordedTrackURLs(r)).length){t.next=4;break}return alert("Cannot realign: realign is only supported with 1+ other unmuted parts."),t.abrupt("return");case 4:return t.next=6,Object(T.c)(Object(a.jsx)(ne,{recordedURL:n,backingTrackURLs:s,hasCountdownLatency:!1}),{title:"Check Recording",isCanClose:!1});case 6:if("scrap"!==(o=t.sent)){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,fetch(n);case 11:return i=t.sent,t.next=14,i.blob();case 14:c=t.sent,l=new File([c],"recording_track_".concat(r,".mp3")),!0,e.createTake(r,l,true,o);case 18:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),e.updateTrackTimesInMillis=function(t,r){var a=Object.assign({},e.state.trackTimesInMillis);a[t]=1e3*r,e.setState({trackTimesInMillis:a})},e.state={masterPlay:!1,masterStop:!1,masterRecord:!1,isRecording:!1,selectedTrackId:null,claimedTrackIds:{},isBlocked:!0,showCountdown:!1,runningTime:0,mutedTracks:[],soloTracks:[],masterVolume:.5,initialLoad:!0,isRehearsing:!1,stopMicProcessing:!1,requestingGroupRecord:!1,requestingGroupPlayback:!1,receivedImmediateStop:!1,numGroupMembersPrepared:0,preparedGroupAction:null,withGroup:!1,alreadyAligning:!1,trackTimesInMillis:{}},e.audioContext=null,e.gumStream=null,e.input=null,e.recorder=null,e.username=JSON.parse(localStorage.getItem("userDetails")).name,e.toggleMasterRecord=e.toggleMasterRecord.bind(Object(O.a)(e)),e.toggleMasterStop=e.toggleMasterStop.bind(Object(O.a)(e)),e}return Object(c.a)(r,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){console.log("mic permission granted"),e.setState({isBlocked:!1})})).catch((function(){console.log("MIC PERMISSIOM DENIED"),e.setState({isBlocked:!0})})),this.username=JSON.parse(localStorage.getItem("userDetails")).name,this.setState({isRecording:!1,masterRecord:!1,selectedTrackId:null,soloTracks:[],mutedTracks:[]}),console.log("[SOCKET.IO] ".concat(this.props.projectName," | creating DAW listeners for ").concat(this.username)),Ae.on("beginGroupPlay",this.beginGroupPlayListener),Ae.on("beginGroupStop",this.beginGroupStopListener),Ae.on("beginGroupRecord",this.beginGroupRecordListener),Ae.on("updateNumPrepared",this.updateNumPreparedListener),Ae.on("notifyWaitingGroupMember",this.notifyWaitingGroupMember),Ae.on("updateClaimedTracks",this.updateClaimedTracksListener),Ae.on("retrieveCurrentClaimedTracks",this.retrieveCurrentClaimedTracksListener),Ae.emit("catch up new member",{channel:this.props.projectHash})}},{key:"componentDidUpdate",value:function(e){this.state.initialLoad&&(0===Object.keys(this.props.trackMetadata).length&&this.createTrack(),this.setState({initialLoad:!1})),this.state.masterPlay&&this.state.masterStop&&this.setState({masterPlay:!1,masterStop:!1,runningTime:0}),1===this.props.numOnlineUsers&&e.numOnlineUsers!==this.props.numOnlineUsers?this.resetGroupControls():(this.state.requestingGroupPlayback||this.state.requestingGroupRecord||null!==this.state.preparedGroupAction)&&0===this.state.numGroupMembersPrepared?(console.log("old state, resetting controls:",this.state),this.resetGroupControls()):this.props.numOnlineUsers>1&&this.props.numOnlineUsers===this.state.numGroupMembersPrepared&&(this.state.requestingGroupRecord||this.state.requestingGroupPlayback)&&(console.log("all users that are online are ready to go!!!!!"),this.state.requestingGroupRecord?(console.log("requesting group record"),this.requestImmediateGroupRecord()):this.state.requestingGroupPlayback&&(console.log("requesting group play"),this.requestImmediateGroupPlay()));var t=0===Object.values(this.state.trackTimesInMillis).length?0:Math.max.apply(Math,Object(x.a)(Object.values(this.state.trackTimesInMillis)));this.state.runningTime>t&&0!==t&&!this.state.masterRecord&&!this.state.isRecording&&this.toggleMasterStop()}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] ".concat(this.props.projectName," | removing DAW listeners")),Ae.off("beginGroupPlay",this.beginGroupPlayListener),Ae.off("beginGroupStop",this.beginGroupStopListener),Ae.off("beginGroupRecord",this.beginGroupRecordListener),Ae.off("updateNumPrepared",this.updateNumPreparedListener),Ae.off("notifyWaitingGroupMember",this.notifyWaitingGroupMember),Ae.off("updateClaimedTracks",this.updateClaimedTracksListener),Ae.off("retrieveCurrentClaimedTracks",this.retrieveCurrentClaimedTracksListener)}},{key:"toggleMasterStop",value:function(){if(console.log("> master stop"),clearInterval(this.timer),!this.state.masterPlay)return console.log("stopped but not playing"),void this.setState({runningTime:0,receivedImmediateStop:!1});this.state.isRecording?(this.setState({masterStop:!0,runningTime:0,stopMicProcessing:!0,receivedImmediateStop:!1,isRecording:!1}),this.gumStream.getAudioTracks()[0].stop(),this.recorder.finishRecording()):(console.log("stopped but not recording"),this.setState({masterStop:!0,runningTime:0,receivedImmediateStop:!1}))}},{key:"toggleMasterRecord",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("> master record"),null===this.state.selectedTrackId?alert("Select a part to record!"):(console.log("recording track "+this.state.selectedTrackId),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){console.log("mic permission granted"),t.startMicrophone(),t.setState({showCountdown:!0,isBlocked:!1})})).catch((function(){console.log("MIC PERMISSIOM DENIED"),alert("Please allow access to your microphone!"),t.setState({isBlocked:!0})})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.numOnlineUsers>1,r=Object.keys(this.props.trackMetadata).reduce((function(t,r){return t+Object.keys(e.props.trackMetadata[r].takes).length}),0),n=Object.keys(this.state.claimedTrackIds),s=Object.values(this.state.trackTimesInMillis),o=0===s.length?0:Math.max.apply(Math,Object(x.a)(s));return Object(a.jsxs)("div",{style:{marginBottom:"10px"},children:[Object(a.jsx)("div",{children:this.props.trackMetadata&&Object.keys(this.props.trackMetadata).length>0?Object.keys(this.props.trackMetadata).map((function(t){var r=e.props.trackMetadata[t],s=n.find((function(r){return e.state.claimedTrackIds[r]===t})),o=s!==e.username&&void 0!==s?s:null;return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{children:Object(a.jsx)(z,{trackName:r.track_name,trackId:t,takes:r.takes,masterPlay:e.state.masterPlay,masterStop:e.state.masterStop,masterRecord:e.state.masterRecord,selectedTrackId:e.state.selectedTrackId,setSelectedTrack:e.setSelectedTrack,deleteTake:e.deleteTake,soloTracks:e.state.soloTracks,updateSoloTracks:e.updateSoloTracks,updateMutedTracks:e.updateMutedTracks,claimedTracks:e.state.claimedTracks,masterVolume:e.state.masterVolume,renameTrack:e.renameTrack,deleteTrack:e.deleteTrack,handleFileUpload:e.handleFileUpload,realignTake:e.realignTake,claimedBy:o,updateTrackTimesInMillis:e.updateTrackTimesInMillis})}),0===Object.keys(e.props.trackMetadata[t].takes).length&&Object(a.jsx)("div",{style:{marginTop:"-8px"},children:Object(a.jsx)("input",{style:{marginLeft:"20px",marginBottom:"10px"},type:"file",onChange:function(r){return e.handleFileUpload(r.target.files,t)}})})]},"track_".concat(t))})):Object(a.jsx)("div",{style:{marginTop:"10px"}})}),Object(a.jsx)("button",{style:{marginTop:"10px",marginLeft:"5px",marginBottom:"28px"},className:"stitched",onClick:this.createTrack,children:"+ New Part"}),Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)("p",{style:{marginBottom:"5px"},children:Object(a.jsx)("b",{children:"Master Controls"})}),t&&Object(a.jsx)("button",{style:{marginLeft:"12px",height:"35px",marginTop:"8px"},onClick:this.requestGroupRecord,disabled:this.state.masterPlay||this.state.withGroup||this.state.requestingGroupRecord||this.state.requestingGroupPlayback||"play"===this.state.preparedGroupAction||this.state.showCountdown,children:this.state.requestingGroupRecord?"waiting...":"group record"}),t&&Object(a.jsx)("button",{onClick:this.requestGroupStop,disabled:!this.state.withGroup||this.state.showCountdown,style:{height:"35px",marginTop:"8px"},children:"group stop"}),t&&Object(a.jsx)("button",{onClick:this.requestGroupPlay,disabled:this.state.masterPlay||this.state.withGroup||this.state.requestingGroupPlayback||this.state.requestingGroupRecord||"record"===this.state.preparedGroupAction||this.state.showCountdown||0===r,style:{height:"35px",marginTop:"8px"},children:this.state.requestingGroupPlayback?"waiting...":"group play"}),t&&Object(a.jsx)("button",{onClick:this.cancelRequest,disabled:!this.state.requestingGroupRecord&&!this.state.requestingGroupPlayback,style:{height:"35px",marginTop:"8px"},children:"cancel request"}),t&&null!==this.state.preparedGroupAction&&0!==this.state.numGroupMembersPrepared&&Object(a.jsxs)("div",{style:{marginLeft:"10px",marginTop:"14px"},children:[this.state.numGroupMembersPrepared,"/",this.props.numOnlineUsers," ","ready",this.state.preparedGroupAction&&" for ".concat(this.state.preparedGroupAction)]}),this.state.stopMicProcessing&&Object(a.jsx)(H,{text:"Saving Recording..."})]}),this.state.isBlocked&&Object(a.jsx)("p",{style:{marginBottom:"5px"},children:"Please allow access to your mic to record!"}),Object(a.jsx)(_.a,{title:this.state.masterPlay?"":"Record selected part",arrow:!0,children:Object(a.jsx)("span",{children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Record",onClick:this.toggleMasterRecord,disabled:this.state.masterPlay||this.state.isBlocked||this.state.withGroup||this.state.showCountdown,children:this.state.masterPlay||this.state.isBlocked||this.state.withGroup||this.state.showCountdown?Object(a.jsx)(ue.a,{style:{fontSize:28}}):Object(a.jsx)(ue.a,{style:{fontSize:28},color:"secondary"})})})}),Object(a.jsx)(_.a,{title:this.state.masterPlay?"Stop all parts":"",arrow:!0,children:Object(a.jsx)("span",{children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Stop",onClick:this.toggleMasterStop,disabled:!this.state.masterPlay||this.state.withGroup,children:Object(a.jsx)(ce.a,{style:{fontSize:35}})})})}),Object(a.jsx)(_.a,{title:this.state.masterPlay||0===r?"":"Play all parts",arrow:!0,children:Object(a.jsx)("span",{children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Play",onClick:this.toggleMasterPlay,disabled:this.state.masterPlay||this.state.withGroup||0===r||this.state.showCountdown,style:{marginLeft:"-5px"},children:this.state.masterPlay||this.state.withGroup||0===r||this.state.showCountdown?Object(a.jsx)(oe.a,{style:{fontSize:35}}):Object(a.jsx)(oe.a,{color:"primary",style:{fontSize:35,color:"#54ae1c"}})})})})," ",Object(a.jsxs)("div",{style:{display:"flex",marginTop:"-45px"},children:[Object(a.jsx)("div",{style:{marginLeft:"170px",marginTop:"5px"},children:this.state.isRecording?Object(a.jsx)("span",{style:{color:"#F60457"},children:Object(a.jsx)("b",{children:this.formattedTime(this.state.runningTime)})}):this.state.masterPlay||this.state.showCountdown?Object(a.jsx)("span",{children:Object(a.jsx)("b",{children:this.formattedTime(this.state.runningTime)})}):Object(a.jsx)("span",{children:this.formattedTime(this.state.runningTime)})}),Object(a.jsxs)("div",{style:this.state.masterRecord||this.state.isRecording||this.state.showCountdown?{position:"absolute",marginLeft:"235px",marginTop:"5px",width:"85px",color:"lightgray"}:{position:"absolute",marginLeft:"235px",marginTop:"5px",width:"85px"},children:["/",Object(a.jsx)("span",{style:{marginLeft:"6px"},children:this.formattedTime(o)})]}),Object(a.jsxs)("div",{style:{position:"absolute",marginLeft:"320px",width:"100px"},children:["Volume",Object(a.jsx)(S.a,{min:0,max:100,defaultValue:100,onChange:this.changeVolume})]}),Object(a.jsx)("button",{onClick:this.downloadMixedTrack,className:"download-full-mix",children:"Download full mix"})]}),this.state.showCountdown&&Object(a.jsxs)("div",{className:"timer",style:{position:"absolute",marginLeft:"580px",marginTop:"-100px"},children:[Object(a.jsx)(W.CountdownCircleTimer,{isPlaying:!0,duration:3,colors:[["#0f52bd",1]],size:90,onComplete:function(){var t=Date.now()-e.state.runningTime;e.timer=setInterval((function(){e.setState({runningTime:Date.now()-t})})),e.setState({showCountdown:!1,masterPlay:!0,masterRecord:!0,isRecording:!0})},children:function(e){return e.remainingTime}}),Object(a.jsx)("button",{onClick:function(){e.setState({showCountdown:!1,isRecording:!1}),e.toggleMasterStop()},style:{marginTop:"10px",marginBottom:"10px"},children:"Ahh I'm not ready!"})]})]})}}]),r}(n.Component),be=r(58),fe=r.n(be),ke=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(e){var a;Object(i.a)(this,r),(a=t.call(this,e)).updateOnlineUsersListener=function(e){console.log("[SOCKET.IO] receiving updateOnlineUsers:",e.user_list),a.setState({onlineUsers:e.user_list})},a.updateProjectListener=function(){console.log("[SOCKET.IO] receiving updateProject"),a.refresh()},a.retrieveProject=function(e){console.log("retrieving project: "+e),null!==e&&""!==e&&fetch("/api/project?"+new URLSearchParams({project_hash:e})).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){var r=t.body.tracks?t.body.tracks.reduce((function(e,t){var r=t.takes.reduce((function(e,t){return e[t.take]={date_uploaded:t.date_uploaded,id:t.id,s3_info:t.s3_info,track_id:t.track_id},e}),{});return e[t.id]={takes:r,track_name:t.track_name},e}),{}):{};200===t.status&&a.setState({project_hash:e,project_name:t.body.project_name,group_name:t.body.group.group_name,project_id:t.body.id,track_metadata:r})}))},a.refresh=function(){a.retrieveProject(a.state.project_hash)},a.state={project_name:null,group_name:null,project_id:null,track_metadata:null,project_hash:e.location.pathname.split("/").pop(),isCreatingTake:!1,isDeletingTakeOrTrack:!1,onlineUsers:[]},"project"===a.state.project_hash&&(a.state.project_hash=null),a.createTrack=a.createTrack.bind(Object(O.a)(a)),a.deleteTrack=a.deleteTrack.bind(Object(O.a)(a)),a.renameTrack=a.renameTrack.bind(Object(O.a)(a)),a.createTake=a.createTake.bind(Object(O.a)(a)),a.deleteTake=a.deleteTake.bind(Object(O.a)(a));var n=JSON.parse(localStorage.getItem("userDetails")).name;return a.state.onlineUsers=[n],console.log("[SOCKET.IO] sending request to JOIN project"),Ae.emit("join project",{channel:a.state.project_hash,user:n}),a}return Object(c.a)(r,[{key:"componentDidMount",value:function(){this.retrieveProject(this.state.project_hash),console.log("[SOCKET.IO] creating project listeners"),Ae.on("updateOnlineUsers",this.updateOnlineUsersListener),Ae.on("updateProject",this.updateProjectListener)}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] removing project (".concat(this.state.project_name,") listeners")),Ae.off("updateOnlineUsers",this.updateOnlineUsersListener),Ae.off("updateProject",this.updateProjectListener);var e=localStorage.getItem("userDetails");if(e){console.log("[SOCKET.IO] sending request to LEAVE project");var t=JSON.parse(e).name;Ae.emit("leave project",{channel:this.state.project_hash,user:t})}}},{key:"componentDidUpdate",value:function(e){var t=this.props.location.pathname.split("/").pop();"project"!==t&&null!==t&&this.props.location.pathname!==e.location.pathname?this.retrieveProject(t):"project"===t&&null!==this.state.project_hash&&this.setState({project_hash:null,project_name:null,group_name:null,project_id:null,track_metadata:null})}},{key:"createTrack",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,r,a=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new track"),e.next=3,Object(T.g)("Name Your Part");case 3:(t=e.sent)&&((r=new FormData).append("track_name",t),r.append("project_id",this.state.project_id),fetch("/api/track",{method:"POST",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(400!==e.status){console.log("added new track");var r=Object.assign({},a.state.track_metadata);r[e.body.track_id]={id:parseInt(e.body.track_id),project_id:a.state.projectId,takes:{},track_name:t},a.setState({track_metadata:r}),Ae.emit("broadcast update project",{channel:a.state.project_hash})}})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renameTrack",value:function(){var e=Object(b.a)(j.a.mark((function e(t,r){var a,n,s=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming track"),e.next=3,Object(T.g)("Rename Your Part",{defaultValue:r});case 3:(a=e.sent)&&((n=new FormData).append("track_id",t),n.append("new_name",a),fetch("/api/track",{method:"PUT",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var r=Object.assign({},s.state.track_metadata);r[t].track_name=a,s.setState({track_metadata:r}),Ae.emit("broadcast update project",{channel:s.state.project_hash})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteTrack",value:function(){var e=Object(b.a)(j.a.mark((function e(t,r){var a,n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.b)('Are you sure you want to delete "'.concat(r,'"?'),"Delete Part");case 2:return e.sent&&(this.setState({isDeletingTakeOrTrack:!0}),(a=new FormData).append("track_id",t),fetch("/api/track",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var r=Object.assign({},n.state.track_metadata);return delete r[t],n.setState({track_metadata:r,isDeletingTakeOrTrack:!1}),Ae.emit("broadcast update project",{channel:n.state.project_hash}),!0}n.setState({isDeletingTakeOrTrack:!1})}))),e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createTake",value:function(e,t,r,a){var n=this;console.log("creating new take for",e),this.setState({isCreatingTake:!0});var s=new FormData;s.append("track_id",e),s.append("file",t),s.append("latency",a),s.append("tz_offset",(new Date).getTimezoneOffset()/60),s.append("is_manual_upload",r),fetch("/api/take",{method:"POST",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){if(400!==t.status){console.log("CREATED TAKE:",t);var r=Object.assign({},n.state.track_metadata);r[parseInt(e)].takes[parseInt(t.body.take)]={id:parseInt(t.body.take_id),track_id:parseInt(e),s3_info:t.body.s3_info,date_uploaded:new Date(t.body.timestamp).toString()},n.setState({track_metadata:r,isCreatingTake:!1}),Ae.emit("broadcast update project",{channel:n.state.project_hash})}else n.setState({isCreatingTake:!1})})).catch((function(e){n.setState({isCreatingTake:!1}),alert("Could not upload take due to server error (see console)."),console.log(e)}))}},{key:"deleteTake",value:function(e,t,r){var a=this;this.setState({isDeletingTakeOrTrack:!0});var n=new FormData;n.append("take_id",r),fetch("/api/take",{method:"DELETE",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(r){if(200===r.status){var n=Object.assign({},a.state.track_metadata);delete n[e].takes[t],a.setState({track_metadata:n,isDeletingTakeOrTrack:!1}),Ae.emit("broadcast update project",{channel:a.state.project_hash})}else a.setState({isDeletingTakeOrTrack:!1})})).catch((function(e){alert("Could not delete take due to server error (see console)."),a.setState({isDeletingTakeOrTrack:!1})}))}},{key:"render",value:function(){var e=this,t=this.props.location.pathname.split("/").pop();return null===this.state.project_name&&"project"!==t?Object(a.jsx)("div",{children:"Loading..."}):this.state.project_hash&&"project"!==t&&""!==t&&Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{style:{display:"flex",marginBottom:"-17px",marginTop:"-5px"},children:[Object(a.jsxs)("h2",{children:[this.state.project_name,Object(a.jsx)(_.a,{title:"Refresh latest project info",arrow:!0,placement:"right",children:Object(a.jsx)(w.a,{disableRipple:!0,"aria-label":"Sync",onClick:function(){e.refresh(),console.log("retrieving current online users"),Ae.emit("get current online users",{channel:e.state.project_hash})},style:{marginTop:"0px"},children:Object(a.jsx)(fe.a,{style:{fontSize:20}})})})]}),this.state.isCreatingTake&&Object(a.jsx)("div",{style:{marginTop:"-5px"},children:Object(a.jsx)(H,{text:"Uploading take..."})}),this.state.isDeletingTakeOrTrack&&Object(a.jsx)("div",{style:{marginTop:"-5px"},children:Object(a.jsx)(H,{text:"Deleting..."})})]}),Object(a.jsx)("div",{style:{marginLeft:"-5px",marginTop:"12px",marginBottom:"-12px",fontSize:"12px"},children:this.state.onlineUsers.map((function(e,t){return Object(a.jsxs)("div",{style:{display:"inline-block",marginRight:"5px"},children:[Object(a.jsx)("img",{src:"images/daw/online.png",alt:"online",width:"8",height:"8",style:{marginLeft:"5px",marginTop:"2px"}})," ",e," "]},"user_".concat(t))}))}),Object(a.jsx)("div",{style:{marginTop:"20px"},children:Object(a.jsx)(je,{projectName:this.state.project_name,projectHash:this.state.project_hash,trackMetadata:this.state.track_metadata,numOnlineUsers:this.state.onlineUsers.length,retrieveProject:this.retrieveProject,createTrack:this.createTrack,deleteTrack:this.deleteTrack,renameTrack:this.renameTrack,createTake:this.createTake,deleteTake:this.deleteTake})})]})}}]),r}(n.Component),Oe=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"render",value:function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)("h2",{children:"HOME PAGE"}),this.props.authed?Object(a.jsxs)("div",{children:[Object(a.jsx)("p",{children:" To get started on a project: "}),Object(a.jsxs)("ol",{children:[Object(a.jsx)("li",{children:'Click "Groups" to create a new rehearsal group and add group members.'}),Object(a.jsxs)("li",{children:['Click "Projects" to create a project and begin rehearsing!'," "]})]})]}):Object(a.jsx)("p",{children:"Login to get started! \ud83c\udfb6"})]})}}]),r}(n.Component),xe=r(46),ye=(r(150),"Rename Project"),ve="Delete Project",Te=[ye,ve];var Se=function(e){var t=Object(d.f)(),r=Object(n.useState)(null),s=Object(J.a)(r,2),o=s[0],i=s[1],c=function(t){var r=t.target.innerText;r===ye?e.renameProject(e.project.id,e.project.project_name):r===ve&&e.deleteProject(e.project.id,e.project.project_name),i(null)};return Object(a.jsxs)("li",{style:{marginBottom:"12px"},children:["Project: ",e.project.project_name," ",Object(a.jsx)("button",{onClick:function(){t.push({pathname:"/project/".concat(e.project.project_hash),state:{project:e.project,group_name:e.group_name,group_id:e.group_id}})},className:"rehearse",children:"Rehearse! \xbb"}),Object(a.jsx)(w.a,{"aria-label":"more","aria-controls":"project-menu","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)},children:Object(a.jsx)(G.a,{})}),Object(a.jsx)(C.a,{id:"project-menu",anchorEl:o,keepMounted:!0,open:null!==o,onClose:c,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:Te.map((function(e){return Object(a.jsx)(R.a,{onClick:c,children:e},e)}))})]})},we=(r(152),function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).clickThreeDotsMenu=function(e){a.setState({threeDotsAnchorElement:e.currentTarget})},a.closeThreeDotsMenu=function(e){var t=e.target.innerText;"Rename Group"===t?a.props.renameGroup(a.props.id,a.props.name):"Delete Group"===t&&a.props.deleteGroup(a.props.id,a.props.name),a.setState({threeDotsAnchorElement:null})},a.state={projects:e.projects,threeDotsAnchorElement:null},a.createNewProject=a.createNewProject.bind(Object(O.a)(a)),a.deleteProject=a.deleteProject.bind(Object(O.a)(a)),a.renameProject=a.renameProject.bind(Object(O.a)(a)),a}return Object(c.a)(r,[{key:"componentDidUpdate",value:function(e){this.props.projects!==e.projects&&this.setState({projects:this.props.projects})}},{key:"createNewProject",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,r,a=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.g)("Name Your Project");case 2:(t=e.sent)&&((r=new FormData).append("project_name",t),r.append("group_id",this.props.id),fetch("/api/project",{method:"POST",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&(a.setState({projects:a.state.projects.concat([{project_name:t,id:e.body.project_id,project_hash:e.body.project_hash}])}),Ae.emit("broadcast update projects"))})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteProject",value:function(){var e=Object(b.a)(j.a.mark((function e(t,r){var a,n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.b)('Are you sure you want to delete "'.concat(r,'"?'),"Delete Project");case 2:e.sent&&((a=new FormData).append("project_id",t),fetch("/api/project",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var r=Object(x.a)(n.state.projects).filter((function(e){return e.id!==t}));n.setState({projects:r}),Ae.emit("broadcast update projects")}})));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"renameProject",value:function(){var e=Object(b.a)(j.a.mark((function e(t,r){var a,n,s=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.g)("Rename Your Project",{defaultValue:r});case 2:(a=e.sent)&&((n=new FormData).append("project_id",t),n.append("new_name",a),fetch("/api/project",{method:"PUT",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var r=Object(x.a)(s.state.projects).map((function(e){return e.id===t?Object(xe.a)(Object(xe.a)({},e),{},{project_name:a}):e}));s.setState({projects:r}),Ae.emit("broadcast update projects")}})));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.projects.sort((function(e,t){return e.id>t.id?1:-1}));return Object(a.jsxs)("div",{style:{marginTop:"25px",marginBottom:"-15px",marginLeft:"2px"},children:[Object(a.jsxs)("p",{children:[Object(a.jsxs)("b",{children:["Group: ",this.props.name]}),"  ",Object(a.jsx)("button",{onClick:this.createNewProject,style:{marginLeft:"5px",height:"25px",cursor:"pointer"},children:"+ Project"})]}),Object(a.jsx)("div",{style:{marginTop:"20px"},children:Object(a.jsxs)("ul",{children:[this.state.projects&&0===this.state.projects.length&&Object(a.jsx)("p",{className:"text-muted",style:{marginTop:"-10px",marginBottom:"35px"},children:"No projects created yet!"}),t.map((function(t,r){return Object(a.jsx)("div",{children:Object(a.jsx)("div",{style:{marginTop:"-20px",marginBottom:"-10px"},children:Object(a.jsx)(Se,{project:t,group_name:e.props.name,group_id:e.props.id,renameProject:e.renameProject,deleteProject:e.deleteProject})})},"project_".concat(r))}))]})})]})}}]),r}(n.Component)),_e=(r(153),function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.call(this)).updateProjectsListener=function(){console.log("[SOCKET.IO] receiving updateProjects"),e.refresh()},e.fetchGroups=function(){fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status&&e.setState({groups:t.body,isLoaded:!0})}))},e.refresh=function(){e.fetchGroups()},e.state={groups:[],isLoaded:!1},e.fetchGroups(),e}return Object(c.a)(r,[{key:"componentDidMount",value:function(){console.log("[SOCKET.IO] creating Projects page listener"),Ae.on("updateProjects",this.updateProjectsListener)}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] removing Projects page listener"),Ae.off("updateProjects",this.updateProjectsListener)}},{key:"render",value:function(){var e=this;return this.state.isLoaded?Object(a.jsxs)("div",{style:{marginBottom:"10px"},children:[Object(a.jsxs)("h2",{style:{marginBottom:"-25px"},children:["PROJECTS",Object(a.jsx)(_.a,{title:"Refresh latest projects",arrow:!0,placement:"right",children:Object(a.jsx)(w.a,{style:{marginTop:"-3px"},disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,children:Object(a.jsx)(fe.a,{style:{fontSize:25}})})})]}),this.state.groups&&0===this.state.groups.length&&Object(a.jsx)("p",{style:{marginTop:"20px"},class:"text-muted",children:"Create a group first!"}),this.state.groups&&this.state.groups.map((function(t,r){return Object(a.jsx)("div",{children:Object(a.jsx)(we,{id:t.id,name:t.group_name,projects:t.projects,renameGroup:e.renameGroup,deleteGroup:e.deleteGroup})},"group_".concat(r))}))]}):Object(a.jsx)("div",{children:"Loading..."})}}]),r}(n.Component)),Ce=(r(154),function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;Object(i.a)(this,r);for(var a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).removeMember=function(){e.props.removeMember(e.props.id)},e}return Object(c.a)(r,[{key:"render",value:function(){var e=!this.props.onlyMemberInGroup;return Object(a.jsx)("div",{style:{marginTop:"10px"},children:Object(a.jsxs)("li",{children:["Member: ",this.props.name," ",e&&Object(a.jsx)("button",{onClick:this.removeMember,style:{marginLeft:"5px",cursor:"pointer"},children:"Remove"})]})})}}]),r}(n.Component));r(155);function Re(e){var t=Object(T.h)(),r=Object(n.useState)(null),s=Object(J.a)(r,2),o=s[0],i=s[1],c=Object(n.useState)(null),l=Object(J.a)(c,2),u=l[0],p=l[1],d=Object.keys(e.users).sort((function(t,r){return e.users[t]<e.users[r]})).reduce((function(t,r){return t.push({value:r,label:e.users[r]}),t}),[]);return Object(a.jsxs)("div",{children:[Object(a.jsxs)(T.e,{children:[Object(a.jsx)("p",{children:"The dropdown lists all members on JamNSync:"}),Object(a.jsx)("div",{style:{height:250,width:300},children:Object(a.jsx)(v.a,{options:d,onChange:function(e){console.log("Selected "+e.label),i(e.value),p(e.label)},placeholder:"Select a name"})})]}),Object(a.jsxs)(T.f,{children:[Object(a.jsx)(T.d,{onClick:function(){t.close([o,u])},children:"OK"}),Object(a.jsx)(T.d,{onClick:function(){t.close([o,u])},type:"light",children:"Cancel"})]})]})}var Le="Rename Group",Ge="Delete Group",Ie=[Le,Ge],Pe=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).clickThreeDotsMenu=function(e){a.setState({threeDotsAnchorElement:e.currentTarget})},a.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===Le?a.props.renameGroup(a.props.id,a.props.name):t===Ge&&a.props.deleteGroup(a.props.id,a.props.name),a.setState({threeDotsAnchorElement:null})},a.state={group_membership:{},threeDotsAnchorElement:null},fetch("/api/group/members?group_id="+a.props.id,{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&a.setState({group_membership:e.body})})),a.addMember=a.addMember.bind(Object(O.a)(a)),a.removeMember=a.removeMember.bind(Object(O.a)(a)),a}return Object(c.a)(r,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.refresh!==e.refresh&&fetch("/api/group/members?group_id="+this.props.id,{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&t.setState({group_membership:e.body})}))}},{key:"addMember",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,r,n,s,o,i,c=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("adding member"),e.next=3,fetch("/api/users",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){return e.body}));case 3:return t=e.sent,e.next=6,Object(T.c)(Object(a.jsx)(Re,{users:t}),{title:"Add Member to "+this.props.name,showCloseIcon:!0});case 6:if(void 0!==(r=e.sent)&&null!==r){e.next=9;break}return e.abrupt("return");case 9:n=Object(J.a)(r,2),s=n[0],o=n[1],s&&Object.keys(this.state.group_membership).includes(s)?alert("".concat(o,' is already a member in group "').concat(this.props.name,'"')):s&&o&&((i=new FormData).append("group_id",this.props.id),i.append("user_id",s),fetch("/api/group/members",{method:"POST",body:i}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var t=Object.assign({},c.state.group_membership);t[s]=o,c.setState({group_membership:t}),Ae.emit("broadcast update groups")}})));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var r,a,n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("removing member id:",t),r=this.state.group_membership[t],e.next=4,Object(T.b)('Are you sure you want to remove "'.concat(r,'" from "').concat(this.props.name,'"?'),"Remove Member");case 4:e.sent&&((a=new FormData).append("group_id",this.props.id),a.append("user_id",t),fetch("/api/group/members",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var r=Object.assign({},n.state.group_membership);delete r[t],n.setState({group_membership:r}),Ae.emit("broadcast update groups")}})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{style:{marginBottom:"-15px"},children:[Object(a.jsxs)("p",{style:{marginTop:"25px",marginBottom:"-15px",marginLeft:"2px"},children:[Object(a.jsxs)("b",{children:["Group: ",this.props.name]}),"  ",Object(a.jsx)("button",{onClick:this.addMember,style:{marginLeft:"5px",height:"25px",cursor:"pointer"},children:"+ Member"}),Object(a.jsx)(w.a,{"aria-label":"more","aria-controls":"group-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"2px"},children:Object(a.jsx)(G.a,{})}),Object(a.jsx)(C.a,{id:"group-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:Ie.map((function(t){return Object(a.jsx)(R.a,{onClick:e.closeThreeDotsMenu,children:t},t)}))})]}),Object(a.jsx)("ul",{children:Object.keys(this.state.group_membership).map((function(t){var r=e.state.group_membership[t];return Object(a.jsx)("div",{children:Object(a.jsx)("div",{children:Object(a.jsx)(Ce,{id:t,name:r,removeMember:e.removeMember,onlyMemberInGroup:1===Object.keys(e.state.group_membership).length})})},"member_".concat(t))}))})]})}}]),r}(n.Component),Me=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.call(this)).updateGroupsListener=function(){console.log("[SOCKET.IO] receiving updateGroups"),e.refresh()},e.fetchGroups=function(){fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status&&e.setState({groups:t.body,isLoaded:!0})}))},e.refresh=function(){console.log("refreshing groups"),fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status?e.setState({groups:t.body,isLoaded:!0,refresh:e.state.refresh+1}):e.setState({refresh:e.state.refresh+1})}))},e.state={groups:[],isLoaded:!1,refresh:0},e.fetchGroups(),e.createNewGroup=e.createNewGroup.bind(Object(O.a)(e)),e.deleteGroup=e.deleteGroup.bind(Object(O.a)(e)),e.renameGroup=e.renameGroup.bind(Object(O.a)(e)),e}return Object(c.a)(r,[{key:"componentDidMount",value:function(){console.log("[SOCKET.IO] creating Groups page listener"),Ae.on("updateGroups",this.updateGroupsListener)}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] removing Groups page listener"),Ae.off("updateGroups",this.updateGroupsListener)}},{key:"createNewGroup",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,r,a=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new group!"),e.next=3,Object(T.g)("Name Your Group");case 3:(t=e.sent)&&((r=new FormData).append("group_name",t),fetch("/api/group",{method:"POST",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&a.setState({groups:a.state.groups.concat([{group_name:t,id:e.body.group_id,projects:[]}])})})).catch((function(e){alert('Server Error: Group name taken, use a different name instead of "'+t+'"!')})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteGroup",value:function(){var e=Object(b.a)(j.a.mark((function e(t,r){var a,n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting group"),e.next=3,Object(T.b)('Are you sure you want to delete "'.concat(r,'"?'),"Delete Group");case 3:e.sent&&((a=new FormData).append("group_id",t),fetch("/api/group",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var r=Object(x.a)(n.state.groups).filter((function(e){return e.id!==t}));n.setState({groups:r}),Ae.emit("broadcast update groups")}})));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"renameGroup",value:function(){var e=Object(b.a)(j.a.mark((function e(t,r){var a,n,s=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming group"),e.next=3,Object(T.g)("Rename Your Group",{defaultValue:r});case 3:(a=e.sent)&&((n=new FormData).append("new_name",a),n.append("group_id",t),fetch("/api/group",{method:"PUT",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var r=Object(x.a)(s.state.groups).map((function(e){return e.id===t?Object(xe.a)(Object(xe.a)({},e),{},{group_name:a}):e}));s.setState({groups:r}),Ae.emit("broadcast update groups")}})));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.isLoaded?Object(a.jsxs)("div",{children:[Object(a.jsxs)("h2",{style:{marginBottom:"-35px"},children:["REHEARSAL GROUPS",Object(a.jsx)(_.a,{title:"Refresh latest groups",arrow:!0,placement:"right",children:Object(a.jsx)(w.a,{style:{marginTop:"-3px"},disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,children:Object(a.jsx)(fe.a,{style:{fontSize:25}})})})]}),this.state.groups&&this.state.groups.map((function(t,r){return Object(a.jsx)("div",{children:Object(a.jsx)(Pe,{id:t.id,name:t.group_name,projects:t.projects,renameGroup:e.renameGroup,deleteGroup:e.deleteGroup,refresh:e.state.refresh})},"group_".concat(r))})),Object(a.jsx)("button",{style:{marginTop:"30px"},className:"stitched",onClick:this.createNewGroup,children:"+ New Rehearsal Group"})]}):Object(a.jsx)("div",{children:"Loading..."})}}]),r}(n.Component),De=r(128);var Ue=function(e){var t=e.component,r=e.authed,n=Object(De.a)(e,["component","authed"]);return Object(a.jsx)(d.b,Object(xe.a)(Object(xe.a)({},n),{},{render:function(e){return!0===r?Object(a.jsx)(t,Object(xe.a)({},e)):Object(a.jsx)(d.a,{to:{pathname:"/",state:{from:e.location}}})}}))},Ee=r(127),Ae=r.n(Ee)()(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_CLIENT_ID:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com"}).ROOT_URL),Fe=Object(h.b)(),Ne=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.call(this)).handleSuccessfulLogin=function(t){var r=t.profileObj,a=new FormData;a.append("google_auth_id",r.googleId),a.append("google_email",r.email),a.append("user_name",r.name),fetch("/auth/login",{method:"POST",body:a}).then((function(e){return e.json()})).then((function(t){console.log(t.message),localStorage.setItem("userDetails",JSON.stringify(r)),localStorage.setItem("isUserLoggedIn",!0),e.setState({userDetails:r,isUserLoggedIn:!0})}))},e.handleSuccessfulLogout=function(){fetch("/auth/logout",{method:"POST"}).then((function(e){return e.json()})).then((function(t){console.log(t.message),localStorage.clear(),e.setState({userDetails:{},isUserLoggedIn:!1})})).catch((function(t){console.log("ERROR:",t),localStorage.clear(),e.setState({userDetails:{},isUserLoggedIn:!1}),Fe.replace("/home")}))},e.state={userDetails:{},isUserLoggedIn:!1},e}return Object(c.a)(r,[{key:"componentDidMount",value:function(){"/"===Fe.location.pathname&&Fe.replace("/home");var e=JSON.parse(localStorage.getItem("userDetails")),t="true"===localStorage.getItem("isUserLoggedIn");t&&!this.state.isUserLoggedIn&&this.setState({userDetails:e,isUserLoggedIn:t})}},{key:"componentDidUpdate",value:function(e){!this.state.isUserLoggedIn&&e.isUserLoggedIn&&"/"===Fe.location.pathname&&Fe.replace("/home")}},{key:"render",value:function(){var e=Fe.location.pathname;return Object(a.jsx)(p.a,{history:Fe,children:Object(a.jsxs)("div",{children:[Object(a.jsx)("h1",{children:"JamNSync"}),Object(a.jsxs)("div",{style:{position:"absolute",right:20,top:35},children:[!this.state.isUserLoggedIn&&Object(a.jsx)(f,{onSuccessfulLogin:this.handleSuccessfulLogin}),this.state.isUserLoggedIn&&Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)("div",{children:Object(a.jsxs)("p",{children:["Welcome, ",this.state.userDetails.givenName,"!"]})}),Object(a.jsx)("div",{style:{marginLeft:"5px"},children:Object(a.jsx)(k,{onSuccessfulLogout:this.handleSuccessfulLogout})})]})]}),Object(a.jsxs)("ul",{className:"header",children:[Object(a.jsx)("li",{children:Object(a.jsx)(p.b,{to:"/home",children:"Home"})}),this.state.isUserLoggedIn&&Object(a.jsx)("li",{children:Object(a.jsx)(p.b,{to:"/groups",children:"Groups"})}),this.state.isUserLoggedIn&&Object(a.jsx)("li",{children:Object(a.jsx)(p.b,{to:"/projects",children:"Projects"})})]}),Object(a.jsxs)("div",{className:"content",children:[Object(a.jsx)(d.b,{exact:!0,path:"/",children:this.state.isUserLoggedIn&&"/"!==e?Object(a.jsx)(d.a,{to:e}):Object(a.jsx)(Oe,{authed:this.state.isUserLoggedIn})}),Object(a.jsx)(d.b,{path:"/home",children:Object(a.jsx)(Oe,{authed:this.state.isUserLoggedIn})}),Object(a.jsx)(Ue,{path:"/projects",component:_e,authed:this.state.isUserLoggedIn}),Object(a.jsx)(Ue,{path:"/groups",component:Me,authed:this.state.isUserLoggedIn}),Object(a.jsx)(Ue,{path:"/project/",component:ke,authed:this.state.isUserLoggedIn})]})]})})}}]),r}(n.Component);r(186);o.a.render(Object(a.jsx)(Ne,{}),document.getElementById("root"))}},[[187,1,2]]]);
//# sourceMappingURL=main.53fabf8f.chunk.js.map