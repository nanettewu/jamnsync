{"version":3,"sources":["components/Login.js","utils/refreshToken.js","components/Logout.js","routes/project/daw/Track.js","routes/project/daw/LoadingGif.js","routes/project/daw/crunker.js","routes/project/daw/AlignRecording.js","routes/project/daw/DAW.js","routes/project/Project.js","routes/home/Home.js","routes/projects/Project.js","routes/projects/Group.js","routes/projects/Projects.js","routes/groups/Member.js","routes/groups/AddMemberModal.js","routes/groups/Group.js","routes/groups/Groups.js","utils/components/PrivateRoute.js","App.js","index.js"],"names":["Login","props","clientId","process","buttonText","onSuccess","res","refreshTiming","tokenObj","expires_in","refreshToken","a","reloadAuthResponse","newAuthRes","console","log","localStorage","setItem","id_token","setTimeout","refreshTokenSetup","onSuccessfulLogin","onFailure","alert","error","cookiePolicy","style","marginTop","isSignedIn","Logout","onLogoutSuccess","onSuccessfulLogout","REALIGN_OPTION","RENAME_TRACK_OPTION","DELETE_TRACK_OPTION","FILE_UPLOAD_OPTION","options","Track","stop","audioFile","currentTime","pause","setState","playing","changeVolume","value","volume","masterVolume","seek","state","play","fastForward","duration","currentSeek","forwardTo","rewind","backwardTo","mute","updateMutedTracks","trackId","muted","solo","updateSoloTracks","soloing","selectToRecord","updatedTrackId","selected","setSelectedTrack","_onSelect","option","label","url","takes","s3_info","selectedTake","s3URL","document","getElementById","onloadedmetadata","updateTrackTimesInMillis","clickThreeDotsMenu","e","threeDotsAnchorElement","currentTarget","closeThreeDotsMenu","target","innerText","click","renameTrack","trackName","deleteTrack","realignTake","latestTake","claimedBy","Object","keys","length","latestKey","pop","deleteTake","bind","this","prevProps","selectedTrackId","masterPlay","masterRecord","masterStop","soloTracks","Math","min","targetTake","takeInfo","d","Date","formattedDateTime","toLocaleString","name","Confirm","id","newSelectedTake","takeCopy","splice","indexOf","max","apply","newURL","buttonSelectText","selectedKeyValue","takeDropdownOptions","reduce","acc","take","parseInt","rawDate","push","reverse","marginLeft","backgroundColor","padding","borderLeft","marginBottom","fontWeight","color","display","title","onClick","height","cursor","disabled","IconButton","aria-label","aria-controls","aria-haspopup","type","hidden","onChange","handleFileUpload","files","Menu","anchorEl","keepMounted","open","onClose","PaperProps","maxHeight","width","map","MenuItem","Tooltip","arrow","disableRipple","fontSize","defaultValue","src","preload","autobuffer","flex","placeholder","method","action","Component","LoadingGif","marginRight","alt","text","Crunker","sampleRate","_sampleRate","_context","_createContext","window","AudioContext","webkitAudioContext","mozAudioContext","filepaths","filepath","File","arrayBuffer","buffer","fetch","then","response","decodeAudioData","Promise","all","buffers","output","createBuffer","_maxNumberOfChannels","_maxDuration","forEach","channelNumber","numberOfChannels","outputData","getChannelData","bufferData","i","set","_totalLength","offset","padStart","seconds","Error","updatedBuffer","channelData","subarray","source","createBufferSource","connect","destination","start","audioType","recorded","_interleave","dataview","_writeHeaders","audioBlob","Blob","blob","_renderURL","element","_renderAudioElement","filename","createElement","href","download","split","callback","_isSupported","close","b","ArrayBuffer","view","DataView","_writeString","setUint32","setUint16","_floatTo16BitPCM","tmp","setInt16","header","setUint8","charCodeAt","input","result","Float32Array","index","inputIndex","audio","controls","URL","webkitURL","createObjectURL","AlignRecordingModalContent","dialog","useDialog","useState","isPlaying","setPlaying","playbackTimer","setPlaybackTimer","delayPlaybackTimer","setDelayPlaybackTimer","bgWaveSurfer","setBgWaveSurfer","recWaveSurfer","setRecWaveSurfer","loadedAudio","setLoadedAudio","dragOffset","setDragOffset","latencyMagnitude","setLatencyMagnitude","onStopDrag","useCallback","_","position","x","latency","useEffect","WaveSurfer","create","container","waveColor","progressColor","cursorColor","cursorWidth","interact","hideScrollbar","isOpen","crunker","backingTrackURLs","fetchAudio","mergeAudio","merged","export","load","recordedURL","setVolume","zoom","className","axis","bounds","left","right","onStop","hasCountdownLatency","clearTimeout","params","scrollParent","seekTo","seekAndCenter","getDuration","round","WebAudioRecorder","DAW","beginGroupPlayListener","toggleMasterPlay","requestingGroupPlayback","preparedGroupAction","withGroup","beginGroupStopListener","data","projectName","receivedImmediateStop","stopped_by","username","Alert","toggleMasterStop","requestingGroupRecord","numGroupMembersPrepared","beginGroupRecordListener","toggleMasterRecord","updateNumPreparedListener","num_prepared","notifyWaitingGroupMember","requester","requestGroupPlay","requestGroupRecord","updateClaimedTracksListener","newClaimedTrackIds","assign","claimedTrackIds","track_id","claimed_by","retrieveCurrentClaimedTracksListener","completeClaimedTrackIds","resetGroupControls","createTrack","createTake","file","is_manual_upload","take_number","take_id","startTime","now","runningTime","timer","setInterval","startMicrophone","audioContext","navigator","mediaDevices","getUserMedia","stream","gumStream","createMediaStreamSource","recorder","workerDir","encoding","numChannels","setOptions","timeLimit","encodeAfterRecord","mp3","bitRate","onComplete","getAudioTracks","stopMicrophone","startRecording","findNonRecordedTrackURLs","targetTrackId","nonRecordedTrackURLs","trackMetadata","filter","includes","mutedTracks","takeId","stopMicProcessing","numTotalTracks","alreadyAligning","CustomDialog","isCanClose","isRecording","targetId","test","newId","socket","emit","channel","projectHash","formattedTime","ms","minutes","floor","toFixed","newSoloTracks","newMutedTracks","rehearse","isRehearsing","downloadMixedTrack","latestTakeURLs","link","datestring","getFullYear","getMonth","getDate","timestring","getHours","getMinutes","outputFilename","setAttribute","body","appendChild","parentNode","removeChild","shouldPlay","requestImmediateGroupPlay","requestGroupStop","user","shouldRecord","requestImmediateGroupRecord","cancelRequest","realignTrackId","takeURL","trackTimeInSecs","newTrackTimes","trackTimesInMillis","isBlocked","showCountdown","initialLoad","JSON","parse","getItem","catch","on","numOnlineUsers","maxTime","values","off","clearInterval","finishRecording","otherMembersOnline","totalTakes","accumulator","claimedTrackIdsKeys","trackTimes","trackInfo","trackOwner","find","key","undefined","track_name","claimedTracks","colors","size","remainingTime","Project","updateOnlineUsersListener","user_list","onlineUsers","updateProjectListener","refresh","retrieveProject","project_hash","URLSearchParams","resp","json","status","obj","tracks","item","formatted_takes","date_uploaded","project_name","group_name","group","project_id","track_metadata","location","pathname","isCreatingTake","isDeletingTakeOrTrack","userDetails","Prompt","formData","FormData","append","updatedTracks","projectId","new_name","getTimezoneOffset","timestamp","toString","pathSuffix","placement","Home","authed","RENAME_PROJECT_OPTION","DELETE_PROJECT_OPTION","history","useHistory","setThreeDotsAnchorElement","renameProject","project","deleteProject","group_id","Group","renameGroup","deleteGroup","projects","createNewProject","concat","updatedProjects","projectInfo","sortedProjects","sort","Projects","updateProjectsListener","fetchGroups","groups","isLoaded","class","groupInfo","Member","removeMember","hideRemoveButton","onlyMemberInGroup","AddMemberModalContent","newUserId","setNewUserId","newUserName","setNewUserName","userDropdownOptions","users","toLowerCase","userid","RENAME_GROUP_OPTION","DELETE_GROUP_OPTION","group_membership","addMember","all_users","showCloseIcon","newMemberInfo","newUsername","updatedMembership","Groups","updateGroupsListener","createNewGroup","updatedGroups","PrivateRoute","component","rest","render","to","from","io","ROOT_URL","createHashHistory","App","handleSuccessfulLogin","profileObj","googleId","email","message","stringify","isUserLoggedIn","handleSuccessfulLogout","clear","err","replace","prevState","top","givenName","exact","path","ReactDOM"],"mappings":"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","file":"static/js/main.42220ee7.chunk.js","sourcesContent":["// source: https://github.com/Sivanesh-S/react-google-authentication/blob/master/src/components/Login.js\n\nimport React from \"react\";\n\nimport { GoogleLogin } from \"react-google-login\";\nimport { refreshTokenSetup } from \"../utils/refreshToken\";\n\nfunction Login(props) {\n  const onSuccess = (res) => {\n    // console.log(\"Login Success: currentUser:\", res.profileObj);\n    refreshTokenSetup(res);\n    props.onSuccessfulLogin(res);\n  };\n\n  const onFailure = (res) => {\n    console.log(\"Attempt to login failed. Error:\", res);\n    alert(\"Login error: \" + res.error + \". \");\n  };\n\n  return (\n    <div>\n      <GoogleLogin\n        clientId={process.env.REACT_APP_GOOGLE_CLIENT_ID}\n        buttonText=\"Login\"\n        onSuccess={onSuccess}\n        onFailure={onFailure}\n        cookiePolicy={\"single_host_origin\"}\n        style={{ marginTop: \"100px\" }}\n        isSignedIn={true}\n      />\n    </div>\n  );\n}\n\nexport default Login;\n","// source: https://github.com/Sivanesh-S/react-google-authentication/blob/master/src/utils/refreshToken.js\n\nexport const refreshTokenSetup = (res) => {\n  // Timing to renew access token\n  let refreshTiming = (res.tokenObj.expires_in || 3600 - 5 * 60) * 1000;\n\n  const refreshToken = async () => {\n    const newAuthRes = await res.reloadAuthResponse();\n    refreshTiming = (newAuthRes.expires_in || 3600 - 5 * 60) * 1000;\n    console.log(\"newAuthRes:\", newAuthRes);\n    // saveUserToken(newAuthRes.access_token);  <-- save new token\n    localStorage.setItem(\"authToken\", newAuthRes.id_token);\n\n    // Setup the other timer after the first one\n    setTimeout(refreshToken, refreshTiming);\n  };\n\n  // Setup first refresh timer\n  setTimeout(refreshToken, refreshTiming);\n};\n","import React from \"react\";\nimport { GoogleLogout } from \"react-google-login\";\n\nfunction Logout(props) {\n  const onSuccess = () => {\n    // console.log('Logged out successfully');\n    // alert(\"Logged out successfully \");\n    props.onSuccessfulLogout();\n  };\n\n  return (\n    <div>\n      <GoogleLogout\n        clientId={process.env.REACT_APP_GOOGLE_CLIENT_ID}\n        buttonText=\"Logout\"\n        onLogoutSuccess={onSuccess}\n      ></GoogleLogout>\n    </div>\n  );\n}\n\nexport default Logout;\n","import React, { Component } from \"react\";\nimport Dropdown from \"react-dropdown\";\nimport \"react-dropdown/style.css\";\nimport { Confirm } from \"react-st-modal\"; // https://github.com/Nodlik/react-st-modal\nimport Slider from \"rc-slider\";\nimport \"rc-slider/assets/index.css\";\n\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport MoreHorizIcon from \"@material-ui/icons/MoreHoriz\";\nimport HeadsetRoundedIcon from \"@material-ui/icons/HeadsetRounded\";\nimport VolumeOffRoundedIcon from \"@material-ui/icons/VolumeOffRounded\";\nimport GetAppRoundedIcon from \"@material-ui/icons/GetAppRounded\";\nimport DeleteRoundedIcon from \"@material-ui/icons/DeleteRounded\";\n\nconst REALIGN_OPTION = \"Realign Take\";\nconst RENAME_TRACK_OPTION = \"Rename Part\";\nconst DELETE_TRACK_OPTION = \"Delete Part\";\nconst FILE_UPLOAD_OPTION = \"+ Upload File\";\n\nconst options = [\n  DELETE_TRACK_OPTION,\n  REALIGN_OPTION,\n  RENAME_TRACK_OPTION,\n  FILE_UPLOAD_OPTION,\n];\n\nclass Track extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selected: false,\n      playing: false,\n      muted: false,\n      s3URL: null,\n      selectedTake: null,\n      latestTake: 0,\n      soloing: false,\n      volume: 84.95,\n      threeDotsAnchorElement: null,\n      claimedBy: null,\n    };\n    this.audioFile = null;\n    if (Object.keys(props.takes).length !== 0) {\n      const latestKey = Object.keys(props.takes).pop();\n      const url = props.takes[latestKey].s3_info;\n      if (url) {\n        this.state.s3URL = url;\n        this.state.selectedTake = latestKey;\n        this.audioFile = document.getElementById(\n          `audio-file-${this.props.trackId}`\n        );\n      }\n    }\n    this.deleteTake = this.deleteTake.bind(this);\n  }\n\n  componentDidMount() {\n    // if this track has takes and the page refreshed, select most recent take\n    if (Object.keys(this.props.takes).length !== 0) {\n      const latestKey = Object.keys(this.props.takes).pop();\n      const url = this.props.takes[latestKey].s3_info;\n      if (url) {\n        this.setState({\n          s3URL: url,\n          selectedTake: latestKey,\n          latestTake: latestKey,\n        });\n        this.audioFile = document.getElementById(\n          `audio-file-${this.props.trackId}`\n        );\n        this.audioFile.onloadedmetadata = () => {\n          const duration = this.audioFile.duration;\n          console.log(\"track duration\", duration);\n          this.props.updateTrackTimesInMillis(this.props.trackId, duration);\n        };\n      }\n      // otherwise reset the take state\n    } else {\n      this.setState({\n        selectedTake: null,\n        s3URL: null,\n        latestTake: 0,\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    // set audio file\n    if (this.state.s3URL && this.audioFile === null) {\n      this.audioFile = document.getElementById(\n        `audio-file-${this.props.trackId}`\n      );\n      this.audioFile.onloadedmetadata = () => {\n        const duration = this.audioFile.duration;\n        console.log(\"track duration\", duration);\n        this.props.updateTrackTimesInMillis(this.props.trackId, duration);\n      };\n    } else if (this.state.s3URL === null && this.audioFile !== null) {\n      this.audioFile = null;\n      console.log(\"track duration is 0\");\n      this.props.updateTrackTimesInMillis(this.props.trackId, 0);\n    }\n\n    // unselect selected track if a different track is selected\n    if (\n      this.state.selected &&\n      this.props.selectedTrackId !== this.props.trackId\n    ) {\n      this.setState({ selected: false });\n    }\n\n    if (prevProps.claimedBy !== this.props.claimedBy) {\n      this.setState({ claimedBy: this.props.claimedBy });\n    }\n\n    // if no take is currently selected and # of states updated\n    if (\n      (this.state.selectedTake === null ||\n        this.state.latestTake !== Object.keys(this.props.takes).pop()) &&\n      Object.keys(this.props.takes).length !== 0\n    ) {\n      const latestKey = Object.keys(this.props.takes).pop();\n      const url = this.props.takes[latestKey].s3_info;\n      if (url) {\n        this.setState({\n          latestTake: latestKey,\n          selectedTake: latestKey,\n          s3URL: url,\n        });\n      }\n    } else if (Object.keys(this.props.takes).length === 0 && this.state.s3URL) {\n      this.setState({\n        selectedTake: null,\n        s3URL: null,\n        latestTake: 0,\n      });\n    }\n\n    // play non-selected track during recording or stop if DAW master controls indicate\n    if (\n      this.props.masterPlay &&\n      this.audioFile &&\n      !this.state.playing &&\n      (!this.state.selected ||\n        (this.state.selected && !this.props.masterRecord))\n    ) {\n      console.log(\n        `[TRACK: ${this.props.trackName}] playing: ${this.state.s3URL}`\n      );\n      this.audioFile.currentTime = 0;\n      this.audioFile.play();\n      this.setState({ playing: true });\n    } else if (this.props.masterStop && this.audioFile && this.state.playing) {\n      this.audioFile.pause();\n      this.setState({ playing: false });\n    }\n\n    // update soloing\n    if (\n      !this.state.soloing &&\n      this.props.soloTracks.length !== 0 &&\n      !this.state.muted &&\n      this.state.s3URL\n    ) {\n      this.audioFile.muted = true;\n      this.setState({\n        muted: true,\n      });\n    } else if (\n      this.props.soloTracks.length === 0 &&\n      this.state.muted &&\n      this.state.s3URL &&\n      prevProps.soloTracks.length !== 0\n    ) {\n      this.audioFile.muted = false;\n      this.setState({\n        muted: false,\n      });\n    }\n\n    if (\n      this.state.s3URL &&\n      prevProps.masterVolume !== this.props.masterVolume\n    ) {\n      this.audioFile.volume = Math.min(1, this.props.masterVolume);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.audioFile) {\n      this.audioFile.pause();\n    }\n  }\n\n  // playPauseAudio = () => {\n  //   if (this.state.playing) {\n  //     this.audioFile.pause();\n  //     this.setState({ playing: false });\n  //   } else {\n  //     this.audioFile.play();\n  //     this.setState({ playing: true });\n  //   }\n  // };\n\n  stop = () => {\n    this.audioFile.currentTime = 0;\n    this.audioFile.pause();\n    this.setState({ playing: false });\n  };\n\n  changeVolume = (value) => {\n    const volume = value;\n    this.audioFile.volume = (this.props.masterVolume / 100) * volume;\n    this.setState({ volume: volume });\n  };\n\n  seek = (value) => {\n    this.audioFile.currentTime = value;\n    this.audioFile.pause();\n    if (this.state.playing) {\n      this.audioFile.play();\n    }\n  };\n\n  fastForward = () => {\n    this.audioFile.pause();\n    const duration = this.audioFile.duration;\n    const currentSeek = this.audioFile.currentTime;\n    const forwardTo = currentSeek + 5;\n    if (forwardTo >= duration) {\n      this.audioFile.currentTime = 0;\n      this.audioFile.pause();\n      return;\n    }\n    console.log(\"ff: \" + currentSeek + \" -> \" + forwardTo);\n    this.audioFile.currentTime = forwardTo;\n    if (this.state.playing) {\n      this.audioFile.play();\n    }\n  };\n\n  rewind = () => {\n    this.audioFile.pause();\n    const currentSeek = this.audioFile.currentTime;\n    let backwardTo = currentSeek - 5;\n    if (backwardTo <= 0) {\n      backwardTo = 0;\n    }\n    console.log(\"rewind: \" + currentSeek + \" -> \" + backwardTo);\n    this.audioFile.currentTime = backwardTo;\n    if (this.state.playing) {\n      this.audioFile.play();\n    }\n  };\n\n  mute = () => {\n    this.props.updateMutedTracks(this.props.trackId);\n    this.audioFile.muted = !this.state.muted;\n    this.setState({\n      muted: !this.state.muted,\n    });\n  };\n\n  solo = () => {\n    this.props.updateSoloTracks(this.props.trackId);\n    if (!this.state.soloing) {\n      this.audioFile.muted = false;\n      this.setState({\n        soloing: true,\n        muted: false,\n      });\n    } else {\n      this.setState({\n        soloing: false,\n      });\n    }\n  };\n\n  selectToRecord = () => {\n    const updatedTrackId = !this.state.selected ? this.props.trackId : null;\n    this.props.setSelectedTrack(updatedTrackId);\n    this.setState({ selected: !this.state.selected });\n  };\n\n  _onSelect = (option) => {\n    console.log(\"Selected \" + option.label);\n    this.audioFile.currentTime = 0;\n    this.audioFile.pause();\n    const url = this.props.takes[option.value].s3_info;\n    this.setState({\n      playing: false,\n      selectedTake: option.value,\n      s3URL: url,\n    });\n    this.audioFile = document.getElementById(\n      `audio-file-${this.props.trackId}`\n    );\n    this.audioFile.onloadedmetadata = () => {\n      const duration = this.audioFile.duration;\n      console.log(\"track duration\", duration);\n      this.props.updateTrackTimesInMillis(this.props.trackId, duration);\n    };\n  };\n\n  async deleteTake() {\n    console.log(\"deleting take\");\n    const targetTake = this.state.selectedTake;\n    const takeInfo = this.props.takes[targetTake];\n    const d = new Date(takeInfo[\"date_uploaded\"]);\n    const formattedDateTime = d.toLocaleString(\"en-US\");\n\n    const name = `Take ${targetTake} - ${formattedDateTime}`;\n    const result = await Confirm(\n      `Are you sure you want to delete \"${name}\"?`,\n      \"Delete Take\"\n    );\n    if (result) {\n      if (this.audioFile) {\n        this.audioFile.currentTime = 0;\n        this.audioFile.pause();\n      }\n      await this.props.deleteTake(this.props.trackId, targetTake, takeInfo.id);\n\n      let newSelectedTake = null;\n      if (Object.keys(this.props.takes).length > 1) {\n        const takeCopy = Object.keys(this.props.takes);\n        takeCopy.splice(takeCopy.indexOf(targetTake), 1);\n        newSelectedTake = Math.max.apply(Math, takeCopy);\n        const newURL = this.props.takes[newSelectedTake].s3_info;\n        this.setState({\n          playing: false,\n          selectedTake: newSelectedTake,\n          s3URL: newURL,\n          latestTake: newSelectedTake,\n        });\n      } else {\n        console.log(\"unsetting audio file\");\n        this.setState({\n          playing: false,\n          selectedTake: newSelectedTake,\n          s3URL: null,\n          latestTake: 0,\n        });\n      }\n    }\n  }\n\n  clickThreeDotsMenu = (e) => {\n    this.setState({ threeDotsAnchorElement: e.currentTarget });\n  };\n\n  closeThreeDotsMenu = (e) => {\n    const option = e.target.innerText;\n    if (option === FILE_UPLOAD_OPTION) {\n      document.getElementById(`file-upload-${this.props.trackId}`).click();\n    } else if (option === RENAME_TRACK_OPTION) {\n      this.props.renameTrack(this.props.trackId, this.props.trackName);\n    } else if (option === DELETE_TRACK_OPTION) {\n      this.props.deleteTrack(this.props.trackId, this.props.trackName);\n    } else if (option === REALIGN_OPTION) {\n      this.props.realignTake(this.props.trackId, this.state.s3URL);\n    }\n    this.setState({ threeDotsAnchorElement: null });\n  };\n\n  render() {\n    let selectedKeyValue = { value: this.state.selectedTake };\n    const takeDropdownOptions = Object.keys(this.props.takes)\n      .reduce((acc, take) => {\n        if (parseInt(take) <= parseInt(this.state.latestTake)) {\n          const rawDate = this.props.takes[take][\"date_uploaded\"];\n          const d = new Date(rawDate);\n          const formattedDateTime = d.toLocaleString(\"en-US\");\n          if (take === this.state.selectedTake) {\n            selectedKeyValue[\"label\"] = `Take ${take} - ${formattedDateTime}`;\n          }\n          acc.push({\n            value: take,\n            label: `Take ${take} - ${formattedDateTime}`,\n          });\n        }\n        return acc;\n      }, [])\n      .reverse();\n\n    let buttonSelectText;\n    if (this.state.claimedBy !== null) {\n      buttonSelectText = `Selected by ${this.state.claimedBy}`;\n    } else {\n      buttonSelectText = this.state.selected ? \"Unselect\" : \"Select to Record\";\n    }\n\n    return (\n      <div style={{ marginLeft: \"5px\" }}>\n        <hr />\n        <div\n          style={\n            this.state.selected\n              ? {\n                  backgroundColor: \"#eee\",\n                  padding: \"1px 12px\",\n                  borderLeft: \"4px solid #2153c9\",\n                  marginBottom: \"15px\",\n                  fontWeight: \"bold\",\n                }\n              : this.state.claimedBy !== null\n              ? {\n                  backgroundColor: \"#f6f6f6\",\n                  color: \"#a8a8a8\",\n                  padding: \"1px 12px\",\n                  borderLeft: \"4px solid #d1e0f8\",\n                  marginBottom: \"15px\",\n                }\n              : { marginBottom: \"17px\" }\n          }\n        >\n          <div style={{ display: \"inline-block\" }}>\n            Part: {this.props.trackName}{\" \"}\n          </div>\n          <button\n            title=\"Select/unselect track for recording\"\n            onClick={this.selectToRecord}\n            style={\n              this.state.claimedBy === null\n                ? { marginLeft: \"10px\", height: \"25px\", cursor: \"pointer\" }\n                : { marginLeft: \"10px\", height: \"25px\" }\n            }\n            disabled={this.state.claimedBy !== null}\n          >\n            {buttonSelectText}\n          </button>\n          <IconButton\n            aria-label=\"more\"\n            aria-controls=\"track-menu\"\n            aria-haspopup=\"true\"\n            onClick={this.clickThreeDotsMenu}\n            style={{ marginLeft: \"2px\" }}\n          >\n            <MoreHorizIcon />\n          </IconButton>\n          <input\n            type=\"file\"\n            id={`file-upload-${this.props.trackId}`}\n            hidden\n            onChange={(e) => {\n              this.props.handleFileUpload(e.target.files, this.props.trackId);\n            }}\n          />\n          <Menu\n            id=\"track-menu\"\n            anchorEl={this.state.threeDotsAnchorElement}\n            keepMounted\n            open={this.state.threeDotsAnchorElement !== null}\n            onClose={this.closeThreeDotsMenu}\n            PaperProps={{\n              style: {\n                maxHeight: 40 * 4.5,\n                width: \"20ch\",\n              },\n            }}\n          >\n            {options.map((option) => (\n              <MenuItem key={option} onClick={this.closeThreeDotsMenu}>\n                {option}\n              </MenuItem>\n            ))}\n          </Menu>\n        </div>\n        {this.state.s3URL && Object.keys(this.props.takes).length > 0 && (\n          <div\n            style={{\n              display: \"flex\",\n              marginBottom: \"10px\",\n            }}\n          >\n            <div style={{ marginTop: \"-13px\" }}>\n              <Tooltip title=\"Solo\" arrow>\n                <IconButton\n                  disableRipple\n                  aria-label=\"Solo this track\"\n                  onClick={this.solo}\n                >\n                  {this.state.soloing ? (\n                    <HeadsetRoundedIcon\n                      style={{ fontSize: 20 }}\n                      color=\"secondary\"\n                    />\n                  ) : (\n                    <HeadsetRoundedIcon style={{ fontSize: 20 }} />\n                  )}\n                </IconButton>\n              </Tooltip>\n            </div>\n            <div style={{ marginTop: \"-14px\" }}>\n              <Tooltip title=\"Mute\" arrow>\n                <IconButton\n                  disableRipple\n                  aria-label=\"Mute this track\"\n                  onClick={this.mute}\n                >\n                  {this.state.muted ? (\n                    <VolumeOffRoundedIcon\n                      style={{ fontSize: 20 }}\n                      color=\"secondary\"\n                    />\n                  ) : (\n                    <VolumeOffRoundedIcon style={{ fontSize: 20 }} />\n                  )}\n                </IconButton>\n              </Tooltip>\n            </div>\n            <div\n              style={{\n                width: \"55px\",\n              }}\n            >\n              <Slider\n                min={0}\n                max={100}\n                defaultValue={100}\n                onChange={this.changeVolume}\n              />\n            </div>\n\n            <audio\n              id={`audio-file-${this.props.trackId}`}\n              src={`${this.state.s3URL}?cacheblock=true`}\n              preload=\"auto\"\n              autobuffer=\"true\"\n            />\n\n            <div\n              style={{\n                flex: \"0 1 300px\",\n                marginLeft: \"25px\",\n                marginTop: \"-8px\",\n              }}\n            >\n              <Dropdown\n                options={takeDropdownOptions}\n                onChange={this._onSelect}\n                value={selectedKeyValue}\n                placeholder=\"Select an option\"\n              />\n            </div>\n            <div\n              style={{\n                flex: \"0 0 20px\",\n                marginLeft: \"10px\",\n                marginTop: \"-14px\",\n              }}\n            >\n              <form method=\"get\" action={`${this.state.s3URL}?cacheblock=true`}>\n                <Tooltip title=\"Download take\" arrow>\n                  <IconButton\n                    disableRipple\n                    aria-label=\"Download this take\"\n                    type=\"submit\"\n                  >\n                    <GetAppRoundedIcon style={{ fontSize: 23 }} />\n                  </IconButton>\n                </Tooltip>\n              </form>\n            </div>\n            <div style={{ marginTop: \"-15px\" }}>\n              <Tooltip title=\"Delete take\" arrow>\n                <IconButton\n                  disableRipple\n                  aria-label=\"Delete this take\"\n                  onClick={this.deleteTake}\n                  disabled={this.props.masterPlay}\n                >\n                  <DeleteRoundedIcon style={{ fontSize: 22 }} />\n                </IconButton>\n              </Tooltip>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default Track;\n","import React, { Component } from \"react\";\n\nclass LoadingGif extends Component {\n  render() {\n    return (\n      <div style={{ display: \"flex\", marginBottom: \"-8px\" }}>\n        <img\n          style={{\n            marginLeft: \"10px\",\n            marginRight: \"5px\",\n            marginTop: \"10px\",\n          }}\n          src=\"images/daw/loading.gif\"\n          alt=\"loading\"\n          width=\"32\"\n          height=\"32\"\n        />\n\n        <p>{` ${this.props.text}`}</p>\n      </div>\n    );\n  }\n}\n\nexport default LoadingGif;\n","\"use strict\";\n\nexport default class Crunker {\n  constructor({ sampleRate = 44100 } = {}) {\n    this._sampleRate = sampleRate;\n    this._context = this._createContext();\n  }\n\n  _createContext() {\n    window.AudioContext =\n      window.AudioContext ||\n      window.webkitAudioContext ||\n      window.mozAudioContext;\n    console.log(\"setting audio context to \" + this._sampleRate);\n    return new AudioContext({ sampleRate: this._sampleRate });\n  }\n\n  async fetchAudio(...filepaths) {\n    const files = filepaths.map(async (filepath) => {\n      let buffer;\n\n      if (filepath instanceof File) {\n        buffer = await filepath.arrayBuffer();\n      } else {\n        buffer = await fetch(filepath).then((response) =>\n          response.arrayBuffer()\n        );\n      }\n      console.log(\"decoding audio context with \" + this._context.sampleRate);\n      return await this._context.decodeAudioData(buffer);\n    });\n    return await Promise.all(files);\n  }\n\n  mergeAudio(buffers) {\n    const output = this._context.createBuffer(\n      this._maxNumberOfChannels(buffers),\n      this._sampleRate * this._maxDuration(buffers),\n      this._sampleRate\n    );\n\n    buffers.forEach((buffer) => {\n      for (\n        let channelNumber = 0;\n        channelNumber < buffer.numberOfChannels;\n        channelNumber += 1\n      ) {\n        const outputData = output.getChannelData(channelNumber);\n        const bufferData = buffer.getChannelData(channelNumber);\n\n        for (\n          let i = buffer.getChannelData(channelNumber).length - 1;\n          i >= 0;\n          i -= 1\n        ) {\n          outputData[i] += bufferData[i];\n        }\n\n        output.getChannelData(channelNumber).set(outputData);\n      }\n    });\n    return output;\n  }\n\n  concatAudio(buffers) {\n    const output = this._context.createBuffer(\n      this._maxNumberOfChannels(buffers),\n      this._totalLength(buffers),\n      this._sampleRate\n    );\n    let offset = 0;\n\n    buffers.forEach((buffer) => {\n      for (\n        let channelNumber = 0;\n        channelNumber < buffer.numberOfChannels;\n        channelNumber += 1\n      ) {\n        output\n          .getChannelData(channelNumber)\n          .set(buffer.getChannelData(channelNumber), offset);\n      }\n\n      offset += buffer.length;\n    });\n    return output;\n  }\n\n  padAudio(buffer, padStart = 0, seconds = 0) {\n    if (seconds === 0) return buffer;\n    if (padStart < 0)\n      throw new Error(\n        'Crunker: Parameter \"padStart\" in padAudio must be positive'\n      );\n    if (seconds < 0)\n      throw new Error(\n        'Crunker: Parameter \"seconds\" in padAudio must be positive'\n      );\n\n    const updatedBuffer = this._context.createBuffer(\n      buffer.numberOfChannels,\n      buffer.length + seconds * buffer.sampleRate,\n      buffer.sampleRate\n    );\n\n    for (\n      let channelNumber = 0;\n      channelNumber < buffer.numberOfChannels;\n      channelNumber += 1\n    ) {\n      const channelData = buffer.getChannelData(channelNumber);\n      updatedBuffer\n        .getChannelData(channelNumber)\n        .set(channelData.subarray(0, padStart * buffer.sampleRate + 1), 0);\n\n      updatedBuffer\n        .getChannelData(channelNumber)\n        .set(\n          channelData.subarray(\n            padStart * buffer.sampleRate + 2,\n            updatedBuffer.length + 1\n          ),\n          (padStart + seconds) * buffer.sampleRate\n        );\n    }\n\n    return updatedBuffer;\n  }\n\n  play(buffer) {\n    const source = this._context.createBufferSource();\n    source.buffer = buffer;\n    source.connect(this._context.destination);\n    source.start();\n    return source;\n  }\n\n  export(buffer, audioType) {\n    const type = audioType || \"audio/mp3\";\n    const recorded = this._interleave(buffer);\n    const dataview = this._writeHeaders(recorded);\n    const audioBlob = new Blob([dataview], { type: type });\n\n    return {\n      blob: audioBlob,\n      url: this._renderURL(audioBlob),\n      element: this._renderAudioElement(audioBlob, type),\n    };\n  }\n\n  download(blob, filename) {\n    const name = filename || \"crunker\";\n    const a = document.createElement(\"a\");\n    a.style = \"display: none\";\n    a.href = this._renderURL(blob);\n    a.download = `${name}.${blob.type.split(\"/\")[1]}`;\n    a.click();\n    return a;\n  }\n\n  notSupported(callback) {\n    return !this._isSupported() && callback();\n  }\n\n  close() {\n    this._context.close();\n    return this;\n  }\n\n  _maxDuration(buffers) {\n    return Math.max.apply(\n      Math,\n      buffers.map((buffer) => buffer.duration)\n    );\n  }\n\n  _maxNumberOfChannels(buffers) {\n    return Math.max.apply(\n      Math,\n      buffers.map((buffer) => buffer.numberOfChannels)\n    );\n  }\n\n  _totalLength(buffers) {\n    return buffers.map((buffer) => buffer.length).reduce((a, b) => a + b, 0);\n  }\n\n  _isSupported() {\n    return \"AudioContext\" in window;\n  }\n\n  _writeHeaders(buffer) {\n    let arrayBuffer = new ArrayBuffer(44 + buffer.length * 2),\n      view = new DataView(arrayBuffer);\n\n    this._writeString(view, 0, \"RIFF\");\n    view.setUint32(4, 32 + buffer.length * 2, true);\n    this._writeString(view, 8, \"WAVE\");\n    this._writeString(view, 12, \"fmt \");\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, 2, true);\n    view.setUint32(24, this._sampleRate, true);\n    view.setUint32(28, this._sampleRate * 4, true);\n    view.setUint16(32, 4, true);\n    view.setUint16(34, 16, true);\n    this._writeString(view, 36, \"data\");\n    view.setUint32(40, buffer.length * 2, true);\n\n    return this._floatTo16BitPCM(view, buffer, 44);\n  }\n\n  _floatTo16BitPCM(dataview, buffer, offset) {\n    for (var i = 0; i < buffer.length; i++, offset += 2) {\n      let tmp = Math.max(-1, Math.min(1, buffer[i]));\n      dataview.setInt16(offset, tmp < 0 ? tmp * 0x8000 : tmp * 0x7fff, true);\n    }\n    return dataview;\n  }\n\n  _writeString(dataview, offset, header) {\n    let output;\n    for (var i = 0; i < header.length; i++) {\n      dataview.setUint8(offset + i, header.charCodeAt(i));\n    }\n  }\n\n  _interleave(input) {\n    let buffer = input.getChannelData(0),\n      length = buffer.length * 2,\n      result = new Float32Array(length),\n      index = 0,\n      inputIndex = 0;\n\n    while (index < length) {\n      result[index++] = buffer[inputIndex];\n      result[index++] = buffer[inputIndex];\n      inputIndex++;\n    }\n    return result;\n  }\n\n  _renderAudioElement(blob, type) {\n    const audio = document.createElement(\"audio\");\n    audio.controls = \"controls\";\n    audio.type = type;\n    audio.src = this._renderURL(blob);\n    return audio;\n  }\n\n  _renderURL(blob) {\n    return (window.URL || window.webkitURL).createObjectURL(blob);\n  }\n}\n","import {\n  useDialog,\n  ModalContent,\n  ModalFooter,\n  ModalButton,\n  Confirm,\n} from \"react-st-modal\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport \"./AlignRecording.css\";\nimport LoadingGif from \"./LoadingGif\";\nimport WaveSurfer from \"wavesurfer.js\";\nimport Draggable from \"react-draggable\";\n// import Crunker from \"crunker\"; // https://github.com/jackedgson/crunker\nimport Crunker from \"./crunker\";\n\nimport VolumeMuteRoundedIcon from \"@material-ui/icons/VolumeMuteRounded\";\nimport VolumeDownRoundedIcon from \"@material-ui/icons/VolumeUpRounded\";\nimport Slider from \"rc-slider\";\nimport \"rc-slider/assets/index.css\";\n\nexport default function AlignRecordingModalContent(props) {\n  const dialog = useDialog();\n\n  const [isPlaying, setPlaying] = useState(false);\n  const [playbackTimer, setPlaybackTimer] = useState(null);\n  const [delayPlaybackTimer, setDelayPlaybackTimer] = useState(null);\n  const [bgWaveSurfer, setBgWaveSurfer] = useState(null);\n  const [recWaveSurfer, setRecWaveSurfer] = useState(null);\n  const [loadedAudio, setLoadedAudio] = useState(false);\n  // const [mixedBackingTrackURL, setMixedBackingTrackURL] = useState(null);\n\n  const [dragOffset, setDragOffset] = useState(0);\n  const [latencyMagnitude, setLatencyMagnitude] = useState(0);\n\n  const onStopDrag = useCallback((_, position) => {\n    console.log(\"stopped:\", position.x);\n    const latency = 12.5053 * position.x + 7.3617;\n    console.log(latency);\n    setDragOffset(position.x);\n    setLatencyMagnitude(latency);\n  }, []);\n\n  const bgChangeVolume = (value) => {\n    bgWaveSurfer.setVolume(value / 100);\n  };\n\n  const recChangeVolume = (value) => {\n    recWaveSurfer.setVolume(value / 100);\n  };\n\n  useEffect(() => {\n    setBgWaveSurfer(\n      WaveSurfer.create({\n        container: \"#bg_waveform\",\n        waveColor: \"#D9DCFF\",\n        progressColor: \"#4353ff\",\n        cursorColor: \"#4353ff\",\n        cursorWidth: 1,\n        height: 200,\n        width: 1000,\n        interact: false,\n        hideScrollbar: true,\n      })\n    );\n    setRecWaveSurfer(\n      WaveSurfer.create({\n        container: \"#rec_waveform\",\n        waveColor: \"#D9DCFF\",\n        progressColor: \"#4353ff\",\n        cursorColor: \"#4353ff\",\n        cursorWidth: 1,\n        height: 200,\n        width: 1000,\n        interact: false,\n        hideScrollbar: true,\n      })\n    );\n  }, []);\n\n  useEffect(() => {\n    if (bgWaveSurfer && recWaveSurfer && dialog && !dialog.isOpen) {\n      bgWaveSurfer.stop();\n      recWaveSurfer.stop();\n    }\n  }, [bgWaveSurfer, recWaveSurfer, loadedAudio, dialog]);\n\n  useEffect(() => {\n    if (bgWaveSurfer && recWaveSurfer && !loadedAudio) {\n      const crunker = new Crunker();\n      let backingTrackURLs = props.backingTrackURLs;\n      // only combine audio if necessary\n      if (backingTrackURLs.length > 1) {\n        console.log(\"using crunker to combine recordings\");\n        crunker\n          .fetchAudio(...backingTrackURLs)\n          .then((buffers) => {\n            // => [AudioBuffer, AudioBuffer]\n            console.log(buffers);\n            return crunker.mergeAudio(buffers);\n          })\n          .then((merged) => {\n            // => AudioBuffer\n            console.log(merged);\n            return crunker.export(merged, \"audio/mp3\");\n          })\n          .then((output) => {\n            // => {blob, element, url}\n            bgWaveSurfer.load(output.url);\n            recWaveSurfer.load(props.recordedURL);\n\n            bgWaveSurfer.setVolume(0.3);\n            recWaveSurfer.setVolume(0.3);\n\n            bgWaveSurfer.zoom(80);\n            recWaveSurfer.zoom(80);\n            setLoadedAudio(true);\n          });\n      } else {\n        console.log(\"using single track as backing track\");\n        bgWaveSurfer.load(backingTrackURLs[0]);\n        recWaveSurfer.load(props.recordedURL);\n\n        bgWaveSurfer.setVolume(0.3);\n        recWaveSurfer.setVolume(0.4);\n\n        bgWaveSurfer.zoom(80);\n        recWaveSurfer.zoom(80);\n        setLoadedAudio(true);\n      }\n    }\n  }, [bgWaveSurfer, recWaveSurfer, loadedAudio, props]);\n\n  return (\n    <div className=\"outerDiv\">\n      <div>\n        {loadedAudio && (\n          <Draggable axis=\"x\" bounds={{ left: -285, right: 285 }}>\n            <div className=\"ruler\"></div>\n          </Draggable>\n        )}\n        <ModalContent>\n          {!loadedAudio ? (\n            <div style={{ marginBottom: \"10px\" }}>\n              <LoadingGif text={\"Preparing alignment tool...\"} />\n            </div>\n          ) : (\n            <p>\n              Recordings in the browser are sometimes delayed. Click \"play\" to\n              check for delays, and drag your recording left/right to align it\n              with the backing tracks. Move the ruler to help you find and align\n              peaks between tracks!\n            </p>\n          )}\n          <div style={{ marginBottom: \"5px\" }}>\n            <b>Backing Tracks</b>\n            {loadedAudio && bgWaveSurfer && (\n              <div style={{ display: \"flex\" }}>\n                <VolumeMuteRoundedIcon\n                  style={{\n                    fontSize: 20,\n                    marginLeft: \"125px\",\n                    marginTop: \"-18px\",\n                  }}\n                  color=\"action\"\n                />\n                <div\n                  style={{\n                    width: \"55px\",\n                    marginLeft: \"5px\",\n                    marginTop: \"-15px\",\n                  }}\n                >\n                  <Slider\n                    min={0}\n                    max={100}\n                    defaultValue={30}\n                    onChange={bgChangeVolume}\n                  />\n                </div>\n                <VolumeDownRoundedIcon\n                  style={{\n                    fontSize: 20,\n                    marginLeft: \"12px\",\n                    marginTop: \"-18px\",\n                  }}\n                  color=\"action\"\n                />\n              </div>\n            )}\n          </div>\n          <div id=\"bg_timeline\"></div>\n          <div className=\"backingTrack\" id=\"bg_waveform\"></div>\n          <div style={{ marginBottom: \"5px\" }}>\n            <b>Recording</b>\n            {loadedAudio && recWaveSurfer && (\n              <div style={{ display: \"flex\" }}>\n                <VolumeMuteRoundedIcon\n                  style={{\n                    fontSize: 20,\n                    marginLeft: \"87px\",\n                    marginTop: \"-18px\",\n                  }}\n                  color=\"action\"\n                />\n                <div style={{ width: \"55px\", marginTop: \"-15px\" }}>\n                  <Slider\n                    min={0}\n                    max={100}\n                    defaultValue={40}\n                    onChange={recChangeVolume}\n                  />\n                </div>\n                <VolumeDownRoundedIcon\n                  style={{\n                    fontSize: 20,\n                    marginLeft: \"10px\",\n                    marginTop: \"-18px\",\n                  }}\n                  color=\"action\"\n                />\n              </div>\n            )}\n          </div>\n          <Draggable axis=\"x\" onStop={onStopDrag}>\n            <div\n              className=\"recordedTrack\"\n              id=\"rec_waveform\"\n              style={props.hasCountdownLatency ? { marginLeft: \"-240px\" } : {}}\n            />\n          </Draggable>\n        </ModalContent>\n        <ModalFooter>\n          {/* <ModalButton\n            onClick={async () => {\n              console.log(\"downloading backing track\");\n              const link = document.createElement(\"a\");\n              link.href = mixedBackingTrackURL;\n              const d = new Date();\n              const datestring = `${d.getFullYear()}_${\n                d.getMonth() + 1\n              }_${d.getDate()}`;\n              const timestring = `${d.getHours()}_${d.getMinutes()}_${d.getDate()}_${\n                d.getHours() >= 12 ? \"PM\" : \"AM\"\n              }`;\n              const outputFilename = `backingtrackmix_${datestring}-${timestring}`;\n              link.setAttribute(\"download\", outputFilename);\n\n              document.body.appendChild(link); // Append to html link element page\n              link.click(); // Start download\n              link.parentNode.removeChild(link); // Clean up and remove the link\n            }}\n            type={\"light\"}\n          >\n            Download Backing\n          </ModalButton> */}\n          <ModalButton\n            onClick={async () => {\n              // lose the dialog and return the value\n              bgWaveSurfer.stop();\n              recWaveSurfer.stop();\n              clearTimeout(playbackTimer);\n              const result = await Confirm(\n                `Are you sure you want to scrap?`,\n                props.hasCountdownLatency\n                  ? `Scrap Recording`\n                  : \"Scrap Realignment\"\n              );\n              if (result) {\n                console.log(\"scrapping recording/realignment\");\n                dialog.close(\"scrap\");\n              }\n            }}\n            type={\"danger\"}\n          >\n            {props.hasCountdownLatency\n              ? \"Scrap Recording\"\n              : \"Scrap Realignment\"}\n          </ModalButton>\n          <ModalButton\n            onClick={() => {\n              if (isPlaying) {\n                bgWaveSurfer.pause();\n                recWaveSurfer.pause();\n                clearTimeout(playbackTimer);\n                clearTimeout(delayPlaybackTimer);\n              } else {\n                console.log(\"offset:\", dragOffset);\n\n                bgWaveSurfer.params.scrollParent = false;\n                recWaveSurfer.params.scrollParent = false;\n\n                bgWaveSurfer.seekTo(0);\n                if (props.hasCountdownLatency) {\n                  recWaveSurfer.seekAndCenter(3 / recWaveSurfer.getDuration());\n                } else {\n                  recWaveSurfer.seekTo(0);\n                }\n\n                if (dragOffset > 0) {\n                  console.log(\"[recorded early]: user wants to playback later\");\n                  console.log(latencyMagnitude);\n                  setPlaybackTimer(\n                    setTimeout(() => {\n                      setPlaying(false);\n                    }, 7000)\n                  );\n                  bgWaveSurfer.play(null, 7);\n                  setDelayPlaybackTimer(\n                    setTimeout(() => {\n                      if (props.hasCountdownLatency) {\n                        recWaveSurfer.play(3, 10 - latencyMagnitude / 1000);\n                      } else {\n                        recWaveSurfer.play(0, 7 - latencyMagnitude / 1000);\n                      }\n                    }, latencyMagnitude)\n                  );\n                } else if (dragOffset < 0) {\n                  console.log(\n                    \"[recorded late]: user wants to playback earlier\"\n                  );\n                  const latency = -latencyMagnitude;\n                  console.log(latency);\n                  setPlaybackTimer(\n                    setTimeout(() => {\n                      setPlaying(false);\n                    }, 7000)\n                  );\n                  bgWaveSurfer.play(null, 7);\n                  if (props.hasCountdownLatency) {\n                    recWaveSurfer.play(3 + latency / 1000, 10 + latency / 1000);\n                  } else {\n                    recWaveSurfer.play(latency / 1000, 7 + latency / 1000);\n                  }\n                } else {\n                  setPlaybackTimer(\n                    setTimeout(() => {\n                      setPlaying(false);\n                    }, 7000)\n                  );\n                  bgWaveSurfer.play(null, 7);\n                  if (props.hasCountdownLatency) {\n                    recWaveSurfer.play(3, 10);\n                  } else {\n                    recWaveSurfer.play(null, 7);\n                  }\n                }\n              }\n              setPlaying(!isPlaying);\n            }}\n          >\n            {!isPlaying ? \"Play\" : \"Stop\"}\n          </ModalButton>\n          <ModalButton\n            onClick={() => {\n              // lose the dialog and return the value\n              bgWaveSurfer.stop();\n              recWaveSurfer.stop();\n              clearTimeout(playbackTimer);\n              console.log(\"returning value:\", latencyMagnitude);\n              dialog.close(Math.round(latencyMagnitude));\n            }}\n          >\n            Submit\n          </ModalButton>\n        </ModalFooter>\n      </div>\n    </div>\n  );\n}\n","import React, { Component } from \"react\";\nimport \"./DAW.css\";\nimport Track from \"./Track\";\nimport LoadingGif from \"./LoadingGif\";\nimport { CountdownCircleTimer } from \"react-countdown-circle-timer\";\nimport { CustomDialog, Confirm, Alert } from \"react-st-modal\"; // https://github.com/Nodlik/react-st-modal\nimport AlignRecordingModalContent from \"./AlignRecording\";\nimport Slider from \"rc-slider\";\nimport \"rc-slider/assets/index.css\";\n\nimport IconButton from \"@material-ui/core/IconButton\";\nimport PlayArrowRoundedIcon from \"@material-ui/icons/PlayArrowRounded\";\nimport StopRoundedIcon from \"@material-ui/icons/StopRounded\";\nimport FiberManualRecordRoundedIcon from \"@material-ui/icons/FiberManualRecordRounded\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport Crunker from \"crunker\";\n\nimport { socket } from \"../../../App\";\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\nconst WebAudioRecorder = window.WebAudioRecorder; // https://github.com/higuma/web-audio-recorder-js\nconst crunker = new Crunker();\n\nclass DAW extends Component {\n  constructor() {\n    super();\n    this.state = {\n      masterPlay: false,\n      masterStop: false,\n      masterRecord: false,\n      isRecording: false,\n      selectedTrackId: null, // to record\n      claimedTrackIds: {},\n      isBlocked: true,\n      showCountdown: false,\n      runningTime: 0,\n      mutedTracks: [],\n      soloTracks: [],\n      masterVolume: 0.5,\n      initialLoad: true,\n      isRehearsing: false,\n      stopMicProcessing: false,\n      requestingGroupRecord: false,\n      requestingGroupPlayback: false,\n      receivedImmediateStop: false,\n      numGroupMembersPrepared: 0,\n      preparedGroupAction: null,\n      withGroup: false,\n      alreadyAligning: false,\n      trackTimesInMillis: {},\n    };\n    this.audioContext = null;\n    this.gumStream = null;\n    this.input = null;\n    this.recorder = null;\n    this.username = JSON.parse(localStorage.getItem(\"userDetails\")).name;\n    this.toggleMasterRecord = this.toggleMasterRecord.bind(this);\n    this.toggleMasterStop = this.toggleMasterStop.bind(this);\n  }\n\n  // SOCKET IO LISTENERS:\n\n  beginGroupPlayListener = () => {\n    console.log(\"[SOCKET.IO] receiving begin group play\");\n    this.toggleMasterPlay();\n    this.setState({\n      requestingGroupPlayback: false,\n      preparedGroupAction: null,\n      withGroup: true,\n    });\n  };\n\n  beginGroupStopListener = async (data) => {\n    console.log(\n      \"[SOCKET.IO] receiving begin group stop for \" + this.props.projectName\n    );\n    if (!this.state.receivedImmediateStop) {\n      if (\n        typeof data.stopped_by === \"string\" &&\n        data.stopped_by !== this.username\n      ) {\n        if (this.state.masterRecord) {\n          await Alert(\n            `${data.stopped_by} wants to stop! Press OK when you're done recording.`,\n            `Group record stopped`\n          );\n          this.setState({ receivedImmediateStop: true, withGroup: false });\n          this.toggleMasterStop();\n        } else {\n          this.setState({ receivedImmediateStop: true, withGroup: false });\n          this.toggleMasterStop();\n          await Alert(`${data.stopped_by} stopped!`, `Group rehearsal stopped`);\n        }\n      } else {\n        this.setState({ receivedImmediateStop: true, withGroup: false });\n        this.toggleMasterStop();\n      }\n    } else {\n      console.log(\"begin group stop listener being called again..?\");\n      if (\n        typeof data.stopped_by === \"string\" &&\n        data.stopped_by !== this.username\n      ) {\n        if (this.state.masterRecord) {\n          await Alert(\n            `${data.stopped_by} wants to stop! Press OK when you're done recording.`,\n            `Group record stopped`\n          );\n          this.toggleMasterStop();\n        } else {\n          this.toggleMasterStop();\n          await Alert(\n            `${data.stopped_by} stopped!!`,\n            `Group rehearsal stopped`\n          );\n        }\n      } else {\n        this.toggleMasterStop();\n      }\n    }\n    this.setState({\n      requestingGroupRecord: false,\n      requestingGroupPlayback: false,\n      numGroupMembersPrepared: 0,\n      preparedGroupAction: null,\n    });\n  };\n\n  beginGroupRecordListener = () => {\n    console.log(\"[SOCKET.IO] receiving begin group record\");\n    this.toggleMasterRecord();\n    this.setState({\n      requestingGroupRecord: false,\n      preparedGroupAction: null,\n      withGroup: true,\n    });\n  };\n\n  updateNumPreparedListener = (data) => {\n    console.log(\"[SOCKET.IO] updating number of prepared group members\", data);\n    if (data.num_prepared === 0) {\n      // reset all group state\n      this.setState({\n        numGroupMembersPrepared: data.num_prepared,\n        preparedGroupAction: null,\n      });\n    } else {\n      this.setState({\n        numGroupMembersPrepared: data.num_prepared,\n        preparedGroupAction: data.action,\n      });\n    }\n  };\n\n  notifyWaitingGroupMember = async (data) => {\n    console.log(\n      \"[SOCKET.IO] received request from group member \" +\n        data.requester +\n        \" to request \" +\n        data.action +\n        \" | num prepared: \" +\n        data.num_prepared\n    );\n    if (\n      (data.action === \"play\" && this.state.requestingGroupPlayback) ||\n      (data.action === \"record\" && this.state.requestingGroupRecord) ||\n      data.num_prepared > 1\n    ) {\n      console.log(\"[SOCKET.IO] no need to notify me, already ready to go\");\n      return;\n    }\n    if (data.requester === null) {\n      console.log(\"disconnected client attempting to start session\");\n      alert(\n        `A group member tried to initiate \"group ${data.action}\" but their connection is faulty. Please ask them to refresh their page.`\n      );\n      return;\n    }\n    const readyToJoin = await Confirm(\n      `${data.requester} wants to group ${data.action}. Ready to join?`,\n      \"Incoming Request\",\n      \"Yes\",\n      \"No\"\n    );\n    if (readyToJoin) {\n      console.log(`[SOCKET.IO] ready to join for ${data.action}!`);\n      if (data.action === \"play\") {\n        this.requestGroupPlay();\n      } else {\n        this.requestGroupRecord();\n      }\n    } else {\n      console.log(`[SOCKET.IO] not ready to join for ${data.action}...`);\n      this.setState({ preparedGroupAction: data.action });\n    }\n  };\n\n  updateClaimedTracksListener = (data) => {\n    console.log(\"[SOCKET.IO] updating claimed tracks\", data);\n    let newClaimedTrackIds = Object.assign({}, this.state.claimedTrackIds);\n    if (data.track_id === null) {\n      delete newClaimedTrackIds[data.claimed_by];\n    } else {\n      newClaimedTrackIds[data.claimed_by] = data.track_id;\n    }\n    this.setState({\n      claimedTrackIds: newClaimedTrackIds,\n    });\n  };\n\n  retrieveCurrentClaimedTracksListener = (callback) => {\n    console.log(\n      \"[SOCKET.IO] received request to catch up new member: \",\n      this.state.claimedTrackIds\n    );\n    let completeClaimedTrackIds = Object.assign({}, this.state.claimedTrackIds);\n    completeClaimedTrackIds[this.username] = this.state.selectedTrackId;\n    callback(completeClaimedTrackIds);\n  };\n\n  // REACT MAIN FUNCTIONS:\n\n  componentDidMount() {\n    navigator.mediaDevices\n      .getUserMedia({ audio: true })\n      .then(() => {\n        console.log(\"mic permission granted\");\n        this.setState({ isBlocked: false });\n      })\n      .catch(() => {\n        console.log(\"MIC PERMISSIOM DENIED\");\n        this.setState({ isBlocked: true });\n      });\n\n    this.username = JSON.parse(localStorage.getItem(\"userDetails\")).name;\n    this.setState({\n      isRecording: false,\n      masterRecord: false,\n      selectedTrackId: null,\n      soloTracks: [],\n      mutedTracks: [],\n    });\n\n    // create socket io listeners + keyboard input (spacebar) listener\n    console.log(\n      `[SOCKET.IO] ${this.props.projectName} | creating DAW listeners for ${this.username}`\n    );\n    socket.on(\"beginGroupPlay\", this.beginGroupPlayListener);\n    socket.on(\"beginGroupStop\", this.beginGroupStopListener);\n    socket.on(\"beginGroupRecord\", this.beginGroupRecordListener);\n    socket.on(\"updateNumPrepared\", this.updateNumPreparedListener);\n    socket.on(\"notifyWaitingGroupMember\", this.notifyWaitingGroupMember);\n    socket.on(\"updateClaimedTracks\", this.updateClaimedTracksListener);\n    socket.on(\n      \"retrieveCurrentClaimedTracks\",\n      this.retrieveCurrentClaimedTracksListener\n    );\n\n    socket.emit(\"catch up new member\", { channel: this.props.projectHash });\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.state.initialLoad) {\n      if (Object.keys(this.props.trackMetadata).length === 0) {\n        this.createTrack();\n      }\n      this.setState({ initialLoad: false });\n    }\n    if (this.state.masterPlay && this.state.masterStop) {\n      this.setState({\n        masterPlay: false,\n        masterStop: false,\n        runningTime: 0,\n      });\n    }\n    if (\n      this.props.numOnlineUsers === 1 &&\n      prevProps.numOnlineUsers !== this.props.numOnlineUsers\n    ) {\n      this.resetGroupControls();\n    } else if (\n      (this.state.requestingGroupPlayback ||\n        this.state.requestingGroupRecord ||\n        this.state.preparedGroupAction !== null) &&\n      this.state.numGroupMembersPrepared === 0\n    ) {\n      console.log(\"old state, resetting controls:\", this.state);\n      this.resetGroupControls();\n    } else if (\n      this.props.numOnlineUsers > 1 &&\n      this.props.numOnlineUsers === this.state.numGroupMembersPrepared &&\n      (this.state.requestingGroupRecord || this.state.requestingGroupPlayback)\n    ) {\n      console.log(\"all users that are online are ready to go!!!!!\");\n      if (this.state.requestingGroupRecord) {\n        console.log(\"requesting group record\");\n        this.requestImmediateGroupRecord();\n      } else if (this.state.requestingGroupPlayback) {\n        console.log(\"requesting group play\");\n        this.requestImmediateGroupPlay();\n      }\n    }\n    const maxTime =\n      Object.values(this.state.trackTimesInMillis).length === 0\n        ? 0\n        : Math.max(...Object.values(this.state.trackTimesInMillis));\n    if (\n      this.state.runningTime > maxTime &&\n      maxTime !== 0 &&\n      !(this.state.masterRecord || this.state.isRecording)\n    ) {\n      this.toggleMasterStop();\n    }\n  }\n\n  resetGroupControls = () => {\n    console.log(\"resetting group controls\");\n    this.setState({\n      requestingGroupRecord: false,\n      requestingGroupPlayback: false,\n      receivedImmediateStop: false,\n      numGroupMembersPrepared: 0,\n      preparedGroupAction: null,\n      withGroup: false,\n    });\n  };\n\n  componentWillUnmount() {\n    // remove socket io listeners\n    console.log(\n      `[SOCKET.IO] ${this.props.projectName} | removing DAW listeners`\n    );\n    socket.off(\"beginGroupPlay\", this.beginGroupPlayListener);\n    socket.off(\"beginGroupStop\", this.beginGroupStopListener);\n    socket.off(\"beginGroupRecord\", this.beginGroupRecordListener);\n    socket.off(\"updateNumPrepared\", this.updateNumPreparedListener);\n    socket.off(\"notifyWaitingGroupMember\", this.notifyWaitingGroupMember);\n    socket.off(\"updateClaimedTracks\", this.updateClaimedTracksListener);\n    socket.off(\n      \"retrieveCurrentClaimedTracks\",\n      this.retrieveCurrentClaimedTracksListener\n    );\n  }\n\n  // TRACK OPERATIONS\n\n  createTrack = () => {\n    this.props.createTrack();\n  };\n\n  renameTrack = (id, name) => {\n    this.props.renameTrack(id, name);\n  };\n\n  deleteTrack = (id, name) => {\n    const successfulDelete = this.props.deleteTrack(id, name);\n    if (successfulDelete) {\n      this.setState({ selectedTrackId: null });\n    }\n  };\n\n  // TAKE OPERATIONS\n\n  createTake = (track_id, file, is_manual_upload, latency = 0) => {\n    this.props.createTake(track_id, file, is_manual_upload, latency);\n  };\n\n  deleteTake = (track_id, take_number, take_id) => {\n    this.props.deleteTake(track_id, take_number, take_id);\n  };\n\n  // PLAYBACK OPERATIONS\n\n  toggleMasterPlay = () => {\n    console.log(\"> master play\");\n    if (this.state.masterPlay) {\n      return;\n    }\n    this.setState((state) => {\n      const startTime = Date.now() - this.state.runningTime;\n      this.timer = setInterval(() => {\n        this.setState({ runningTime: Date.now() - startTime });\n      });\n      return { masterPlay: true };\n    });\n  };\n\n  toggleMasterStop() {\n    console.log(\"> master stop\");\n    clearInterval(this.timer);\n    if (!this.state.masterPlay) {\n      console.log(\"stopped but not playing\");\n      this.setState({\n        runningTime: 0,\n        receivedImmediateStop: false,\n      });\n      return;\n    }\n    if (!this.state.isRecording) {\n      console.log(\"stopped but not recording\");\n      this.setState({\n        masterStop: true,\n        runningTime: 0,\n        receivedImmediateStop: false,\n      });\n    } else {\n      this.setState({\n        masterStop: true,\n        runningTime: 0,\n        stopMicProcessing: true,\n        receivedImmediateStop: false,\n        isRecording: false,\n      });\n      //stop microphone access\n      this.gumStream.getAudioTracks()[0].stop();\n      this.recorder.finishRecording();\n    }\n  }\n\n  // https://codesandbox.io/s/v67oz43lm7?file=/src/index.js\n  async toggleMasterRecord() {\n    console.log(\"> master record\");\n    if (this.state.selectedTrackId === null) {\n      alert(\"Select a part to record!\");\n    } else {\n      console.log(\"recording track \" + this.state.selectedTrackId);\n      // check if mic permissions are allowed before actually recording\n      navigator.mediaDevices\n        .getUserMedia({ audio: true })\n        .then(() => {\n          console.log(\"mic permission granted\");\n          this.startMicrophone();\n          this.setState({\n            showCountdown: true,\n            isBlocked: false,\n          });\n        })\n        .catch(() => {\n          console.log(\"MIC PERMISSIOM DENIED\");\n          alert(\"Please allow access to your microphone!\");\n          this.setState({ isBlocked: true });\n        });\n    }\n  }\n\n  startMicrophone = () => {\n    this.audioContext = new AudioContext();\n    navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n      console.log(\n        \"[RECORDING] getUserMedia() success, stream created, initializing WebAudioRecorder...\"\n      );\n      this.gumStream = stream;\n\n      /* use the stream */\n      this.input = this.audioContext.createMediaStreamSource(stream);\n\n      this.recorder = new WebAudioRecorder(this.input, {\n        workerDir: \"js/\", // must end with slash\n        encoding: \"mp3\",\n        numChannels: 2, //2 is the default, mp3 encoding supports only 2\n      });\n\n      this.recorder.setOptions({\n        timeLimit: 600,\n        encodeAfterRecord: true,\n        mp3: { bitRate: 256 },\n      });\n\n      this.recorder.onComplete = async (recorder, blob) => {\n        if (!this.state.masterRecord) {\n          console.log(\n            \"[RECORDING] alignment tool is trying to pop up but shouldn't...\"\n          );\n          return;\n        }\n        console.log(\"[RECORDING] encoding complete\");\n        this.gumStream.getAudioTracks()[0].stop();\n        await this.stopMicrophone(blob);\n      };\n\n      this.recorder.startRecording();\n    });\n  };\n\n  findNonRecordedTrackURLs = (targetTrackId) => {\n    let nonRecordedTrackURLs;\n    if (this.state.soloTracks.length > 0) {\n      nonRecordedTrackURLs = Object.keys(this.props.trackMetadata)\n        .filter((trackId) => {\n          // only include unmuted tracks that are: 1) not the recorded track and 2) have recordings\n          return (\n            trackId !== targetTrackId &&\n            this.state.soloTracks.includes(trackId) &&\n            !this.state.mutedTracks.includes(trackId) &&\n            Object.keys(this.props.trackMetadata[trackId].takes).length > 0\n          );\n        })\n        .map((trackId) => {\n          // TODO: made executive decision to just pick latest track, but eventually need to fix how take state is stored so DAW Object can access it\n          const takeId = Object.keys(\n            this.props.trackMetadata[trackId].takes\n          ).pop();\n          const audio_url =\n            this.props.trackMetadata[trackId].takes[takeId].s3_info +\n            \"?cacheblock=true\";\n          return audio_url;\n        });\n    } else {\n      nonRecordedTrackURLs = Object.keys(this.props.trackMetadata)\n        .filter((trackId) => {\n          // only include unmuted tracks that are: 1) not the recorded track and 2) have recordings\n          return (\n            trackId !== targetTrackId &&\n            !this.state.mutedTracks.includes(trackId) &&\n            Object.keys(this.props.trackMetadata[trackId].takes).length > 0\n          );\n        })\n        .map((trackId) => {\n          // TODO: made executive decision to just pick latest track, but eventually need to fix how take state is stored so DAW Object can access it\n          const takeId = Object.keys(\n            this.props.trackMetadata[trackId].takes\n          ).pop();\n          const audio_url =\n            this.props.trackMetadata[trackId].takes[takeId].s3_info +\n            \"?cacheblock=true\";\n          return audio_url;\n        });\n    }\n    console.log(\n      \"# tracks to be stacked for align tool backing track = \" +\n        nonRecordedTrackURLs.length\n    );\n    return nonRecordedTrackURLs;\n  };\n\n  stopMicrophone = async (blob) => {\n    let file = new File(\n      [blob],\n      `recording_track_${this.state.selectedTrackId}.mp3`\n    );\n    let recordedURL = URL.createObjectURL(file);\n    let latency = 0; // in ms\n    this.setState({ stopMicProcessing: false });\n    const numTotalTracks = Object.keys(this.props.trackMetadata).length;\n    console.log(\n      \"[RECORDING] stopping microphone, not sending these muted tracks to alignment tool:\",\n      this.state.mutedTracks\n    );\n    let nonRecordedTrackURLs = this.findNonRecordedTrackURLs(\n      this.state.selectedTrackId\n    );\n    // only align track if there is more than 1 track\n    if (\n      numTotalTracks > 1 &&\n      nonRecordedTrackURLs.length > 0 &&\n      this.state.selectedTrackId !== null &&\n      !this.state.alreadyAligning\n    ) {\n      this.setState({ alreadyAligning: true });\n      latency = await CustomDialog(\n        <AlignRecordingModalContent\n          recordedURL={recordedURL}\n          backingTrackURLs={nonRecordedTrackURLs}\n          hasCountdownLatency={true}\n        />,\n        {\n          title: \"Check Recording\",\n          isCanClose: false,\n          // showCloseIcon: true,\n        }\n      );\n      // delete recording instead\n      if (latency === \"scrap\") {\n        this.setState({\n          isRecording: false,\n          masterRecord: false,\n          alreadyAligning: false,\n        });\n        return;\n      }\n    }\n    const isManualUpload = false;\n    this.createTake(this.state.selectedTrackId, file, isManualUpload, latency);\n    this.setState({\n      isRecording: false,\n      masterRecord: false,\n      alreadyAligning: false,\n    });\n  };\n\n  handleFileUpload = (files, targetId) => {\n    console.log(\"handling file upload for target track id\", targetId);\n    if (\n      files === null ||\n      files[0] === null ||\n      typeof files[0] === \"undefined\"\n    ) {\n      return;\n    }\n    if (/\\.(mp3|ogg|wav|flac|aac|aiff|m4a)$/i.test(files[0].name)) {\n      console.log(\"> validated file: \", files[0].name);\n      const isManualUpload = true;\n      this.createTake(targetId, files[0], isManualUpload);\n    } else {\n      alert(\n        \"Please upload valid audio file type (mp3, ogg, wav, flac, aac, aiff, m4a)\"\n      );\n      return;\n    }\n  };\n\n  setSelectedTrack = (id) => {\n    const newId = id !== null ? id : null;\n    console.log(\"selecting track to record: \" + newId);\n    this.setState({ selectedTrackId: newId });\n    console.log(\"> [SOCKET.IO] broadcasting update claimed tracks\");\n    socket.emit(\"broadcast update claimed tracks\", {\n      channel: this.props.projectHash,\n      track_id: id,\n      claimed_by: this.username,\n    });\n  };\n\n  formattedTime = (ms) => {\n    let minutes = Math.floor(ms / 60000);\n    let seconds = ((ms % 60000) / 1000).toFixed(2);\n    return minutes + \":\" + (seconds < 10 ? \"0\" : \"\") + seconds;\n  };\n\n  updateSoloTracks = (trackId) => {\n    let newSoloTracks = [...this.state.soloTracks];\n    let index = newSoloTracks.indexOf(trackId);\n\n    if (index !== -1) {\n      // remove\n      newSoloTracks.splice(index, 1);\n    } else {\n      // add\n      newSoloTracks.push(trackId);\n    }\n    console.log(\"new solo tracks:\", newSoloTracks);\n    this.setState({ soloTracks: newSoloTracks });\n  };\n\n  updateMutedTracks = (trackId) => {\n    let newMutedTracks = [...this.state.mutedTracks];\n    let index = newMutedTracks.indexOf(trackId);\n\n    if (index !== -1) {\n      // remove\n      newMutedTracks.splice(index, 1);\n    } else {\n      // add\n      newMutedTracks.push(trackId);\n    }\n    console.log(\"new muted tracks:\", newMutedTracks);\n    this.setState({ mutedTracks: newMutedTracks });\n  };\n\n  changeVolume = (value) => {\n    this.setState({ masterVolume: value / 100 });\n  };\n\n  rehearse = () => {\n    console.log(\"currently rehearsing:\", this.state.isRehearsing);\n    this.setState({\n      isRehearsing: !this.state.isRehearsing,\n    });\n  };\n\n  downloadMixedTrack = async () => {\n    const confirm = await Confirm(\n      `This will create a MP3 file containing the latest take from all parts. Are you sure you want to download?`,\n      \"Download Mix\"\n    );\n    if (!confirm) {\n      return;\n    }\n\n    let latestTakeURLs = Object.keys(this.props.trackMetadata)\n      .filter((trackId) => {\n        const numTakes = Object.keys(\n          this.props.trackMetadata[trackId].takes\n        ).length;\n        return numTakes !== 0;\n      })\n      .map((trackId) => {\n        const takes = this.props.trackMetadata[trackId].takes;\n        const takeId = Object.keys(takes).pop();\n        return takes[takeId].s3_info + \"?cacheblock=true\";\n      });\n    crunker\n      .fetchAudio(...latestTakeURLs)\n      .then((buffers) => {\n        return crunker.mergeAudio(buffers);\n      })\n      .then((merged) => {\n        return crunker.export(merged, \"audio/mp3\");\n      })\n      .then((output) => {\n        // https://stackoverflow.com/questions/50694881/how-to-download-file-in-react-js\n        const link = document.createElement(\"a\");\n        link.href = output.url;\n        const d = new Date();\n        const datestring = `${d.getFullYear()}_${\n          d.getMonth() + 1\n        }_${d.getDate()}`;\n        const timestring = `${d.getHours()}_${d.getMinutes()}_${d.getDate()}_${\n          d.getHours() >= 12 ? \"PM\" : \"AM\"\n        }`;\n        const outputFilename = `${this.props.projectName}_${datestring}-${timestring}`;\n        link.setAttribute(\"download\", outputFilename);\n\n        document.body.appendChild(link); // Append to html link element page\n        link.click(); // Start download\n        link.parentNode.removeChild(link); // Clean up and remove the link\n      });\n  };\n\n  requestGroupPlay = () => {\n    console.log(\"[SOCKET.IO] requesting group play\");\n    socket.emit(\"get current online users\", {\n      channel: this.props.projectHash,\n    });\n    socket.emit(\n      \"prepare group play\",\n      {\n        channel: this.props.projectHash,\n      },\n      (shouldPlay) => {\n        if (!shouldPlay) {\n          this.setState({\n            requestingGroupPlayback: true,\n            preparedGroupAction: \"play\",\n          });\n        }\n      }\n    );\n  };\n\n  requestImmediateGroupPlay = () => {\n    console.log(\"[SOCKET.IO] request immediate group play\");\n    socket.emit(\"immediate group play\", {\n      channel: this.props.projectHash,\n    });\n  };\n\n  requestGroupStop = () => {\n    console.log(\"[SOCKET.IO] request immediate group stop\");\n    if (this.state.withGroup) {\n      socket.emit(\"immediate group stop\", {\n        channel: this.props.projectHash,\n        user: this.username,\n      });\n    } else {\n      console.log(\"wanted to stop again but not with group anymore\");\n    }\n  };\n\n  // TODO: needs to send which track it chose to record and\n  // make sure there are no conflicts with other tracks\n  requestGroupRecord = () => {\n    console.log(\"[SOCKET.IO] request group record\");\n    if (this.state.selectedTrackId === null) {\n      alert(\"Select a part before recording!\");\n    } else {\n      socket.emit(\"get current online users\", {\n        channel: this.props.projectHash,\n      });\n      socket.emit(\n        \"prepare group record\",\n        {\n          channel: this.props.projectHash,\n        },\n        (shouldRecord) => {\n          if (!shouldRecord) {\n            this.setState({\n              requestingGroupRecord: true,\n              preparedGroupAction: \"record\",\n            });\n          }\n        }\n      );\n    }\n  };\n\n  requestImmediateGroupRecord = () => {\n    console.log(\"[SOCKET.IO] request immediate group record\");\n    socket.emit(\"immediate group record\", {\n      channel: this.props.projectHash,\n    });\n  };\n\n  cancelRequest = () => {\n    console.log(\"[SOCKET.IO] cancel current request\");\n    socket.emit(\"cancel request\", { channel: this.props.projectHash }, () => {\n      this.setState({\n        requestingGroupPlayback: false,\n        requestingGroupRecord: false,\n        preparedGroupAction: null,\n      });\n    });\n  };\n\n  realignTake = async (realignTrackId, takeURL) => {\n    let nonRecordedTrackURLs = this.findNonRecordedTrackURLs(realignTrackId);\n    if (nonRecordedTrackURLs.length === 0) {\n      alert(\n        \"Cannot realign: realign is only supported with 1+ other unmuted parts.\"\n      );\n      return;\n    }\n    const latency = await CustomDialog(\n      <AlignRecordingModalContent\n        recordedURL={takeURL}\n        backingTrackURLs={nonRecordedTrackURLs}\n        hasCountdownLatency={false}\n      />,\n      {\n        title: \"Check Recording\",\n        isCanClose: false,\n        // showCloseIcon: true,\n      }\n    );\n    // delete recording instead\n    if (latency === \"scrap\") {\n      return;\n    }\n    let response = await fetch(takeURL);\n    let data = await response.blob();\n    let file = new File([data], `recording_track_${realignTrackId}.mp3`);\n    const isManualUpload = true;\n    this.createTake(realignTrackId, file, isManualUpload, latency);\n  };\n\n  updateTrackTimesInMillis = (trackId, trackTimeInSecs) => {\n    let newTrackTimes = Object.assign({}, this.state.trackTimesInMillis);\n    newTrackTimes[trackId] = trackTimeInSecs * 1000;\n    this.setState({ trackTimesInMillis: newTrackTimes });\n  };\n\n  render() {\n    const otherMembersOnline = this.props.numOnlineUsers > 1;\n    const totalTakes = Object.keys(this.props.trackMetadata).reduce(\n      (accumulator, trackId) => {\n        return (\n          accumulator +\n          Object.keys(this.props.trackMetadata[trackId].takes).length\n        );\n      },\n      0\n    );\n    const claimedTrackIdsKeys = Object.keys(this.state.claimedTrackIds);\n    const trackTimes = Object.values(this.state.trackTimesInMillis);\n    const maxTime = trackTimes.length === 0 ? 0 : Math.max(...trackTimes);\n    return (\n      <div style={{ marginBottom: \"10px\" }}>\n        <div>\n          {this.props.trackMetadata &&\n          Object.keys(this.props.trackMetadata).length > 0 ? (\n            Object.keys(this.props.trackMetadata).map((trackId) => {\n              const trackInfo = this.props.trackMetadata[trackId];\n              const trackOwner = claimedTrackIdsKeys.find(\n                (key) => this.state.claimedTrackIds[key] === trackId\n              );\n              const claimedBy =\n                trackOwner !== this.username && trackOwner !== undefined\n                  ? trackOwner\n                  : null;\n              return (\n                <div key={`track_${trackId}`}>\n                  <div>\n                    <Track\n                      trackName={trackInfo.track_name}\n                      trackId={trackId}\n                      takes={trackInfo.takes}\n                      masterPlay={this.state.masterPlay}\n                      masterStop={this.state.masterStop}\n                      masterRecord={this.state.masterRecord}\n                      selectedTrackId={this.state.selectedTrackId}\n                      setSelectedTrack={this.setSelectedTrack}\n                      deleteTake={this.deleteTake}\n                      soloTracks={this.state.soloTracks}\n                      updateSoloTracks={this.updateSoloTracks}\n                      updateMutedTracks={this.updateMutedTracks}\n                      claimedTracks={this.state.claimedTracks}\n                      masterVolume={this.state.masterVolume}\n                      renameTrack={this.renameTrack}\n                      deleteTrack={this.deleteTrack}\n                      handleFileUpload={this.handleFileUpload}\n                      realignTake={this.realignTake}\n                      claimedBy={claimedBy}\n                      updateTrackTimesInMillis={this.updateTrackTimesInMillis}\n                    />\n                  </div>\n                  {Object.keys(this.props.trackMetadata[trackId].takes)\n                    .length === 0 && (\n                    <div style={{ marginTop: \"-8px\" }}>\n                      <input\n                        style={{\n                          marginLeft: \"20px\",\n                          marginBottom: \"10px\",\n                        }}\n                        type=\"file\"\n                        onChange={(e) =>\n                          this.handleFileUpload(e.target.files, trackId)\n                        }\n                      />\n                    </div>\n                  )}\n                </div>\n              );\n            })\n          ) : (\n            <div style={{ marginTop: \"10px\" }} />\n          )}\n        </div>\n        <button\n          style={{ marginTop: \"10px\", marginLeft: \"5px\", marginBottom: \"28px\" }}\n          className=\"stitched\"\n          onClick={this.createTrack}\n        >\n          + New Part\n        </button>\n        <div style={{ display: \"flex\" }}>\n          <p style={{ marginBottom: \"5px\" }}>\n            <b>Master Controls</b>\n          </p>\n          {otherMembersOnline && (\n            <button\n              style={{ marginLeft: \"12px\", height: \"35px\", marginTop: \"8px\" }}\n              onClick={this.requestGroupRecord}\n              disabled={\n                this.state.masterPlay ||\n                this.state.withGroup ||\n                this.state.requestingGroupRecord ||\n                this.state.requestingGroupPlayback ||\n                this.state.preparedGroupAction === \"play\" ||\n                this.state.showCountdown\n              }\n            >\n              {this.state.requestingGroupRecord ? \"waiting...\" : \"group record\"}\n            </button>\n          )}\n          {otherMembersOnline && (\n            <button\n              onClick={this.requestGroupStop}\n              disabled={!this.state.withGroup || this.state.showCountdown}\n              style={{ height: \"35px\", marginTop: \"8px\" }}\n            >\n              group stop\n            </button>\n          )}\n          {otherMembersOnline && (\n            <button\n              onClick={this.requestGroupPlay}\n              disabled={\n                this.state.masterPlay ||\n                this.state.withGroup ||\n                this.state.requestingGroupPlayback ||\n                this.state.requestingGroupRecord ||\n                this.state.preparedGroupAction === \"record\" ||\n                this.state.showCountdown ||\n                totalTakes === 0\n              }\n              style={{ height: \"35px\", marginTop: \"8px\" }}\n            >\n              {this.state.requestingGroupPlayback ? \"waiting...\" : \"group play\"}\n            </button>\n          )}\n          {otherMembersOnline && (\n            <button\n              onClick={this.cancelRequest}\n              disabled={\n                !this.state.requestingGroupRecord &&\n                !this.state.requestingGroupPlayback\n              }\n              style={{ height: \"35px\", marginTop: \"8px\" }}\n            >\n              cancel request\n            </button>\n          )}\n          {otherMembersOnline &&\n            this.state.preparedGroupAction !== null &&\n            this.state.numGroupMembersPrepared !== 0 && (\n              <div style={{ marginLeft: \"10px\", marginTop: \"14px\" }}>\n                {this.state.numGroupMembersPrepared}/{this.props.numOnlineUsers}{\" \"}\n                ready\n                {this.state.preparedGroupAction &&\n                  ` for ${this.state.preparedGroupAction}`}\n              </div>\n            )}\n          {this.state.stopMicProcessing && (\n            <LoadingGif text={\"Saving Recording...\"} />\n          )}\n        </div>\n        {this.state.isBlocked && (\n          <p style={{ marginBottom: \"5px\" }}>\n            Please allow access to your mic to record!\n          </p>\n        )}\n        {/* TODO: Live Monitoring */}\n        <Tooltip\n          title={this.state.masterPlay ? \"\" : \"Record selected part\"}\n          arrow\n        >\n          <span>\n            <IconButton\n              disableRipple\n              aria-label=\"Record\"\n              onClick={this.toggleMasterRecord}\n              disabled={\n                this.state.masterPlay ||\n                this.state.isBlocked ||\n                this.state.withGroup ||\n                this.state.showCountdown\n              }\n            >\n              {this.state.masterPlay ||\n              this.state.isBlocked ||\n              this.state.withGroup ||\n              this.state.showCountdown ? (\n                <FiberManualRecordRoundedIcon style={{ fontSize: 28 }} />\n              ) : (\n                <FiberManualRecordRoundedIcon\n                  style={{ fontSize: 28 }}\n                  color=\"secondary\"\n                />\n              )}\n            </IconButton>\n          </span>\n        </Tooltip>\n        <Tooltip title={this.state.masterPlay ? \"Stop all parts\" : \"\"} arrow>\n          <span>\n            <IconButton\n              disableRipple\n              aria-label=\"Stop\"\n              onClick={this.toggleMasterStop}\n              disabled={!this.state.masterPlay || this.state.withGroup}\n            >\n              <StopRoundedIcon style={{ fontSize: 35 }} />\n            </IconButton>\n          </span>\n        </Tooltip>\n        <Tooltip\n          title={\n            this.state.masterPlay || totalTakes === 0 ? \"\" : \"Play all parts\"\n          }\n          arrow\n        >\n          <span>\n            <IconButton\n              disableRipple\n              aria-label=\"Play\"\n              onClick={this.toggleMasterPlay}\n              disabled={\n                this.state.masterPlay ||\n                this.state.withGroup ||\n                totalTakes === 0 ||\n                this.state.showCountdown\n              }\n              style={{ marginLeft: \"-5px\" }}\n            >\n              {this.state.masterPlay ||\n              this.state.withGroup ||\n              totalTakes === 0 ||\n              this.state.showCountdown ? (\n                <PlayArrowRoundedIcon style={{ fontSize: 35 }} />\n              ) : (\n                <PlayArrowRoundedIcon\n                  color=\"primary\"\n                  style={{ fontSize: 35, color: \"#54ae1c\" }}\n                />\n              )}\n            </IconButton>\n          </span>\n        </Tooltip>{\" \"}\n        <div style={{ display: \"flex\", marginTop: \"-45px\" }}>\n          <div style={{ marginLeft: \"170px\", marginTop: \"5px\" }}>\n            {this.state.isRecording ? (\n              <span style={{ color: \"#F60457\" }}>\n                <b>{this.formattedTime(this.state.runningTime)}</b>\n              </span>\n            ) : this.state.masterPlay || this.state.showCountdown ? (\n              <span>\n                <b>{this.formattedTime(this.state.runningTime)}</b>\n              </span>\n            ) : (\n              <span>{this.formattedTime(this.state.runningTime)}</span>\n            )}\n          </div>\n          <div\n            style={\n              this.state.masterRecord ||\n              this.state.isRecording ||\n              this.state.showCountdown\n                ? {\n                    position: \"absolute\",\n                    marginLeft: \"235px\",\n                    marginTop: \"5px\",\n                    width: \"85px\",\n                    color: \"lightgray\",\n                  }\n                : {\n                    position: \"absolute\",\n                    marginLeft: \"235px\",\n                    marginTop: \"5px\",\n                    width: \"85px\",\n                  }\n            }\n          >\n            /\n            <span style={{ marginLeft: \"6px\" }}>\n              {this.formattedTime(maxTime)}\n            </span>\n          </div>\n          <div\n            style={{\n              position: \"absolute\",\n              marginLeft: \"320px\",\n              width: \"100px\",\n            }}\n          >\n            Volume\n            <Slider\n              min={0}\n              max={100}\n              defaultValue={100}\n              onChange={this.changeVolume}\n            />\n          </div>\n          {/* <div\n            style={{\n              position: \"absolute\",\n              marginLeft: \"395px\",\n              width: \"200px\",\n            }}\n          >\n            Seek\n            <Slider min={0} max={100} defaultValue={0} onChange={this.seek} />\n          </div> */}\n          <button\n            onClick={this.downloadMixedTrack}\n            className=\"download-full-mix\"\n          >\n            Download full mix\n          </button>\n        </div>\n        {this.state.showCountdown && (\n          <div\n            className=\"timer\"\n            style={{\n              position: \"absolute\",\n              marginLeft: \"580px\",\n              marginTop: \"-100px\",\n            }}\n          >\n            <CountdownCircleTimer\n              isPlaying\n              duration={3}\n              colors={[[\"#0f52bd\", 1]]}\n              size={90}\n              onComplete={() => {\n                const startTime = Date.now() - this.state.runningTime;\n                this.timer = setInterval(() => {\n                  this.setState({ runningTime: Date.now() - startTime });\n                });\n                this.setState({\n                  showCountdown: false,\n                  masterPlay: true,\n                  masterRecord: true,\n                  isRecording: true,\n                });\n              }}\n            >\n              {({ remainingTime }) => remainingTime}\n            </CountdownCircleTimer>\n            <button\n              onClick={() => {\n                this.setState({\n                  showCountdown: false,\n                  isRecording: false,\n                });\n                this.toggleMasterStop();\n              }}\n              style={{ marginTop: \"10px\", marginBottom: \"10px\" }}\n            >\n              Ahh I'm not ready!\n            </button>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default DAW;\n","import React, { Component } from \"react\";\nimport DAW from \"./daw/DAW\";\nimport LoadingGif from \"./daw/LoadingGif\";\nimport { Prompt, Confirm } from \"react-st-modal\"; // https://github.com/Nodlik/react-st-modal\n\nimport SyncRoundedIcon from \"@material-ui/icons/SyncRounded\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\n\nimport { socket } from \"../../App\";\n\nclass Project extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      project_name: null,\n      group_name: null,\n      project_id: null,\n      track_metadata: null,\n      project_hash: props.location.pathname.split(\"/\").pop(),\n      isCreatingTake: false,\n      isDeletingTakeOrTrack: false,\n      onlineUsers: [],\n    };\n    if (this.state.project_hash === \"project\") {\n      this.state.project_hash = null;\n    }\n    this.createTrack = this.createTrack.bind(this);\n    this.deleteTrack = this.deleteTrack.bind(this);\n    this.renameTrack = this.renameTrack.bind(this);\n    this.createTake = this.createTake.bind(this);\n    this.deleteTake = this.deleteTake.bind(this);\n\n    const username = JSON.parse(localStorage.getItem(\"userDetails\")).name;\n    this.state.onlineUsers = [username];\n    console.log(\"[SOCKET.IO] sending request to JOIN project\");\n    socket.emit(\"join project\", {\n      channel: this.state.project_hash,\n      user: username,\n    });\n  }\n\n  // SOCKET IO LISTENERS:\n\n  updateOnlineUsersListener = (data) => {\n    console.log(\"[SOCKET.IO] receiving updateOnlineUsers:\", data.user_list);\n    this.setState({ onlineUsers: data.user_list });\n  };\n\n  updateProjectListener = () => {\n    console.log(\"[SOCKET.IO] receiving updateProject\");\n    this.refresh();\n  };\n\n  // REACT MAIN FUNCTIONS:\n\n  componentDidMount() {\n    this.retrieveProject(this.state.project_hash);\n    console.log(`[SOCKET.IO] creating project listeners`);\n    socket.on(\"updateOnlineUsers\", this.updateOnlineUsersListener);\n    socket.on(\"updateProject\", this.updateProjectListener);\n  }\n\n  componentWillUnmount() {\n    console.log(\n      `[SOCKET.IO] removing project (${this.state.project_name}) listeners`\n    );\n    socket.off(\"updateOnlineUsers\", this.updateOnlineUsersListener);\n    socket.off(\"updateProject\", this.updateProjectListener);\n\n    const userDetails = localStorage.getItem(\"userDetails\");\n    if (userDetails) {\n      console.log(\"[SOCKET.IO] sending request to LEAVE project\");\n      const username = JSON.parse(userDetails).name;\n      socket.emit(\"leave project\", {\n        channel: this.state.project_hash,\n        user: username,\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const pathname = this.props.location.pathname.split(\"/\").pop();\n    // fetch project if last page was project search page\n    if (\n      pathname !== \"project\" &&\n      pathname !== null &&\n      this.props.location.pathname !== prevProps.location.pathname\n    ) {\n      this.retrieveProject(pathname);\n      // loaded project search page\n    } else if (pathname === \"project\" && this.state.project_hash !== null) {\n      this.setState({\n        project_hash: null,\n        project_name: null,\n        group_name: null,\n        project_id: null,\n        track_metadata: null,\n      });\n    }\n  }\n\n  retrieveProject = (project_hash) => {\n    console.log(\"retrieving project: \" + project_hash);\n    if (project_hash === null || project_hash === \"\") {\n      return;\n    }\n    fetch(\"/api/project?\" + new URLSearchParams({ project_hash: project_hash }))\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((obj) => {\n        const tracks = obj.body.tracks\n          ? obj.body.tracks.reduce((obj, item) => {\n              const formatted_takes = item[\"takes\"].reduce((obj, item) => {\n                obj[item[\"take\"]] = {\n                  date_uploaded: item[\"date_uploaded\"],\n                  id: item[\"id\"],\n                  s3_info: item[\"s3_info\"],\n                  track_id: item[\"track_id\"],\n                };\n                return obj;\n              }, {});\n              obj[item[\"id\"]] = {\n                takes: formatted_takes,\n                track_name: item[\"track_name\"],\n              };\n              return obj;\n            }, {})\n          : {};\n        if (obj.status === 200) {\n          this.setState({\n            project_hash: project_hash,\n            project_name: obj.body.project_name,\n            group_name: obj.body.group.group_name,\n            project_id: obj.body.id,\n            track_metadata: tracks,\n          });\n        }\n      });\n  };\n\n  async createTrack() {\n    console.log(\"creating new track\");\n    const track_name = await Prompt(\"Name Your Part\");\n    if (track_name) {\n      const formData = new FormData();\n      formData.append(\"track_name\", track_name);\n      formData.append(\"project_id\", this.state.project_id);\n      const requestOptions = {\n        method: \"POST\",\n        body: formData,\n      };\n      fetch(\"/api/track\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status !== 400) {\n            console.log(\"added new track\");\n            let updatedTracks = Object.assign({}, this.state.track_metadata);\n            updatedTracks[obj.body.track_id] = {\n              id: parseInt(obj.body.track_id),\n              project_id: this.state.projectId,\n              takes: {},\n              track_name: track_name,\n            };\n            this.setState({ track_metadata: updatedTracks });\n            socket.emit(\"broadcast update project\", {\n              channel: this.state.project_hash,\n            });\n          }\n        });\n    }\n  }\n\n  async renameTrack(id, name) {\n    console.log(\"renaming track\");\n    const new_name = await Prompt(\"Rename Your Part\", {\n      defaultValue: name,\n    });\n    if (new_name) {\n      const formData = new FormData();\n      formData.append(\"track_id\", id);\n      formData.append(\"new_name\", new_name);\n      const requestOptions = {\n        method: \"PUT\",\n        body: formData,\n      };\n      fetch(\"/api/track\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            let updatedTracks = Object.assign({}, this.state.track_metadata);\n            updatedTracks[id].track_name = new_name;\n            this.setState({ track_metadata: updatedTracks });\n            socket.emit(\"broadcast update project\", {\n              channel: this.state.project_hash,\n            });\n          }\n        });\n    }\n  }\n\n  async deleteTrack(id, name) {\n    const result = await Confirm(\n      `Are you sure you want to delete \"${name}\"?`,\n      \"Delete Part\"\n    );\n    if (result) {\n      this.setState({ isDeletingTakeOrTrack: true });\n      const formData = new FormData();\n      formData.append(\"track_id\", id);\n      const requestOptions = {\n        method: \"DELETE\",\n        body: formData,\n      };\n      fetch(\"/api/track\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            const updatedTracks = Object.assign({}, this.state.track_metadata);\n            delete updatedTracks[id];\n            this.setState({\n              track_metadata: updatedTracks,\n              isDeletingTakeOrTrack: false,\n            });\n            socket.emit(\"broadcast update project\", {\n              channel: this.state.project_hash,\n            });\n            return true;\n          }\n          this.setState({ isDeletingTakeOrTrack: false });\n        });\n    }\n    return false;\n  }\n\n  createTake(track_id, file, is_manual_upload, latency) {\n    console.log(\"creating new take for\", track_id);\n    this.setState({ isCreatingTake: true });\n    const formData = new FormData();\n    formData.append(\"track_id\", track_id);\n    formData.append(\"file\", file);\n    formData.append(\"latency\", latency);\n    formData.append(\"tz_offset\", new Date().getTimezoneOffset() / 60);\n    formData.append(\"is_manual_upload\", is_manual_upload);\n\n    const requestOptions = {\n      method: \"POST\",\n      body: formData,\n    };\n\n    fetch(\"/api/take\", requestOptions)\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((obj) => {\n        if (obj.status !== 400) {\n          console.log(\"CREATED TAKE:\", obj);\n          let updatedTracks = Object.assign({}, this.state.track_metadata);\n          updatedTracks[parseInt(track_id)].takes[parseInt(obj.body.take)] = {\n            id: parseInt(obj.body.take_id),\n            track_id: parseInt(track_id),\n            s3_info: obj.body.s3_info,\n            date_uploaded: new Date(obj.body.timestamp).toString(),\n          };\n          this.setState({\n            track_metadata: updatedTracks,\n            isCreatingTake: false,\n          });\n          socket.emit(\"broadcast update project\", {\n            channel: this.state.project_hash,\n          });\n        } else {\n          this.setState({ isCreatingTake: false });\n        }\n      })\n      .catch((error) => {\n        this.setState({ isCreatingTake: false });\n        alert(\"Could not upload take due to server error (see console).\");\n        console.log(error);\n      });\n  }\n\n  deleteTake(track_id, take_number, take_id) {\n    this.setState({ isDeletingTakeOrTrack: true });\n    const formData = new FormData();\n    formData.append(\"take_id\", take_id);\n    const requestOptions = {\n      method: \"DELETE\",\n      body: formData,\n    };\n    fetch(\"/api/take\", requestOptions)\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((obj) => {\n        if (obj.status === 200) {\n          const updatedTracks = Object.assign({}, this.state.track_metadata);\n          delete updatedTracks[track_id].takes[take_number];\n          this.setState({\n            track_metadata: updatedTracks,\n            isDeletingTakeOrTrack: false,\n          });\n          socket.emit(\"broadcast update project\", {\n            channel: this.state.project_hash,\n          });\n        } else {\n          this.setState({ isDeletingTakeOrTrack: false });\n        }\n      })\n      .catch((error) => {\n        alert(\"Could not delete take due to server error (see console).\");\n        this.setState({ isDeletingTakeOrTrack: false });\n      });\n  }\n\n  refresh = () => {\n    this.retrieveProject(this.state.project_hash);\n  };\n\n  render() {\n    const pathSuffix = this.props.location.pathname.split(\"/\").pop();\n\n    // show loading screen if have not retrieved data yet\n    if (this.state.project_name === null && pathSuffix !== \"project\") {\n      return <div>Loading...</div>;\n    }\n\n    return (\n      this.state.project_hash &&\n      pathSuffix !== \"project\" &&\n      pathSuffix !== \"\" && (\n        <div>\n          <div\n            style={{\n              display: \"flex\",\n              marginBottom: \"-17px\",\n              marginTop: \"-5px\",\n            }}\n          >\n            <h2>\n              {this.state.project_name}\n              <Tooltip\n                title=\"Refresh latest project info\"\n                arrow\n                placement=\"right\"\n              >\n                <IconButton\n                  disableRipple\n                  aria-label=\"Sync\"\n                  onClick={() => {\n                    this.refresh();\n                    console.log(\"retrieving current online users\");\n                    socket.emit(\"get current online users\", {\n                      channel: this.state.project_hash,\n                    });\n                  }}\n                  style={{ marginTop: \"0px\" }}\n                >\n                  <SyncRoundedIcon style={{ fontSize: 20 }} />\n                </IconButton>\n              </Tooltip>\n            </h2>\n            {this.state.isCreatingTake && (\n              <div style={{ marginTop: \"-5px\" }}>\n                <LoadingGif text=\"Uploading take...\" />\n              </div>\n            )}\n            {this.state.isDeletingTakeOrTrack && (\n              <div style={{ marginTop: \"-5px\" }}>\n                <LoadingGif text=\"Deleting...\" />\n              </div>\n            )}\n          </div>\n          <div\n            style={{\n              marginLeft: \"-5px\",\n              marginTop: \"12px\",\n              marginBottom: \"-12px\",\n              fontSize: \"12px\",\n            }}\n          >\n            {this.state.onlineUsers.map((user, i) => {\n              return (\n                <div\n                  key={`user_${i}`}\n                  style={{ display: \"inline-block\", marginRight: \"5px\" }}\n                >\n                  <img\n                    src=\"images/daw/online.png\"\n                    alt=\"online\"\n                    width=\"8\"\n                    height=\"8\"\n                    style={{ marginLeft: \"5px\", marginTop: \"2px\" }}\n                  />{\" \"}\n                  {user}{\" \"}\n                </div>\n              );\n            })}\n          </div>\n          <div style={{ marginTop: \"20px\" }}>\n            <DAW\n              projectName={this.state.project_name}\n              projectHash={this.state.project_hash}\n              trackMetadata={this.state.track_metadata}\n              numOnlineUsers={this.state.onlineUsers.length}\n              retrieveProject={this.retrieveProject}\n              createTrack={this.createTrack}\n              deleteTrack={this.deleteTrack}\n              renameTrack={this.renameTrack}\n              createTake={this.createTake}\n              deleteTake={this.deleteTake}\n            />\n          </div>\n        </div>\n      )\n    );\n  }\n}\n\nexport default Project;\n","import React, { Component } from \"react\";\n\nclass Home extends Component {\n  render() {\n    return (\n      <div>\n        <h2>HOME PAGE</h2>\n        {!this.props.authed ? (\n          <p>Login to get started! </p>\n        ) : (\n          <div>\n            <p> To get started on a project: </p>\n            <ol>\n              <li>\n                Click \"Groups\" to create a new rehearsal group and add group\n                members.\n              </li>\n              <li>\n                Click \"Projects\" to create a project and begin rehearsing!{\" \"}\n              </li>\n            </ol>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default Home;\n","import React, { useState } from \"react\";\nimport \"./Project.css\";\nimport { useHistory } from \"react-router-dom\";\n\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport MoreHorizIcon from \"@material-ui/icons/MoreHoriz\";\n\nconst RENAME_PROJECT_OPTION = \"Rename Project\";\nconst DELETE_PROJECT_OPTION = \"Delete Project\";\nconst options = [RENAME_PROJECT_OPTION, DELETE_PROJECT_OPTION];\n\nfunction Project(props) {\n  const history = useHistory();\n  const [threeDotsAnchorElement, setThreeDotsAnchorElement] = useState(null);\n\n  const rehearse = () => {\n    history.push({\n      pathname: `/project/${props.project.project_hash}`,\n      state: {\n        project: props.project,\n        group_name: props.group_name,\n        group_id: props.group_id,\n      },\n    });\n  };\n\n  const clickThreeDotsMenu = (e) => {\n    setThreeDotsAnchorElement(e.currentTarget);\n  };\n\n  const closeThreeDotsMenu = (e) => {\n    const option = e.target.innerText;\n    if (option === RENAME_PROJECT_OPTION) {\n      props.renameProject(props.project.id, props.project.project_name);\n    } else if (option === DELETE_PROJECT_OPTION) {\n      props.deleteProject(props.project.id, props.project.project_name);\n    }\n    setThreeDotsAnchorElement(null);\n  };\n\n  return (\n    <li style={{ marginBottom: \"12px\" }}>\n      Project: {props.project.project_name}{\" \"}\n      <button onClick={rehearse} className=\"rehearse\">\n        Rehearse! \n      </button>\n      <IconButton\n        aria-label=\"more\"\n        aria-controls=\"project-menu\"\n        aria-haspopup=\"true\"\n        onClick={clickThreeDotsMenu}\n      >\n        <MoreHorizIcon />\n      </IconButton>\n      <Menu\n        id=\"project-menu\"\n        anchorEl={threeDotsAnchorElement}\n        keepMounted\n        open={threeDotsAnchorElement !== null}\n        onClose={closeThreeDotsMenu}\n        PaperProps={{\n          style: {\n            maxHeight: 40 * 4.5,\n            width: \"20ch\",\n          },\n        }}\n      >\n        {options.map((option) => (\n          <MenuItem key={option} onClick={closeThreeDotsMenu}>\n            {option}\n          </MenuItem>\n        ))}\n      </Menu>\n    </li>\n  );\n}\n\nexport default Project;\n","import React, { Component } from \"react\";\nimport Project from \"./Project\";\nimport \"./Group.css\";\nimport { Prompt, Confirm } from \"react-st-modal\";\n\nimport { socket } from \"../../App\";\n\nconst RENAME_GROUP_OPTION = \"Rename Group\";\nconst DELETE_GROUP_OPTION = \"Delete Group\";\n\nclass Group extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      projects: props.projects,\n      threeDotsAnchorElement: null,\n    };\n    this.createNewProject = this.createNewProject.bind(this);\n    this.deleteProject = this.deleteProject.bind(this);\n    this.renameProject = this.renameProject.bind(this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.projects !== prevProps.projects) {\n      this.setState({ projects: this.props.projects });\n    }\n  }\n\n  async createNewProject() {\n    const project_name = await Prompt(\"Name Your Project\");\n    if (project_name) {\n      const formData = new FormData();\n      formData.append(\"project_name\", project_name);\n      formData.append(\"group_id\", this.props.id);\n      const requestOptions = {\n        method: \"POST\",\n        body: formData,\n      };\n\n      fetch(\"/api/project\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status !== 400) {\n            this.setState({\n              projects: this.state.projects.concat([\n                {\n                  project_name: project_name,\n                  id: obj.body.project_id,\n                  project_hash: obj.body.project_hash,\n                },\n              ]),\n            });\n            socket.emit(\"broadcast update projects\");\n          }\n        });\n    }\n  }\n\n  async deleteProject(id, name) {\n    const result = await Confirm(\n      `Are you sure you want to delete \"${name}\"?`,\n      \"Delete Project\"\n    );\n    if (result) {\n      const formData = new FormData();\n      formData.append(\"project_id\", id);\n      const requestOptions = {\n        method: \"DELETE\",\n        body: formData,\n      };\n      fetch(\"/api/project\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            const updatedProjects = [...this.state.projects].filter(\n              (i) => i.id !== id\n            );\n            this.setState({\n              projects: updatedProjects,\n            });\n            socket.emit(\"broadcast update projects\");\n          }\n        });\n    }\n  }\n\n  async renameProject(id, name) {\n    const new_name = await Prompt(\"Rename Your Project\", {\n      defaultValue: name,\n    });\n    if (new_name) {\n      const formData = new FormData();\n      formData.append(\"project_id\", id);\n      formData.append(\"new_name\", new_name);\n      const requestOptions = {\n        method: \"PUT\",\n        body: formData,\n      };\n\n      fetch(\"/api/project\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            const updatedProjects = [\n              ...this.state.projects,\n            ].map((projectInfo) =>\n              projectInfo.id === id\n                ? { ...projectInfo, project_name: new_name }\n                : projectInfo\n            );\n            this.setState({\n              projects: updatedProjects,\n            });\n            socket.emit(\"broadcast update projects\");\n          }\n        });\n    }\n  }\n\n  clickThreeDotsMenu = (e) => {\n    this.setState({ threeDotsAnchorElement: e.currentTarget });\n  };\n\n  closeThreeDotsMenu = (e) => {\n    const option = e.target.innerText;\n    if (option === RENAME_GROUP_OPTION) {\n      this.props.renameGroup(this.props.id, this.props.name);\n    } else if (option === DELETE_GROUP_OPTION) {\n      this.props.deleteGroup(this.props.id, this.props.name);\n    }\n    this.setState({ threeDotsAnchorElement: null });\n  };\n\n  render() {\n    let sortedProjects = this.state.projects.sort((a, b) =>\n      a.id > b.id ? 1 : -1\n    );\n    return (\n      <div\n        style={{ marginTop: \"25px\", marginBottom: \"-15px\", marginLeft: \"2px\" }}\n      >\n        <p>\n          <b>Group: {this.props.name}</b>\n          {\"  \"}\n          <button\n            onClick={this.createNewProject}\n            style={{ marginLeft: \"5px\", height: \"25px\", cursor: \"pointer\" }}\n          >\n            + Project\n          </button>\n        </p>\n        <div style={{ marginTop: \"20px\" }}>\n          <ul>\n            {this.state.projects && this.state.projects.length === 0 && (\n              <p\n                className=\"text-muted\"\n                style={{ marginTop: \"-10px\", marginBottom: \"35px\" }}\n              >\n                No projects created yet!\n              </p>\n            )}\n            {sortedProjects.map((projectInfo, i) => (\n              <div key={`project_${i}`}>\n                <div style={{ marginTop: \"-20px\", marginBottom: \"-10px\" }}>\n                  <Project\n                    project={projectInfo}\n                    group_name={this.props.name}\n                    group_id={this.props.id}\n                    renameProject={this.renameProject}\n                    deleteProject={this.deleteProject}\n                  />\n                </div>\n              </div>\n            ))}\n          </ul>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Group;\n","import React, { Component } from \"react\";\nimport Group from \"./Group\";\nimport \"./Projects.css\";\n\nimport SyncRoundedIcon from \"@material-ui/icons/SyncRounded\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\n\nimport { socket } from \"../../App\";\n\nclass Projects extends Component {\n  constructor() {\n    super();\n    this.state = {\n      groups: [],\n      isLoaded: false,\n    };\n    this.fetchGroups();\n  }\n\n  // SOCKET IO LISTENER:\n  updateProjectsListener = () => {\n    console.log(\"[SOCKET.IO] receiving updateProjects\");\n    this.refresh();\n  };\n\n  componentDidMount() {\n    console.log(\"[SOCKET.IO] creating Projects page listener\");\n    socket.on(\"updateProjects\", this.updateProjectsListener);\n  }\n\n  componentWillUnmount() {\n    console.log(\"[SOCKET.IO] removing Projects page listener\");\n    socket.off(\"updateProjects\", this.updateProjectsListener);\n  }\n\n  fetchGroups = () => {\n    fetch(\"/api/groups\", {\n      method: \"GET\",\n    })\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((res) => {\n        if (res.status !== 400) {\n          this.setState({ groups: res.body, isLoaded: true });\n        }\n      });\n  };\n\n  refresh = () => {\n    this.fetchGroups();\n  };\n\n  render() {\n    if (!this.state.isLoaded) {\n      return <div>Loading...</div>;\n    }\n    return (\n      <div style={{ marginBottom: \"10px\" }}>\n        <h2 style={{ marginBottom: \"-25px\" }}>\n          PROJECTS\n          <Tooltip title=\"Refresh latest projects\" arrow placement=\"right\">\n            <IconButton\n              style={{ marginTop: \"-3px\" }}\n              disableRipple\n              aria-label=\"Sync\"\n              onClick={this.refresh}\n            >\n              <SyncRoundedIcon style={{ fontSize: 25 }} />\n            </IconButton>\n          </Tooltip>\n        </h2>\n        {this.state.groups && this.state.groups.length === 0 && (\n          <p style={{ marginTop: \"20px\" }} class=\"text-muted\">\n            Create a group first!\n          </p>\n        )}\n        {this.state.groups &&\n          this.state.groups.map((groupInfo, i) => (\n            <div key={`group_${i}`}>\n              <Group\n                id={groupInfo.id}\n                name={groupInfo.group_name}\n                projects={groupInfo.projects}\n                renameGroup={this.renameGroup}\n                deleteGroup={this.deleteGroup}\n              />\n            </div>\n          ))}\n      </div>\n    );\n  }\n}\n\nexport default Projects;\n","import React, { Component } from \"react\";\n\nclass Member extends Component {\n  removeMember = () => {\n    this.props.removeMember(this.props.id);\n  };\n\n  render() {\n    const hideRemoveButton = !this.props.onlyMemberInGroup;\n    return (\n      <div style={{ marginTop: \"10px\" }}>\n        <li>\n          Member: {this.props.name}{\" \"}\n          {hideRemoveButton && (\n            <button\n              onClick={this.removeMember}\n              style={{ marginLeft: \"5px\", cursor: \"pointer\" }}\n            >\n              Remove\n            </button>\n          )}\n        </li>\n      </div>\n    );\n  }\n}\n\nexport default Member;\n","import {\n  useDialog,\n  ModalContent,\n  ModalFooter,\n  ModalButton,\n} from \"react-st-modal\";\nimport { useState } from \"react\";\n\nimport Dropdown from \"react-dropdown\";\nimport \"react-dropdown/style.css\";\n\nexport default function AddMemberModalContent(props) {\n  const dialog = useDialog();\n\n  const [newUserId, setNewUserId] = useState(null);\n  const [newUserName, setNewUserName] = useState(null);\n\n  const _onSelect = (option) => {\n    console.log(\"Selected \" + option.label);\n    setNewUserId(option.value);\n    setNewUserName(option.label);\n  };\n\n  const userDropdownOptions = Object.keys(props.users)\n    .sort((a, b) => props.users[a].toLowerCase() > props.users[b].toLowerCase())\n    .reduce((acc, userid) => {\n      acc.push({\n        value: userid,\n        label: props.users[userid],\n      });\n      return acc;\n    }, []);\n\n  return (\n    <div>\n      <ModalContent>\n        <p>The dropdown lists all members on JamNSync:</p>\n        <div\n          style={{\n            height: 250,\n            width: 300,\n          }}\n        >\n          <Dropdown\n            options={userDropdownOptions}\n            onChange={_onSelect}\n            placeholder=\"Select a name\"\n          />\n        </div>\n      </ModalContent>\n      <ModalFooter>\n        <ModalButton\n          onClick={() => {\n            // lose the dialog and return the value\n            dialog.close([newUserId, newUserName]);\n          }}\n        >\n          OK\n        </ModalButton>\n        <ModalButton\n          onClick={() => {\n            dialog.close([newUserId, newUserName]);\n          }}\n          type={\"light\"}\n        >\n          Cancel\n        </ModalButton>\n      </ModalFooter>\n    </div>\n  );\n}\n","import React, { Component } from \"react\";\nimport Member from \"./Member\";\nimport \"./Group.css\";\n\nimport { CustomDialog, Confirm } from \"react-st-modal\"; // https://github.com/Nodlik/react-st-modal\nimport AddMemberModalContent from \"./AddMemberModal\";\n\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport MoreHorizIcon from \"@material-ui/icons/MoreHoriz\";\n\nimport { socket } from \"../../App\";\n\nconst RENAME_GROUP_OPTION = \"Rename Group\";\nconst DELETE_GROUP_OPTION = \"Delete Group\";\nconst options = [RENAME_GROUP_OPTION, DELETE_GROUP_OPTION];\n\nclass Group extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      group_membership: {},\n      threeDotsAnchorElement: null,\n    };\n    fetch(\"/api/group/members?group_id=\" + this.props.id, { method: \"GET\" })\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((res) => {\n        if (res.status !== 400) {\n          this.setState({ group_membership: res.body });\n        }\n      });\n    this.addMember = this.addMember.bind(this);\n    this.removeMember = this.removeMember.bind(this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.refresh !== prevProps.refresh) {\n      fetch(\"/api/group/members?group_id=\" + this.props.id, { method: \"GET\" })\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((res) => {\n          if (res.status !== 400) {\n            this.setState({ group_membership: res.body });\n          }\n        });\n    }\n  }\n\n  async addMember() {\n    console.log(\"adding member\");\n    // find all users\n    let all_users = await fetch(\"/api/users\", { method: \"GET\" })\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((res) => {\n        return res.body;\n      });\n\n    // perform get request to retrieve all available\n    const newMemberInfo = await CustomDialog(\n      <AddMemberModalContent users={all_users} />,\n      {\n        title: \"Add Member to \" + this.props.name,\n        showCloseIcon: true,\n      }\n    );\n    if (newMemberInfo === undefined || newMemberInfo === null) {\n      return;\n    }\n    const [newUserId, newUsername] = newMemberInfo;\n    // perform post request to add user\n    // console.log(\"newUserId:\", newUserId, \"newUsername:\", newUsername);\n    if (\n      newUserId &&\n      Object.keys(this.state.group_membership).includes(newUserId)\n    ) {\n      // group member already exists\n      alert(`${newUsername} is already a member in group \"${this.props.name}\"`);\n    } else if (newUserId && newUsername) {\n      const formData = new FormData();\n      formData.append(\"group_id\", this.props.id);\n      formData.append(\"user_id\", newUserId);\n      const requestOptions = {\n        method: \"POST\",\n        body: formData,\n      };\n      fetch(\"/api/group/members\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            const updatedMembership = Object.assign(\n              {},\n              this.state.group_membership\n            );\n            updatedMembership[newUserId] = newUsername;\n            this.setState({\n              group_membership: updatedMembership,\n            });\n            socket.emit(\"broadcast update groups\");\n          }\n        });\n    }\n  }\n\n  async removeMember(userid) {\n    console.log(\"removing member id:\", userid);\n    const username = this.state.group_membership[userid];\n    const result = await Confirm(\n      `Are you sure you want to remove \"${username}\" from \"${this.props.name}\"?`,\n      \"Remove Member\"\n    );\n    if (result) {\n      const formData = new FormData();\n      formData.append(\"group_id\", this.props.id);\n      formData.append(\"user_id\", userid);\n      const requestOptions = {\n        method: \"DELETE\",\n        body: formData,\n      };\n      fetch(\"/api/group/members\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            const updatedMembership = Object.assign(\n              {},\n              this.state.group_membership\n            );\n            delete updatedMembership[userid];\n            this.setState({\n              group_membership: updatedMembership,\n            });\n            socket.emit(\"broadcast update groups\");\n          }\n        });\n    }\n  }\n\n  clickThreeDotsMenu = (e) => {\n    this.setState({ threeDotsAnchorElement: e.currentTarget });\n  };\n\n  closeThreeDotsMenu = (e) => {\n    const option = e.target.innerText;\n    if (option === RENAME_GROUP_OPTION) {\n      this.props.renameGroup(this.props.id, this.props.name);\n    } else if (option === DELETE_GROUP_OPTION) {\n      this.props.deleteGroup(this.props.id, this.props.name);\n    }\n    this.setState({ threeDotsAnchorElement: null });\n  };\n\n  render() {\n    return (\n      <div style={{ marginBottom: \"-15px\" }}>\n        <p\n          style={{\n            marginTop: \"25px\",\n            marginBottom: \"-15px\",\n            marginLeft: \"2px\",\n          }}\n        >\n          <b>Group: {this.props.name}</b>\n          {\"  \"}\n          <button\n            onClick={this.addMember}\n            style={{ marginLeft: \"5px\", height: \"25px\", cursor: \"pointer\" }}\n          >\n            + Member\n          </button>\n          <IconButton\n            aria-label=\"more\"\n            aria-controls=\"group-menu\"\n            aria-haspopup=\"true\"\n            onClick={this.clickThreeDotsMenu}\n            style={{ marginLeft: \"2px\" }}\n          >\n            <MoreHorizIcon />\n          </IconButton>\n          <Menu\n            id=\"group-menu\"\n            anchorEl={this.state.threeDotsAnchorElement}\n            keepMounted\n            open={this.state.threeDotsAnchorElement !== null}\n            onClose={this.closeThreeDotsMenu}\n            PaperProps={{\n              style: {\n                maxHeight: 40 * 4.5,\n                width: \"20ch\",\n              },\n            }}\n          >\n            {options.map((option) => (\n              <MenuItem key={option} onClick={this.closeThreeDotsMenu}>\n                {option}\n              </MenuItem>\n            ))}\n          </Menu>\n        </p>\n        <ul>\n          {Object.keys(this.state.group_membership).map((userid) => {\n            const username = this.state.group_membership[userid];\n            return (\n              <div key={`member_${userid}`}>\n                <div>\n                  <Member\n                    id={userid}\n                    name={username}\n                    removeMember={this.removeMember}\n                    onlyMemberInGroup={\n                      Object.keys(this.state.group_membership).length === 1\n                    }\n                  />\n                </div>\n              </div>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n}\n\nexport default Group;\n","import React, { Component } from \"react\";\nimport \"./Groups.css\";\nimport Group from \"./Group\";\nimport { Confirm, Prompt } from \"react-st-modal\"; // https://github.com/Nodlik/react-st-modal\n\nimport SyncRoundedIcon from \"@material-ui/icons/SyncRounded\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\n\nimport { socket } from \"../../App\";\n\nclass Groups extends Component {\n  constructor() {\n    super();\n    this.state = {\n      groups: [],\n      isLoaded: false,\n      refresh: 0,\n    };\n    this.fetchGroups();\n    this.createNewGroup = this.createNewGroup.bind(this);\n    this.deleteGroup = this.deleteGroup.bind(this);\n    this.renameGroup = this.renameGroup.bind(this);\n  }\n\n  // SOCKET IO LISTENERS:\n\n  updateGroupsListener = () => {\n    console.log(\"[SOCKET.IO] receiving updateGroups\");\n    this.refresh();\n  };\n\n  // REACT MAIN FUNCTIONS\n\n  componentDidMount() {\n    console.log(\"[SOCKET.IO] creating Groups page listener\");\n    socket.on(\"updateGroups\", this.updateGroupsListener);\n  }\n\n  componentWillUnmount() {\n    console.log(\"[SOCKET.IO] removing Groups page listener\");\n    socket.off(\"updateGroups\", this.updateGroupsListener);\n  }\n\n  fetchGroups = () => {\n    fetch(\"/api/groups\", {\n      method: \"GET\",\n    })\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((res) => {\n        if (res.status !== 400) {\n          this.setState({ groups: res.body, isLoaded: true });\n        }\n      });\n  };\n\n  async createNewGroup() {\n    console.log(\"creating new group!\");\n    const group_name = await Prompt(\"Name Your Group\");\n    if (group_name) {\n      const formData = new FormData();\n      formData.append(\"group_name\", group_name);\n      const requestOptions = {\n        method: \"POST\",\n        body: formData,\n      };\n\n      fetch(\"/api/group\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status !== 400) {\n            this.setState({\n              groups: this.state.groups.concat([\n                { group_name: group_name, id: obj.body.group_id, projects: [] },\n              ]),\n            });\n          }\n        })\n        .catch((error) => {\n          alert(\n            'Server Error: Group name taken, use a different name instead of \"' +\n              group_name +\n              '\"!'\n          );\n        });\n    }\n  }\n\n  async deleteGroup(id, name) {\n    console.log(\"deleting group\");\n    const result = await Confirm(\n      `Are you sure you want to delete \"${name}\"?`,\n      \"Delete Group\"\n    );\n    if (result) {\n      const formData = new FormData();\n      formData.append(\"group_id\", id);\n      const requestOptions = {\n        method: \"DELETE\",\n        body: formData,\n      };\n      fetch(\"/api/group\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            const updatedGroups = [...this.state.groups].filter(\n              (i) => i.id !== id\n            );\n            this.setState({\n              groups: updatedGroups,\n            });\n            socket.emit(\"broadcast update groups\");\n          }\n        });\n    }\n  }\n\n  async renameGroup(id, name) {\n    console.log(\"renaming group\");\n    const new_name = await Prompt(\"Rename Your Group\", {\n      defaultValue: name,\n    });\n    if (new_name) {\n      const formData = new FormData();\n      formData.append(\"new_name\", new_name);\n      formData.append(\"group_id\", id);\n      const requestOptions = {\n        method: \"PUT\",\n        body: formData,\n      };\n\n      fetch(\"/api/group\", requestOptions)\n        .then((resp) =>\n          resp.json().then((data) => ({ status: resp.status, body: data }))\n        )\n        .then((obj) => {\n          if (obj.status === 200) {\n            const updatedGroups = [...this.state.groups].map((groupInfo) =>\n              groupInfo.id === id\n                ? { ...groupInfo, group_name: new_name }\n                : groupInfo\n            );\n            this.setState({\n              groups: updatedGroups,\n            });\n            socket.emit(\"broadcast update groups\");\n          }\n        });\n    }\n  }\n\n  refresh = () => {\n    console.log(\"refreshing groups\");\n    fetch(\"/api/groups\", {\n      method: \"GET\",\n    })\n      .then((resp) =>\n        resp.json().then((data) => ({ status: resp.status, body: data }))\n      )\n      .then((res) => {\n        if (res.status !== 400) {\n          this.setState({\n            groups: res.body,\n            isLoaded: true,\n            refresh: this.state.refresh + 1,\n          });\n        } else {\n          this.setState({ refresh: this.state.refresh + 1 });\n        }\n      });\n  };\n\n  render() {\n    if (!this.state.isLoaded) {\n      return <div>Loading...</div>;\n    }\n    return (\n      <div>\n        <h2 style={{ marginBottom: \"-35px\" }}>\n          REHEARSAL GROUPS\n          <Tooltip title=\"Refresh latest groups\" arrow placement=\"right\">\n            <IconButton\n              style={{ marginTop: \"-3px\" }}\n              disableRipple\n              aria-label=\"Sync\"\n              onClick={this.refresh}\n            >\n              <SyncRoundedIcon style={{ fontSize: 25 }} />\n            </IconButton>\n          </Tooltip>\n        </h2>\n        {this.state.groups &&\n          this.state.groups.map((groupInfo, i) => (\n            <div key={`group_${i}`}>\n              <Group\n                id={groupInfo.id}\n                name={groupInfo.group_name}\n                projects={groupInfo.projects}\n                renameGroup={this.renameGroup}\n                deleteGroup={this.deleteGroup}\n                refresh={this.state.refresh}\n              />\n            </div>\n          ))}\n        <button\n          style={{ marginTop: \"30px\" }}\n          className=\"stitched\"\n          onClick={this.createNewGroup}\n        >\n          + New Rehearsal Group\n        </button>\n      </div>\n    );\n  }\n}\n\nexport default Groups;\n","import React from \"react\";\nimport { Route, Redirect } from \"react-router-dom\";\n\nfunction PrivateRoute({ component: Component, authed, ...rest }) {\n  return (\n    <Route\n      {...rest}\n      render={(props) =>\n        authed === true ? (\n          <Component {...props} />\n        ) : (\n          <Redirect to={{ pathname: \"/\", state: { from: props.location } }} />\n        )\n      }\n    />\n  );\n}\n\nexport default PrivateRoute;\n","import React, { Component } from \"react\";\nimport { HashRouter, NavLink, Route } from \"react-router-dom\";\nimport { Redirect } from \"react-router\";\nimport { createHashHistory } from \"history\";\n\n// import Footer from \"./components/Footer\";\nimport Login from \"./components/Login\";\nimport Logout from \"./components/Logout\";\nimport Project from \"./routes/project/Project\";\nimport Home from \"./routes/home/Home\";\nimport Projects from \"./routes/projects/Projects\";\nimport Groups from \"./routes/groups/Groups\";\nimport PrivateRoute from \"./utils/components/PrivateRoute\";\n\nimport io from \"socket.io-client\";\nexport const socket = io(process.env.ROOT_URL);\n\nconst history = createHashHistory();\n\nclass App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      userDetails: {},\n      isUserLoggedIn: false,\n    };\n  }\n\n  componentDidMount() {\n    if (history.location.pathname === \"/\") {\n      history.replace(\"/home\");\n    }\n\n    let userDetails = JSON.parse(localStorage.getItem(\"userDetails\"));\n    let isUserLoggedIn = localStorage.getItem(\"isUserLoggedIn\") === \"true\";\n    if (isUserLoggedIn && !this.state.isUserLoggedIn) {\n      this.setState({\n        userDetails: userDetails,\n        isUserLoggedIn: isUserLoggedIn,\n      });\n    }\n  }\n\n  componentDidUpdate(prevState) {\n    if (\n      !this.state.isUserLoggedIn &&\n      prevState.isUserLoggedIn &&\n      history.location.pathname === \"/\"\n    ) {\n      history.replace(\"/home\");\n    }\n  }\n\n  handleSuccessfulLogin = (response) => {\n    const userDetails = response.profileObj;\n    const formData = new FormData();\n    formData.append(\"google_auth_id\", userDetails.googleId);\n    formData.append(\"google_email\", userDetails.email);\n    formData.append(\"user_name\", userDetails.name);\n    const requestOptions = {\n      method: \"POST\",\n      body: formData,\n    };\n\n    fetch(\"/auth/login\", requestOptions)\n      .then((resp) => resp.json())\n      .then((res) => {\n        console.log(res.message);\n        localStorage.setItem(\"userDetails\", JSON.stringify(userDetails));\n        localStorage.setItem(\"isUserLoggedIn\", true);\n        this.setState({ userDetails: userDetails, isUserLoggedIn: true });\n      });\n  };\n\n  handleSuccessfulLogout = () => {\n    fetch(\"/auth/logout\", { method: \"POST\" })\n      .then((resp) => resp.json())\n      .then((res) => {\n        console.log(res.message);\n        localStorage.clear();\n        this.setState({ userDetails: {}, isUserLoggedIn: false });\n      })\n      .catch((err) => {\n        console.log(\"ERROR:\", err);\n        localStorage.clear();\n        this.setState({ userDetails: {}, isUserLoggedIn: false });\n        history.replace(\"/home\");\n      });\n  };\n\n  render() {\n    // default to groups page if no history, otherwise go to last page before refresh\n    let pathname = history.location.pathname;\n    return (\n      <HashRouter history={history}>\n        <div>\n          <h1>JamNSync</h1>\n          <div style={{ position: \"absolute\", right: 20, top: 35 }}>\n            {!this.state.isUserLoggedIn && (\n              <Login onSuccessfulLogin={this.handleSuccessfulLogin} />\n            )}\n            {this.state.isUserLoggedIn && (\n              <div style={{ display: \"flex\" }}>\n                <div>\n                  <p>Welcome, {this.state.userDetails.givenName}!</p>\n                </div>\n                <div style={{ marginLeft: \"5px\" }}>\n                  <Logout onSuccessfulLogout={this.handleSuccessfulLogout} />\n                </div>\n              </div>\n            )}\n          </div>\n\n          <ul className=\"header\">\n            <li>\n              <NavLink to=\"/home\">Home</NavLink>\n            </li>\n            {this.state.isUserLoggedIn && (\n              <li>\n                <NavLink to=\"/groups\">Groups</NavLink>\n              </li>\n            )}\n            {this.state.isUserLoggedIn && (\n              <li>\n                <NavLink to=\"/projects\">Projects</NavLink>\n              </li>\n            )}\n          </ul>\n\n          <div className=\"content\">\n            <Route exact path=\"/\">\n              {this.state.isUserLoggedIn && pathname !== \"/\" ? (\n                <Redirect to={pathname} />\n              ) : (\n                <Home authed={this.state.isUserLoggedIn} />\n              )}\n            </Route>\n            <Route path=\"/home\">\n              <Home authed={this.state.isUserLoggedIn} />\n            </Route>\n            <PrivateRoute\n              path=\"/projects\"\n              component={Projects}\n              authed={this.state.isUserLoggedIn}\n            />\n            <PrivateRoute\n              path=\"/groups\"\n              component={Groups}\n              authed={this.state.isUserLoggedIn}\n            />\n            <PrivateRoute\n              path=\"/project/\"\n              component={Project}\n              authed={this.state.isUserLoggedIn}\n            />\n          </div>\n        </div>\n      </HashRouter>\n    );\n  }\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <App />,\n  document.getElementById(\"root\")\n);"],"sourceRoot":""}