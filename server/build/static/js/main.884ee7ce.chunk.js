(this.webpackJsonpjamnsync=this.webpackJsonpjamnsync||[]).push([[0],{137:function(e,t,a){},138:function(e,t,a){},143:function(e,t,a){},149:function(e,t,a){},150:function(e,t,a){},151:function(e,t,a){},152:function(e,t,a){},183:function(e,t,a){},184:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a(0),s=a(6),o=a.n(s),c=a(17),i=a(18),l=a(21),u=a(20),p=a(49),d=a(15),h=a(31),j=a(73),m=a(5),g=a.n(m),b=a(12);var f=function(e){return Object(r.jsx)("div",{children:Object(r.jsx)(j.GoogleLogin,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Login",onSuccess:function(t){!function(e){var t=1e3*(e.tokenObj.expires_in||3300),a=function(){var r=Object(b.a)(g.a.mark((function r(){var n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.reloadAuthResponse();case 2:n=r.sent,t=1e3*(n.expires_in||3300),console.log("newAuthRes:",n),localStorage.setItem("authToken",n.id_token),setTimeout(a,t);case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();setTimeout(a,t)}(t),e.onSuccessfulLogin(t)},onFailure:function(e){console.log("Attempt to login failed. Error:",e),alert("Login error: "+e.error+". ")},cookiePolicy:"single_host_origin",style:{marginTop:"100px"},isSignedIn:!0})})};var O=function(e){return Object(r.jsx)("div",{children:Object(r.jsx)(j.GoogleLogout,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:function(){e.onSuccessfulLogout()}})})},k=a(14),x=a(34),y=(a(137),a(138),a(75)),v=a.n(y),T=(a(99),a(8)),S=a(80),_=(a(100),a(207)),w=a(213),C=a(211),P=a(214),R=a(55),L=a.n(R),I=a(89),G=a.n(I),D=a(88),M=a.n(D),E="+ Upload File",U="Rename Track",F="Delete Track",A=[E,U,F],N=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var r;if(Object(c.a)(this,a),(r=t.call(this,e)).stop=function(){r.audioFile.currentTime=0,r.audioFile.pause(),r.setState({playing:!1})},r.changeVolume=function(e){var t=e;r.audioFile.volume=r.props.masterVolume/100*t,r.setState({volume:t})},r.seek=function(e){r.audioFile.currentTime=e,r.audioFile.pause(),r.state.playing&&r.audioFile.play()},r.fastForward=function(){r.audioFile.pause();var e=r.audioFile.duration(),t=r.audioFile.currentTime,a=t+5;if(a>=e)return r.audioFile.currentTime=0,void r.audioFile.pause();console.log("ff: "+t+" -> "+a),r.audioFile.currentTime=a,r.state.playing&&r.audioFile.play()},r.rewind=function(){r.audioFile.pause();var e=r.audioFile.currentTime,t=e-5;t<=0&&(t=0),console.log("rewind: "+e+" -> "+t),r.audioFile.currentTime=t,r.state.playing&&r.audioFile.play()},r.mute=function(){r.props.updateMutedTracks(r.props.trackId),r.audioFile.muted=!r.state.muted,r.setState({muted:!r.state.muted})},r.solo=function(){r.props.updateSoloTracks(r.props.trackId),r.state.soloing?r.setState({soloing:!1}):(r.audioFile.muted=!1,r.setState({soloing:!0,muted:!1}))},r.selectToRecord=function(){var e=r.state.selected?null:r.props.trackId;r.props.setSelectedTrack(e),r.setState({selected:!r.state.selected})},r._onSelect=function(e){console.log("Selected "+e.label),r.audioFile.currentTime=0,r.audioFile.pause();var t=r.props.takes[e.value].s3_info;r.setState({playing:!1,selectedTake:e.value,s3URL:t}),r.audioFile=document.getElementById("audio-file-".concat(r.props.trackId))},r.clickThreeDotsMenu=function(e){r.setState({threeDotsAnchorElement:e.currentTarget})},r.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===E?document.getElementById("file-upload-".concat(r.props.trackId)).click():t===U?r.props.renameTrack(r.props.trackId,r.props.trackName):t===F&&r.props.deleteTrack(r.props.trackId,r.props.trackName),r.setState({threeDotsAnchorElement:null})},r.state={selected:!1,playing:!1,muted:!1,s3URL:null,selectedTake:null,latestTake:0,soloing:!1,volume:84.95,threeDotsAnchorElement:null},r.audioFile=null,0!==Object.keys(e.takes).length){var n=Object.keys(e.takes).pop(),s=e.takes[n].s3_info;s&&(r.state.s3URL=s,r.state.selectedTake=n,r.audioFile=document.getElementById("audio-file-".concat(r.props.trackId)))}return r.deleteTake=r.deleteTake.bind(Object(k.a)(r)),r}return Object(i.a)(a,[{key:"componentDidMount",value:function(){if(0!==Object.keys(this.props.takes).length){var e=Object.keys(this.props.takes).pop(),t=this.props.takes[e].s3_info;t&&(this.setState({s3URL:t,selectedTake:e,latestTake:e}),this.audioFile=document.getElementById("audio-file-".concat(this.props.trackId)))}else this.setState({selectedTake:null,s3URL:null,latestTake:0})}},{key:"componentDidUpdate",value:function(e){if(this.state.s3URL&&null===this.audioFile?this.audioFile=document.getElementById("audio-file-".concat(this.props.trackId)):null===this.state.s3URL&&null!==this.audioFile&&(this.audioFile=null),this.state.selected&&this.props.selectedTrackId!==this.props.trackId&&this.setState({selected:!1}),null!==this.state.selectedTake&&this.state.latestTake===Object.keys(this.props.takes).pop()||0===Object.keys(this.props.takes).length)0===Object.keys(this.props.takes).length&&this.state.s3URL&&this.setState({selectedTake:null,s3URL:null,latestTake:0});else{var t=Object.keys(this.props.takes).pop(),a=this.props.takes[t].s3_info;a&&this.setState({latestTake:t,selectedTake:t,s3URL:a})}this.props.masterPlay&&this.audioFile&&!this.state.playing&&(!this.state.selected||this.state.selected&&!this.props.masterRecord)?(console.log("[TRACK: ".concat(this.props.trackName,"] playing: ").concat(this.state.s3URL)),this.audioFile.currentTime=0,this.audioFile.play(),this.setState({playing:!0})):this.props.masterStop&&this.audioFile&&this.state.playing&&(this.audioFile.pause(),this.setState({playing:!1})),this.state.soloing||0===this.props.soloTracks.length||this.state.muted||!this.state.s3URL?0===this.props.soloTracks.length&&this.state.muted&&this.state.s3URL&&0!==e.soloTracks.length&&(this.audioFile.muted=!1,this.setState({muted:!1})):(this.audioFile.muted=!0,this.setState({muted:!0})),this.state.s3URL&&e.masterVolume!==this.props.masterVolume&&(this.audioFile.volume=Math.min(1,this.props.masterVolume))}},{key:"componentWillUnmount",value:function(){this.audioFile&&this.audioFile.pause()}},{key:"deleteTake",value:function(){var e=Object(b.a)(g.a.mark((function e(){var t,a,r,n,s,o,c,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting take"),t=this.state.selectedTake,a=this.props.takes[t],r=-1!==a.date_uploaded.lastIndexOf(" ")?new Date(a.date_uploaded.substr(0,a.date_uploaded.lastIndexOf(" ")+1)):new Date(a.date_uploaded),n=r.toLocaleString("en-US"),s="Take ".concat(t," - ").concat(n),e.next=8,Object(T.a)('Are you sure you want to delete "'.concat(s,'"?'),"Delete Take");case 8:if(!e.sent){e.next=15;break}return this.audioFile&&(this.audioFile.currentTime=0,this.audioFile.pause()),e.next=13,this.props.deleteTake(this.props.trackId,t,a.id);case 13:o=null,Object.keys(this.props.takes).length>1?((c=Object.keys(this.props.takes)).splice(c.indexOf(t),1),o=Math.max.apply(Math,c),i=this.props.takes[o].s3_info,this.setState({playing:!1,selectedTake:o,s3URL:i,latestTake:o})):(console.log("unsetting audio file"),this.setState({playing:!1,selectedTake:o,s3URL:null,latestTake:0}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t={value:this.state.selectedTake},a=Object.keys(this.props.takes).reduce((function(a,r){if(parseInt(r)<=parseInt(e.state.latestTake)){var n=e.props.takes[r].date_uploaded,s=new Date(n).toLocaleString("en-US");r===e.state.selectedTake&&(t.label="Take ".concat(r," - ").concat(s)),a.push({value:r,label:"Take ".concat(r," - ").concat(s)})}return a}),[]).reverse(),n=this.state.selected?"Unselect":"Select to Record";return Object(r.jsxs)("div",{style:{marginLeft:"5px"},children:[Object(r.jsx)("hr",{}),Object(r.jsxs)("div",{children:[this.state.selected?Object(r.jsxs)("div",{style:{display:"inline-block"},children:[Object(r.jsx)("img",{src:"images/daw/selected.png",alt:"selected",width:"10",height:"10"})," ",Object(r.jsxs)("b",{children:["Track: ",this.props.trackName]})," "]}):Object(r.jsxs)("div",{style:{display:"inline-block"},children:["Track: ",this.props.trackName," "]}),Object(r.jsx)("button",{title:"Select/unselect track for recording",onClick:this.selectToRecord,style:{marginLeft:"5px"},children:n}),Object(r.jsx)(_.a,{"aria-label":"more","aria-controls":"track-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"5px"},children:Object(r.jsx)(L.a,{})}),Object(r.jsx)("input",{type:"file",id:"file-upload-".concat(this.props.trackId),hidden:!0,onChange:function(t){e.props.handleFileUpload(t.target.files,e.props.trackId)}}),Object(r.jsx)(C.a,{id:"track-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:A.map((function(t){return Object(r.jsx)(P.a,{onClick:e.closeThreeDotsMenu,children:t},t)}))})]}),this.state.s3URL&&Object.keys(this.props.takes).length>0&&Object(r.jsxs)("div",{style:{marginBottom:"18px",marginTop:"-12px"},children:[Object(r.jsx)(w.a,{title:"Mute",arrow:!0,children:Object(r.jsx)(_.a,{disableRipple:!0,"aria-label":"Mute this track",onClick:this.mute,style:{marginTop:"5px"},children:this.state.muted?Object(r.jsx)(M.a,{style:{fontSize:20},color:"secondary"}):Object(r.jsx)(M.a,{style:{fontSize:20}})})}),Object(r.jsx)(w.a,{title:"Solo",arrow:!0,children:Object(r.jsx)(_.a,{disableRipple:!0,"aria-label":"Solo this track",onClick:this.solo,style:{marginTop:"5px"},children:this.state.soloing?Object(r.jsx)(G.a,{style:{fontSize:20},color:"secondary"}):Object(r.jsx)(G.a,{style:{fontSize:20}})})}),Object(r.jsxs)("div",{style:{display:"inline-block",marginLeft:"10px",marginRight:"10px",width:"55px"},children:["Volume",Object(r.jsx)(S.a,{min:0,max:100,defaultValue:100,onChange:this.changeVolume})]}),Object(r.jsx)("audio",{id:"audio-file-".concat(this.props.trackId),src:"".concat(this.state.s3URL,"?cacheblock=true"),preload:"auto",autobuffer:"true"}),Object(r.jsx)("div",{style:{marginLeft:"20px",marginTop:"10px",display:"inline-flex",position:"absolute",width:310},children:Object(r.jsx)(v.a,{options:a,onChange:this._onSelect,value:t,placeholder:"Select an option"})}),Object(r.jsxs)("div",{style:{display:"inline-flex",position:"absolute",marginLeft:"330px",marginTop:"15px"},children:[Object(r.jsx)("form",{method:"get",action:"".concat(this.state.s3URL,"?cacheblock=true"),children:Object(r.jsx)("button",{type:"submit",children:"Download Take"})}),Object(r.jsx)("button",{disabled:this.props.masterPlay,onClick:this.deleteTake,children:"Delete Take"})]})]})]})}}]),a}(n.Component),q=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return Object(r.jsxs)("div",{style:{display:"flex",marginBottom:"-8px"},children:[Object(r.jsx)("img",{style:{marginLeft:"10px",marginRight:"5px",marginTop:"10px"},src:"images/daw/loading.gif",alt:"loading",width:"32",height:"32"}),Object(r.jsx)("p",{children:" ".concat(this.props.text)})]})}}]),a}(n.Component),B=a(120),K=a(13),V=(a(143),a(90)),z=a.n(V),W=a(91),H=a.n(W),J=a(79),Y=a.n(J);function $(e){var t=Object(T.g)(),a=Object(n.useState)(!1),s=Object(K.a)(a,2),o=s[0],c=s[1],i=Object(n.useState)(null),l=Object(K.a)(i,2),u=l[0],p=l[1],d=Object(n.useState)(null),h=Object(K.a)(d,2),j=h[0],m=h[1],f=Object(n.useState)(null),O=Object(K.a)(f,2),k=O[0],y=O[1],v=Object(n.useState)(null),S=Object(K.a)(v,2),_=S[0],w=S[1],C=Object(n.useState)(!1),P=Object(K.a)(C,2),R=P[0],L=P[1],I=Object(n.useState)(null),G=Object(K.a)(I,2),D=(G[0],G[1]),M=Object(n.useState)(0),E=Object(K.a)(M,2),U=E[0],F=E[1],A=Object(n.useState)(0),N=Object(K.a)(A,2),B=N[0],V=N[1],W=Object(n.useCallback)((function(e,t){console.log("stopped:",t.x);var a=12.5053*t.x+7.3617;console.log(a),F(t.x),V(a)}),[]);return Object(n.useEffect)((function(){y(z.a.create({container:"#bg_waveform",waveColor:"#D9DCFF",progressColor:"#4353ff",cursorColor:"#4353ff",cursorWidth:1,height:200,width:1e3,interact:!1,hideScrollbar:!0})),w(z.a.create({container:"#rec_waveform",waveColor:"#D9DCFF",progressColor:"#4353ff",cursorColor:"#4353ff",cursorWidth:1,height:200,width:1e3,interact:!1,hideScrollbar:!0}))}),[]),Object(n.useEffect)((function(){k&&_&&t&&!t.isOpen&&(k.stop(),_.stop())}),[k,_,R,t]),Object(n.useEffect)((function(){if(k&&_&&!R){var t=new Y.a,a=Object.keys(e.trackMetadata).filter((function(t){return t!==e.recordedTrackId&&!e.mutedTracks.includes(t)&&Object.keys(e.trackMetadata[t].takes).length>0})).map((function(t){var a=Object.keys(e.trackMetadata[t].takes).pop(),r=e.trackMetadata[t].takes[a].s3_info+"?cacheblock=true";return console.log("audio url:"+r),r}));console.log("audio alignment tool: # tracks stacked together = "+a.length),a.length>1?(console.log("using crunker to combine recordings"),t.fetchAudio.apply(t,Object(x.a)(a)).then((function(e){return t.mergeAudio(e)})).then((function(e){return t.export(e,"audio/mp3")})).then((function(t){D(t.url),k.load(t.url),_.load(e.recordedURL),k.setVolume(.3),_.setVolume(.3),k.zoom(80),_.zoom(80),L(!0)}))):(console.log("using single track as backing track"),D(a[0]),k.load(a[0]),_.load(e.recordedURL),k.setVolume(.3),_.setVolume(.3),k.zoom(80),_.zoom(80),L(!0))}}),[k,_,R,e]),Object(r.jsx)("div",{className:"outerDiv",children:Object(r.jsxs)("div",{children:[Object(r.jsx)(H.a,{axis:"x",bounds:{left:-285,right:285},children:Object(r.jsxs)("div",{className:"cursor",children:[Object(r.jsx)("div",{className:"point"}),Object(r.jsx)("div",{className:"startLine"})]})}),Object(r.jsxs)(T.d,{children:[R?Object(r.jsx)("p",{children:"Drag your recording left/right to align it, and move the cursor like a ruler to align peaks!"}):Object(r.jsx)(q,{text:"Preparing alignment tool..."}),Object(r.jsx)("p",{children:Object(r.jsx)("b",{children:"Backing Tracks"})}),Object(r.jsx)("div",{id:"bg_waveform"}),Object(r.jsx)("p",{children:Object(r.jsx)("b",{children:"Recording"})}),Object(r.jsx)(H.a,{axis:"x",onStop:W,children:Object(r.jsx)("div",{id:"rec_waveform",style:{marginLeft:"-240px"}})})]}),Object(r.jsxs)(T.e,{children:[Object(r.jsx)(T.c,{onClick:Object(b.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.stop(),_.stop(),clearTimeout(u),e.next=5,Object(T.a)("Are you sure you want to scrap this recording?","Scrap Recording");case 5:e.sent&&(console.log("scrapping recording"),t.close("scrap"));case 7:case"end":return e.stop()}}),e)}))),type:"danger",children:"Scrap Recording"}),Object(r.jsx)(T.c,{onClick:function(){if(o)k.pause(),_.pause(),clearTimeout(u),clearTimeout(j);else if(console.log("offset:",U),k.params.scrollParent=!1,_.params.scrollParent=!1,k.seekTo(0),_.seekAndCenter(3/_.getDuration()),U>0)console.log("[recorded early]: user wants to playback later"),console.log(B),p(setTimeout((function(){c(!1)}),7e3)),k.play(null,7),m(setTimeout((function(){_.play(3,10-B/1e3)}),B));else if(U<0){console.log("[recorded late]: user wants to playback earlier");var e=-B;console.log(e),p(setTimeout((function(){c(!1)}),7e3)),k.play(null,7),_.play(3+e/1e3,10+e/1e3)}else p(setTimeout((function(){c(!1)}),7e3)),k.play(null,7),_.play(3,10);c(!o)},children:o?"Stop":"Play"}),Object(r.jsx)(T.c,{onClick:function(){k.stop(),_.stop(),clearTimeout(u),console.log("returning value:",B),t.close(Math.round(B))},children:"Submit"})]})]})})}var Q=a(123),X=a.n(Q),Z=a(122),ee=a.n(Z),te=a(121),ae=a.n(te),re=a(92),ne=a.n(re),se=window.AudioContext||window.webkitAudioContext,oe=window.WebAudioRecorder,ce=new Y.a,ie=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).beginGroupPlayListener=function(){console.log("[SOCKET.IO] receiving begin group play"),e.toggleMasterPlay(),e.setState({requestingGroupPlayback:!1,preparedGroupAction:null})},e.beginGroupStopListener=function(t){if(console.log("[SOCKET.IO] receiving begin group stop for "+e.props.projectName),!e.state.receivedImmediateStop){e.setState({receivedImmediateStop:!0}),e.toggleMasterStop();var a=JSON.parse(localStorage.getItem("userDetails")).name;"string"===typeof t.stopped_by&&t.stopped_by!==a&&alert("".concat(t.stopped_by," stopped!"))}},e.beginGroupRecordListener=function(){console.log("[SOCKET.IO] receiving begin group record"),e.toggleMasterRecord(),e.setState({requestingGroupRecord:!1,preparedGroupAction:null})},e.updateNumPreparedListener=function(t){console.log("[SOCKET.IO] updating number of prepared group members"),e.setState({numGroupMembersPrepared:t.num_prepared,numGroupMembersTotal:t.num_total,preparedGroupAction:t.action})},e.notifyWaitingGroupMember=function(){var t=Object(b.a)(g.a.mark((function t(a){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[SOCKET.IO] received request from group member "+a.requester+" to request "+a.action),t.next=3,Object(T.a)("".concat(a.requester," wants to group ").concat(a.action,". Ready to join?"),"Incoming Request","Yes","No");case 3:t.sent?(console.log("[SOCKET.IO] ready to join for ".concat(a.action,"!")),"play"===a.action?e.requestGroupPlay():e.requestGroupRecord()):(console.log("[SOCKET.IO] not ready to join for ".concat(a.action,"...")),e.setState({preparedGroupAction:a.action}));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.createTrack=function(){e.props.createTrack()},e.renameTrack=function(t,a){e.props.renameTrack(t,a)},e.deleteTrack=function(t,a){e.props.deleteTrack(t,a)&&e.setState({selectedTrackId:null})},e.createTake=function(t,a,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.props.createTake(t,a,r,n)},e.deleteTake=function(t,a,r){e.props.deleteTake(t,a,r)},e.toggleMasterPlay=function(){console.log("> master play"),e.state.masterPlay||e.setState((function(t){var a=Date.now()-e.state.runningTime;return e.timer=setInterval((function(){e.setState({runningTime:Date.now()-a})})),{masterPlay:!0}}))},e.startMicrophone=function(){console.log("[RECORDING] start microphone"),e.audioContext=new se,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){console.log("[RECORDING] getUserMedia() success, stream created, initializing WebAudioRecorder..."),e.gumStream=t,e.input=e.audioContext.createMediaStreamSource(t),e.recorder=new oe(e.input,{workerDir:"js/",encoding:"mp3",numChannels:2}),e.recorder.setOptions({timeLimit:600,encodeAfterRecord:!0,mp3:{bitRate:256}}),e.recorder.onComplete=function(){var t=Object(b.a)(g.a.mark((function t(a,r){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[RECORDING] encoding complete"),e.gumStream.getAudioTracks()[0].stop(),t.next=4,e.stopMicrophone(r);case 4:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.recorder.startRecording()}))},e.handleFileUpload=function(t,a){if(console.log("handling file upload for target track id",a),null!==t&&null!==t[0]&&"undefined"!==typeof t[0])if(/\.(mp3|ogg|wav|flac|aac|aiff|m4a)$/i.test(t[0].name)){console.log("> validated file: ",t[0].name);e.createTake(a,t[0],!0)}else alert("Please upload valid audio file type (mp3, ogg, wav, flac, aac, aiff, m4a)")},e.setSelectedTrack=function(t){var a=null!==t?t:null;console.log("selecting track to record: "+a),e.setState({selectedTrackId:a})},e.formattedTime=function(e){var t=Math.floor(e/6e4),a=(e%6e4/1e3).toFixed(2);return t+":"+(a<10?"0":"")+a},e.updateSoloTracks=function(t){var a=Object(x.a)(e.state.soloTracks),r=a.indexOf(t);-1!==r?a.splice(r,1):a.push(t),console.log("new solo tracks:",a),e.setState({soloTracks:a})},e.updateMutedTracks=function(t){var a=Object(x.a)(e.state.mutedTracks),r=a.indexOf(t);-1!==r?a.splice(r,1):a.push(t),console.log("new muted tracks:",a),e.setState({mutedTracks:a})},e.changeVolume=function(t){e.setState({masterVolume:t/100})},e.rehearse=function(){console.log("currently rehearsing:",e.state.isRehearsing),e.setState({isRehearsing:!e.state.isRehearsing})},e.downloadMixedTrack=function(){console.log("downloading track");var t=Object.keys(e.props.trackMetadata).filter((function(t){return 0!==Object.keys(e.props.trackMetadata[t].takes).length})).map((function(t){var a=e.props.trackMetadata[t].takes,r=Object.keys(a).pop();return console.log(r),a[r].s3_info+"?cacheblock=true"}));console.log(t),ce.fetchAudio.apply(ce,Object(x.a)(t)).then((function(e){return ce.mergeAudio(e)})).then((function(e){return ce.export(e,"audio/mp3")})).then((function(t){var a=document.createElement("a");a.href=t.url;var r=new Date,n="".concat(r.getFullYear(),"_").concat(r.getMonth()+1,"_").concat(r.getDate()),s="".concat(r.getHours(),"_").concat(r.getMinutes(),"_").concat(r.getDate(),"_").concat(r.getHours()>=12?"PM":"AM"),o="".concat(e.props.projectName,"_").concat(n,"-").concat(s);a.setAttribute("download",o),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a)}))},e.requestGroupPlay=function(){console.log("[SOCKET.IO] requesting group play"),Re.emit("prepare group play",{channel:e.props.projectHash},(function(t){t?e.toggleMasterPlay():e.setState({requestingGroupPlayback:!0,preparedGroupAction:"play"})}))},e.requestGroupStop=function(){console.log("[SOCKET.IO] request immediate group stop");var t=JSON.parse(localStorage.getItem("userDetails")).name;Re.emit("immediate group stop",{channel:e.props.projectHash,user:t})},e.requestGroupRecord=function(){console.log("[SOCKET.IO] request group record"),null===e.state.selectedTrackId?alert("Select a track before requesting group record!"):Re.emit("prepare group record",{channel:e.props.projectHash},(function(t){t?e.toggleMasterRecord():e.setState({requestingGroupRecord:!0,preparedGroupAction:"record"})}))},e.cancelRequest=function(){console.log("[SOCKET.IO] cancel current request"),Re.emit("cancel request",{channel:e.props.projectHash},(function(){e.setState({requestingGroupPlayback:!1,requestingGroupRecord:!1,preparedGroupAction:null})}))},e.createAnnotation=function(t){32===t.keyCode&&e.state.masterPlay&&console.log("SPACE BAR PRESS:"+e.formattedTime(e.state.runningTime))},e.state={masterPlay:!1,masterStop:!1,masterRecord:!1,isRecording:!1,selectedTrackId:null,isBlocked:!0,showCountdown:!1,runningTime:0,mutedTracks:[],soloTracks:[],masterVolume:.5,initialLoad:!0,isRehearsing:!1,stopMicProcessing:!1,requestingGroupRecord:!1,requestingGroupPlayback:!1,receivedImmediateStop:!1,numGroupMembersPrepared:1,numGroupMembersTotal:1,preparedGroupAction:null},e.audioContext=null,e.gumStream=null,e.input=null,e.recorder=null,e.toggleMasterRecord=e.toggleMasterRecord.bind(Object(k.a)(e)),e.toggleMasterStop=e.toggleMasterStop.bind(Object(k.a)(e)),e.stopMicrophone=e.stopMicrophone.bind(Object(k.a)(e)),e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){console.log("mic permission granted"),e.setState({isBlocked:!1})})).catch((function(){console.log("MIC PERMISSIOM DENIED"),e.setState({isBlocked:!0})})),this.setState({isRecording:!1,masterRecord:!1,selectedTrackId:null,soloTracks:[],mutedTracks:[]}),console.log("[SOCKET.IO] ".concat(this.props.projectName," | creating DAW listeners")),Re.on("beginGroupPlay",this.beginGroupPlayListener),Re.on("beginGroupStop",this.beginGroupStopListener),Re.on("beginGroupRecord",this.beginGroupRecordListener),Re.on("updateNumPrepared",this.updateNumPreparedListener),Re.on("notifyWaitingGroupMember",this.notifyWaitingGroupMember),document.body.addEventListener("keypress",this.createAnnotation)}},{key:"componentDidUpdate",value:function(){this.state.initialLoad&&(0===Object.keys(this.props.trackMetadata).length&&this.createTrack(),this.setState({initialLoad:!1})),this.state.masterPlay&&this.state.masterStop&&this.setState({masterPlay:!1,masterStop:!1,runningTime:0})}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] ".concat(this.props.projectName," | removing DAW listeners")),Re.off("beginGroupPlay",this.beginGroupPlayListener),Re.off("beginGroupStop",this.beginGroupStopListener),Re.off("beginGroupRecord",this.beginGroupRecordListener),Re.off("updateNumPrepared",this.updateNumPreparedListener),Re.off("notifyWaitingGroupMember",this.notifyWaitingGroupMember),document.body.removeEventListener("keypress",this.createAnnotation)}},{key:"toggleMasterStop",value:function(){console.log("> master stop"),clearInterval(this.timer),this.state.masterPlay&&(this.state.isRecording?(this.setState({masterStop:!0,runningTime:0,stopMicProcessing:!0,receivedImmediateStop:!1}),this.gumStream.getAudioTracks()[0].stop(),this.recorder.finishRecording()):this.setState({masterStop:!0,runningTime:0,receivedImmediateStop:!1}))}},{key:"toggleMasterRecord",value:function(){var e=Object(b.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("> master record"),null===this.state.selectedTrackId?alert("Select a track to record!"):(console.log("recording track "+this.state.selectedTrackId),this.startMicrophone(),this.setState((function(e){return{masterRecord:!0,showCountdown:!0,isRecording:!0}})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopMicrophone",value:function(){var e=Object(b.a)(g.a.mark((function e(t){var a,n,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[RECORDING] stopping microphone"),a=new File([t],"recording_track_".concat(this.state.selectedTrackId,".mp3")),n=URL.createObjectURL(a),s=0,this.setState({stopMicProcessing:!1}),!(Object.keys(this.props.trackMetadata).length>1)){e.next=13;break}return e.next=9,Object(T.b)(Object(r.jsx)($,{recordedURL:n,recordedTrackId:this.state.selectedTrackId,trackMetadata:this.props.trackMetadata,mutedTracks:this.state.mutedTracks}),{title:"Check Recording",showCloseIcon:!0,isCanClose:!1});case 9:if("scrap"!==(s=e.sent)){e.next=13;break}return this.setState({isRecording:!1,masterRecord:!1}),e.abrupt("return");case 13:!1,this.createTake(this.state.selectedTrackId,a,false,s),this.setState({isRecording:!1,masterRecord:!1});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.numOnlineUsers>1;return Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{children:this.props.trackMetadata&&Object.keys(this.props.trackMetadata).length>0?Object.keys(this.props.trackMetadata).map((function(t){var a=e.props.trackMetadata[t];return Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{children:Object(r.jsx)(N,{trackName:a.track_name,trackId:t,takes:a.takes,masterPlay:e.state.masterPlay,masterStop:e.state.masterStop,masterRecord:e.state.masterRecord,selectedTrackId:e.state.selectedTrackId,setSelectedTrack:e.setSelectedTrack,deleteTake:e.deleteTake,soloTracks:e.state.soloTracks,updateSoloTracks:e.updateSoloTracks,updateMutedTracks:e.updateMutedTracks,claimedTracks:e.state.claimedTracks,masterVolume:e.state.masterVolume,renameTrack:e.renameTrack,deleteTrack:e.deleteTrack,handleFileUpload:e.handleFileUpload})}),0===Object.keys(e.props.trackMetadata[t].takes).length&&Object(r.jsx)("div",{style:{marginTop:"-20px"},children:Object(r.jsx)("input",{style:{marginLeft:"20px",marginTop:"25px",marginBottom:"20px"},type:"file",onChange:function(a){return e.handleFileUpload(a.target.files,t)}})})]},"track_".concat(t))})):Object(r.jsx)("div",{style:{marginTop:"10px"}})}),Object(r.jsx)("button",{style:{marginTop:"10px",marginLeft:"5px",marginBottom:"28px"},className:"stitched",onClick:this.createTrack,children:"+ New Track"}),Object(r.jsxs)("div",{style:{display:"flex"},children:[Object(r.jsx)("p",{style:{marginBottom:"5px"},children:Object(r.jsx)("b",{children:"Master Controls"})}),t&&Object(r.jsx)("button",{style:{marginLeft:"10px"},onClick:this.requestGroupRecord,disabled:this.state.masterPlay||this.state.requestingGroupRecord||this.state.requestingGroupPlayback,children:this.state.requestingGroupRecord?"waiting...":"group record"}),t&&Object(r.jsx)("button",{onClick:this.requestGroupStop,disabled:!this.state.masterPlay,children:"group stop"}),t&&Object(r.jsx)("button",{onClick:this.requestGroupPlay,disabled:this.state.masterPlay||this.state.requestingGroupPlayback||this.state.requestingGroupRecord,children:this.state.requestingGroupPlayback?"waiting...":"group play"}),t&&Object(r.jsx)("button",{onClick:this.cancelRequest,disabled:!this.state.requestingGroupRecord&&!this.state.requestingGroupPlayback,children:"cancel request"}),null!==this.state.preparedGroupAction&&0!==this.state.numGroupMembersPrepared&&Object(r.jsxs)("div",{style:{marginLeft:"10px",marginTop:"10px"},children:[this.state.numGroupMembersPrepared,"/",this.state.numGroupMembersTotal," ready",this.state.preparedGroupAction&&" for ".concat(this.state.preparedGroupAction)]}),this.state.stopMicProcessing&&Object(r.jsx)(q,{text:"Saving Recording..."})]}),this.state.isBlocked&&Object(r.jsx)("p",{style:{marginBottom:"5px"},children:"Please allow access to your mic to record!"}),Object(r.jsx)(w.a,{title:"Record selected track",arrow:!0,children:Object(r.jsx)("span",{children:Object(r.jsx)(_.a,{disableRipple:!0,"aria-label":"Record",onClick:this.toggleMasterRecord,disabled:this.state.masterPlay||this.state.isBlocked,children:this.state.masterPlay||this.state.isBlocked?Object(r.jsx)(ne.a,{style:{fontSize:28}}):Object(r.jsx)(ne.a,{style:{fontSize:28},color:"secondary"})})})}),Object(r.jsx)(w.a,{title:this.state.masterPlay?"Stop all tracks":"",arrow:!0,children:Object(r.jsx)("span",{children:Object(r.jsx)(_.a,{disableRipple:!0,"aria-label":"Stop",onClick:this.toggleMasterStop,disabled:!this.state.masterPlay,children:Object(r.jsx)(ae.a,{style:{fontSize:35}})})})}),Object(r.jsx)(w.a,{title:"Play all tracks",arrow:!0,children:Object(r.jsx)("span",{children:Object(r.jsx)(_.a,{disableRipple:!0,"aria-label":"Play",onClick:this.toggleMasterPlay,disabled:this.state.masterPlay||0===Object.keys(this.props.trackMetadata).length,style:{marginLeft:"-5px"},children:Object(r.jsx)(ee.a,{style:{fontSize:35}})})})})," ",Object(r.jsxs)("div",{style:{display:"flex",marginTop:"-45px"},children:[Object(r.jsxs)("div",{style:{position:"relative",marginLeft:"175px",width:"100px"},children:["Volume",Object(r.jsx)(S.a,{min:0,max:100,defaultValue:100,onChange:this.changeVolume})]}),Object(r.jsx)("span",{style:{marginLeft:"30px",marginTop:"5px"},children:this.formattedTime(this.state.runningTime)}),Object(r.jsx)(w.a,{title:"Download full track with latest takes",arrow:!0,style:{position:"absolute",marginLeft:"380px",marginTop:"-10px"},children:Object(r.jsx)("span",{children:Object(r.jsx)(_.a,{disableRipple:!0,"aria-label":"Download full track with latest takes",onClick:this.downloadMixedTrack,style:{marginBottom:"-10px"},children:Object(r.jsx)(X.a,{style:{fontSize:30}})})})})]}),this.state.showCountdown&&Object(r.jsxs)("div",{className:"timer",style:{position:"absolute",marginLeft:"500px",marginTop:"-105px"},children:[Object(r.jsx)(B.CountdownCircleTimer,{isPlaying:!0,duration:3,colors:[["#0f52bd",1]],size:90,onComplete:function(){var t=Date.now()-e.state.runningTime;e.timer=setInterval((function(){e.setState({runningTime:Date.now()-t})})),e.setState({showCountdown:!1,masterPlay:!0})},children:function(e){return e.remainingTime}}),Object(r.jsx)("button",{onClick:function(){e.setState({showCountdown:!1}),e.toggleMasterStop()},style:{marginTop:"10px",marginBottom:"10px"},children:"Ahh I'm not ready!"})]})]})}}]),a}(n.Component),le=a(57),ue=a.n(le),pe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var r;Object(c.a)(this,a),(r=t.call(this,e)).updateOnlineUsersListener=function(e){console.log("[SOCKET.IO] receiving updateOnlineUsers:",e.user_list),r.setState({onlineUsers:e.user_list})},r.updateProjectListener=function(){console.log("[SOCKET.IO] receiving updateProject"),r.refresh()},r.retrieveProject=function(e){console.log("retrieving project: "+e),null!==e&&""!==e&&fetch("/api/project?"+new URLSearchParams({project_hash:e})).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){var a=t.body.tracks?t.body.tracks.reduce((function(e,t){var a=t.takes.reduce((function(e,t){return e[t.take]={date_uploaded:t.date_uploaded,id:t.id,s3_info:t.s3_info,track_id:t.track_id},e}),{});return e[t.id]={takes:a,track_name:t.track_name},e}),{}):{};200===t.status&&r.setState({project_hash:e,project_name:t.body.project_name,group_name:t.body.group.group_name,project_id:t.body.id,track_metadata:a})}))},r.refresh=function(){r.retrieveProject(r.state.project_hash)},r.state={project_name:null,group_name:null,project_id:null,track_metadata:null,project_hash:e.location.pathname.split("/").pop(),isCreatingTake:!1,isDeletingTakeOrTrack:!1,onlineUsers:[]},"project"===r.state.project_hash&&(r.state.project_hash=null),r.createTrack=r.createTrack.bind(Object(k.a)(r)),r.deleteTrack=r.deleteTrack.bind(Object(k.a)(r)),r.renameTrack=r.renameTrack.bind(Object(k.a)(r)),r.createTake=r.createTake.bind(Object(k.a)(r)),r.deleteTake=r.deleteTake.bind(Object(k.a)(r));var n=JSON.parse(localStorage.getItem("userDetails")).name;return r.state.onlineUsers=[n],console.log("[SOCKET.IO] sending request to JOIN project"),Re.emit("join project",{channel:r.state.project_hash,user:n}),r}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.retrieveProject(this.state.project_hash),console.log("[SOCKET.IO] creating project listeners"),Re.on("updateOnlineUsers",this.updateOnlineUsersListener),Re.on("updateProject",this.updateProjectListener)}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] removing project (".concat(this.state.project_name,") listeners")),Re.off("updateOnlineUsers",this.updateOnlineUsersListener),Re.off("updateProject",this.updateProjectListener);var e=localStorage.getItem("userDetails");if(e){console.log("[SOCKET.IO] sending request to LEAVE project");var t=JSON.parse(e).name;Re.emit("leave project",{channel:this.state.project_hash,user:t})}}},{key:"componentDidUpdate",value:function(e){var t=this.props.location.pathname.split("/").pop();"project"!==t&&null!==t&&this.props.location.pathname!==e.location.pathname?this.retrieveProject(t):"project"===t&&null!==this.state.project_hash&&this.setState({project_hash:null,project_name:null,group_name:null,project_id:null,track_metadata:null})}},{key:"createTrack",value:function(){var e=Object(b.a)(g.a.mark((function e(){var t,a,r=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new track"),e.next=3,Object(T.f)("Name Your Track");case 3:(t=e.sent)&&((a=new FormData).append("track_name",t),a.append("project_id",this.state.project_id),fetch("/api/track",{method:"POST",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(400!==e.status){console.log("added new track");var a=Object.assign({},r.state.track_metadata);a[e.body.track_id]={id:parseInt(e.body.track_id),project_id:r.state.projectId,takes:{},track_name:t},r.setState({track_metadata:a}),Re.emit("broadcast update project",{channel:r.state.project_hash})}})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renameTrack",value:function(){var e=Object(b.a)(g.a.mark((function e(t,a){var r,n,s=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming track"),e.next=3,Object(T.f)("Rename Your Track",{defaultValue:a});case 3:(r=e.sent)&&((n=new FormData).append("track_id",t),n.append("new_name",r),fetch("/api/track",{method:"PUT",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object.assign({},s.state.track_metadata);a[t].track_name=r,s.setState({track_metadata:a}),Re.emit("broadcast update project",{channel:s.state.project_hash})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"deleteTrack",value:function(){var e=Object(b.a)(g.a.mark((function e(t,a){var r,n=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.a)('Are you sure you want to delete "'.concat(a,'"?'),"Delete Track");case 2:return e.sent&&(this.setState({isDeletingTakeOrTrack:!0}),(r=new FormData).append("track_id",t),fetch("/api/track",{method:"DELETE",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object.assign({},n.state.track_metadata);return delete a[t],n.setState({track_metadata:a,isDeletingTakeOrTrack:!1}),Re.emit("broadcast update project",{channel:n.state.project_hash}),!0}n.setState({isDeletingTakeOrTrack:!1})}))),e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"createTake",value:function(e,t,a,r){var n=this;console.log("creating new take for",e),this.setState({isCreatingTake:!0});var s=new FormData;s.append("track_id",e),s.append("file",t),s.append("latency",r),s.append("tz_offset",(new Date).getTimezoneOffset()/60),s.append("is_manual_upload",a),fetch("/api/take",{method:"POST",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){if(400!==t.status){console.log("CREATED TAKE:",t);var a=Object.assign({},n.state.track_metadata);a[parseInt(e)].takes[parseInt(t.body.take)]={id:parseInt(t.body.take_id),track_id:parseInt(e),s3_info:t.body.s3_info,date_uploaded:new Date(t.body.timestamp).toString()},n.setState({track_metadata:a,isCreatingTake:!1}),Re.emit("broadcast update project",{channel:n.state.project_hash})}else n.setState({isCreatingTake:!1})})).catch((function(e){alert("Could not upload take due to server error (see console)."),console.log(e),n.setState({isCreatingTake:!1})}))}},{key:"deleteTake",value:function(e,t,a){var r=this;this.setState({isDeletingTakeOrTrack:!0});var n=new FormData;n.append("take_id",a),fetch("/api/take",{method:"DELETE",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(a){if(200===a.status){var n=Object.assign({},r.state.track_metadata);delete n[e].takes[t],r.setState({track_metadata:n,isDeletingTakeOrTrack:!1}),Re.emit("broadcast update project",{channel:r.state.project_hash})}else r.setState({isDeletingTakeOrTrack:!1})})).catch((function(e){alert("Could not delete take due to server error (see console)."),r.setState({isDeletingTakeOrTrack:!1})}))}},{key:"render",value:function(){var e=this.props.location.pathname.split("/").pop();return null===this.state.project_name&&"project"!==e?Object(r.jsx)("div",{children:"Loading..."}):this.state.project_hash&&"project"!==e&&""!==e&&Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{style:{display:"flex",marginBottom:"-17px",marginTop:"-5px"},children:[Object(r.jsxs)("h2",{children:[this.state.project_name,Object(r.jsx)(w.a,{title:"Refresh latest project info",arrow:!0,placement:"right",children:Object(r.jsx)(_.a,{disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,style:{marginTop:"0px"},children:Object(r.jsx)(ue.a,{style:{fontSize:20}})})})]}),this.state.isCreatingTake&&Object(r.jsx)("div",{style:{marginTop:"-5px"},children:Object(r.jsx)(q,{text:"Uploading take..."})}),this.state.isDeletingTakeOrTrack&&Object(r.jsx)("div",{style:{marginTop:"-5px"},children:Object(r.jsx)(q,{text:"Deleting..."})})]}),Object(r.jsx)("div",{style:{marginLeft:"-5px",marginTop:"10px",marginBottom:"-10px",fontSize:"12px"},children:this.state.onlineUsers.map((function(e,t){return Object(r.jsxs)("div",{style:{display:"inline-block",marginRight:"5px"},children:[Object(r.jsx)("img",{src:"images/daw/online.png",alt:"online",width:"8",height:"8",style:{marginLeft:"5px"}})," ",e," "]},"user_".concat(t))}))}),Object(r.jsx)("div",{style:{marginTop:"20px"},children:Object(r.jsx)(ie,{projectName:this.state.project_name,projectHash:this.state.project_hash,trackMetadata:this.state.track_metadata,numOnlineUsers:this.state.onlineUsers.length,retrieveProject:this.retrieveProject,createTrack:this.createTrack,deleteTrack:this.deleteTrack,renameTrack:this.renameTrack,createTake:this.createTake,deleteTake:this.deleteTake})})]})}}]),a}(n.Component),de=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"HOMEPAGE"}),this.props.authed?Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:" To get started on a project: "}),Object(r.jsxs)("ol",{children:[Object(r.jsx)("li",{children:'Click "Groups" to create a new rehearsal group and add group members.'}),Object(r.jsxs)("li",{children:['Click "Projects" to create a project and begin rehearsing!'," "]})]})]}):Object(r.jsx)("p",{children:"Login to get started! \ud83c\udfb6"})]})}}]),a}(n.Component),he=a(43),je="Rename Project",me="Delete Project",ge=[je,me];var be=function(e){var t=Object(d.f)(),a=Object(n.useState)(null),s=Object(K.a)(a,2),o=s[0],c=s[1],i=function(t){var a=t.target.innerText;a===je?e.renameProject(e.project.id,e.project.project_name):a===me&&e.deleteProject(e.project.id,e.project.project_name),c(null)};return Object(r.jsxs)("li",{children:["Project: ",e.project.project_name," ",Object(r.jsx)("button",{onClick:function(){t.push({pathname:"/project/".concat(e.project.project_hash),state:{project:e.project,group_name:e.group_name,group_id:e.group_id}})},children:"Rehearse!"}),Object(r.jsx)(_.a,{"aria-label":"more","aria-controls":"project-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},style:{marginLeft:"5px"},children:Object(r.jsx)(L.a,{})}),Object(r.jsx)(C.a,{id:"project-menu",anchorEl:o,keepMounted:!0,open:null!==o,onClose:i,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:ge.map((function(e){return Object(r.jsx)(P.a,{onClick:i,children:e},e)}))})]})},fe=(a(149),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).clickThreeDotsMenu=function(e){r.setState({threeDotsAnchorElement:e.currentTarget})},r.closeThreeDotsMenu=function(e){var t=e.target.innerText;"Rename Group"===t?r.props.renameGroup(r.props.id,r.props.name):"Delete Group"===t&&r.props.deleteGroup(r.props.id,r.props.name),r.setState({threeDotsAnchorElement:null})},r.state={projects:e.projects,threeDotsAnchorElement:null},r.createNewProject=r.createNewProject.bind(Object(k.a)(r)),r.deleteProject=r.deleteProject.bind(Object(k.a)(r)),r.renameProject=r.renameProject.bind(Object(k.a)(r)),r}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(e){this.props.projects!==e.projects&&this.setState({projects:this.props.projects})}},{key:"createNewProject",value:function(){var e=Object(b.a)(g.a.mark((function e(){var t,a,r=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.f)("Name Your Project");case 2:(t=e.sent)&&((a=new FormData).append("project_name",t),a.append("group_id",this.props.id),fetch("/api/project",{method:"POST",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&(r.setState({projects:r.state.projects.concat([{project_name:t,id:e.body.project_id,project_hash:e.body.project_hash}])}),Re.emit("broadcast update projects"))})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteProject",value:function(){var e=Object(b.a)(g.a.mark((function e(t,a){var r,n=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.a)('Are you sure you want to delete "'.concat(a,'"?'),"Delete Project");case 2:e.sent&&((r=new FormData).append("project_id",t),fetch("/api/project",{method:"DELETE",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(x.a)(n.state.projects).filter((function(e){return e.id!==t}));n.setState({projects:a}),Re.emit("broadcast update projects")}})));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"renameProject",value:function(){var e=Object(b.a)(g.a.mark((function e(t,a){var r,n,s=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.f)("Rename Your Project",{defaultValue:a});case 2:(r=e.sent)&&((n=new FormData).append("project_id",t),n.append("new_name",r),fetch("/api/project",{method:"PUT",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(x.a)(s.state.projects).map((function(e){return e.id===t?Object(he.a)(Object(he.a)({},e),{},{project_name:r}):e}));s.setState({projects:a}),Re.emit("broadcast update projects")}})));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.projects.sort((function(e,t){return e.id>t.id?1:-1}));return Object(r.jsxs)("div",{style:{marginTop:"25px",marginBottom:"-10px"},children:[Object(r.jsxs)("p",{children:["Group: ",this.props.name,"  ",Object(r.jsx)("button",{onClick:this.createNewProject,children:"+ Project"})]}),Object(r.jsx)("div",{style:{marginTop:"20px"},children:Object(r.jsxs)("ul",{children:[this.state.projects&&0===this.state.projects.length&&Object(r.jsx)("p",{className:"text-muted",style:{marginTop:"-10px",marginBottom:"20px"},children:"No projects created yet!"}),t.map((function(t,a){return Object(r.jsx)("div",{children:Object(r.jsx)("div",{style:{marginTop:"-20px",marginBottom:"-10px"},children:Object(r.jsx)(be,{project:t,group_name:e.props.name,group_id:e.props.id,renameProject:e.renameProject,deleteProject:e.deleteProject})})},"project_".concat(a))}))]})})]})}}]),a}(n.Component)),Oe=(a(150),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).updateProjectsListener=function(){console.log("[SOCKET.IO] receiving updateProjects"),e.refresh()},e.fetchGroups=function(){fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status&&e.setState({groups:t.body,isLoaded:!0})}))},e.refresh=function(){e.fetchGroups()},e.state={groups:[],isLoaded:!1},e.fetchGroups(),e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){console.log("[SOCKET.IO] creating Projects page listener"),Re.on("updateProjects",this.updateProjectsListener)}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] removing Projects page listener"),Re.off("updateProjects",this.updateProjectsListener)}},{key:"render",value:function(){var e=this;return this.state.isLoaded?Object(r.jsxs)("div",{style:{marginBottom:"10px"},children:[Object(r.jsxs)("h2",{style:{marginBottom:"-25px"},children:["PROJECTS",Object(r.jsx)(w.a,{title:"Refresh latest projects",arrow:!0,placement:"right",children:Object(r.jsx)(_.a,{style:{marginTop:"-3px"},disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,children:Object(r.jsx)(ue.a,{style:{fontSize:25}})})})]}),this.state.groups&&0===this.state.groups.length&&Object(r.jsx)("p",{style:{marginTop:"20px"},class:"text-muted",children:"Create a group first!"}),this.state.groups&&this.state.groups.map((function(t,a){return Object(r.jsx)("div",{children:Object(r.jsx)(fe,{id:t.id,name:t.group_name,projects:t.projects,renameGroup:e.renameGroup,deleteGroup:e.deleteGroup})},"group_".concat(a))}))]}):Object(r.jsx)("div",{children:"Loading..."})}}]),a}(n.Component)),ke=(a(151),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).removeMember=function(){e.props.removeMember(e.props.id)},e}return Object(i.a)(a,[{key:"render",value:function(){var e=!this.props.onlyMemberInGroup;return Object(r.jsx)("div",{children:Object(r.jsxs)("li",{children:["Member: ",this.props.name," ",e&&Object(r.jsx)("button",{onClick:this.removeMember,children:"Remove"})]})})}}]),a}(n.Component));a(152);function xe(e){var t=Object(T.g)(),a=Object(n.useState)(null),s=Object(K.a)(a,2),o=s[0],c=s[1],i=Object(n.useState)(null),l=Object(K.a)(i,2),u=l[0],p=l[1],d=Object.keys(e.users).reduce((function(t,a){return t.push({value:a,label:e.users[a]}),t}),[]);return Object(r.jsxs)("div",{children:[Object(r.jsxs)(T.d,{children:[Object(r.jsx)("p",{children:"The dropdown lists all members on JamNSync:"}),Object(r.jsx)("div",{style:{height:250,width:300},children:Object(r.jsx)(v.a,{options:d,onChange:function(e){console.log("Selected "+e.label),c(e.value),p(e.label)},placeholder:"Select a name"})})]}),Object(r.jsxs)(T.e,{children:[Object(r.jsx)(T.c,{onClick:function(){t.close([o,u])},children:"OK"}),Object(r.jsx)(T.c,{onClick:function(){t.close([o,u])},type:"light",children:"Cancel"})]})]})}var ye="Rename Group",ve="Delete Group",Te=[ye,ve],Se=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).clickThreeDotsMenu=function(e){r.setState({threeDotsAnchorElement:e.currentTarget})},r.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===ye?r.props.renameGroup(r.props.id,r.props.name):t===ve&&r.props.deleteGroup(r.props.id,r.props.name),r.setState({threeDotsAnchorElement:null})},r.state={group_membership:{},threeDotsAnchorElement:null},fetch("/api/group/members?group_id="+r.props.id,{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&r.setState({group_membership:e.body})})),r.addMember=r.addMember.bind(Object(k.a)(r)),r.removeMember=r.removeMember.bind(Object(k.a)(r)),r}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.refresh!==e.refresh&&fetch("/api/group/members?group_id="+this.props.id,{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&t.setState({group_membership:e.body})}))}},{key:"addMember",value:function(){var e=Object(b.a)(g.a.mark((function e(){var t,a,n,s,o,c,i=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("adding member"),e.next=3,fetch("/api/users",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){return e.body}));case 3:return t=e.sent,e.next=6,Object(T.b)(Object(r.jsx)(xe,{users:t}),{title:"Add Member to "+this.props.name,showCloseIcon:!0});case 6:if(void 0!==(a=e.sent)&&null!==a){e.next=9;break}return e.abrupt("return");case 9:n=Object(K.a)(a,2),s=n[0],o=n[1],s&&Object.keys(this.state.group_membership).includes(s)?alert("".concat(o,' is already a member in group "').concat(this.props.name,'"')):s&&o&&((c=new FormData).append("group_id",this.props.id),c.append("user_id",s),fetch("/api/group/members",{method:"POST",body:c}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var t=Object.assign({},i.state.group_membership);t[s]=o,i.setState({group_membership:t}),Re.emit("broadcast update groups")}})));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(b.a)(g.a.mark((function e(t){var a,r,n=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("removing member id:",t),a=this.state.group_membership[t],e.next=4,Object(T.a)('Are you sure you want to remove "'.concat(a,'" from "').concat(this.props.name,'"?'),"Remove Member");case 4:e.sent&&((r=new FormData).append("group_id",this.props.id),r.append("user_id",t),fetch("/api/group/members",{method:"DELETE",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object.assign({},n.state.group_membership);delete a[t],n.setState({group_membership:a}),Re.emit("broadcast update groups")}})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{style:{marginBottom:"-10px"},children:[Object(r.jsxs)("p",{style:{marginTop:"20px",marginBottom:"-20px"},children:["Group: ",this.props.name,"  ",Object(r.jsx)("button",{onClick:this.addMember,children:"+ Member"}),Object(r.jsx)(_.a,{"aria-label":"more","aria-controls":"group-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"5px"},children:Object(r.jsx)(L.a,{})}),Object(r.jsx)(C.a,{id:"group-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:Te.map((function(t){return Object(r.jsx)(P.a,{onClick:e.closeThreeDotsMenu,children:t},t)}))})]}),Object(r.jsx)("ul",{children:Object.keys(this.state.group_membership).map((function(t){var a=e.state.group_membership[t];return Object(r.jsx)("div",{children:Object(r.jsx)("div",{children:Object(r.jsx)(ke,{id:t,name:a,removeMember:e.removeMember,onlyMemberInGroup:1===Object.keys(e.state.group_membership).length})})},"member_".concat(t))}))})]})}}]),a}(n.Component),_e=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).updateGroupsListener=function(){console.log("[SOCKET.IO] receiving updateGroups"),e.refresh()},e.fetchGroups=function(){fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status&&e.setState({groups:t.body,isLoaded:!0})}))},e.refresh=function(){console.log("refreshing groups"),fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status?e.setState({groups:t.body,isLoaded:!0,refresh:e.state.refresh+1}):e.setState({refresh:e.state.refresh+1})}))},e.state={groups:[],isLoaded:!1,refresh:0},e.fetchGroups(),e.createNewGroup=e.createNewGroup.bind(Object(k.a)(e)),e.deleteGroup=e.deleteGroup.bind(Object(k.a)(e)),e.renameGroup=e.renameGroup.bind(Object(k.a)(e)),e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){console.log("[SOCKET.IO] creating Groups page listener"),Re.on("updateGroups",this.updateGroupsListener)}},{key:"componentWillUnmount",value:function(){console.log("[SOCKET.IO] removing Groups page listener"),Re.off("updateGroups",this.updateGroupsListener)}},{key:"createNewGroup",value:function(){var e=Object(b.a)(g.a.mark((function e(){var t,a,r=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new group!"),e.next=3,Object(T.f)("Name Your Group");case 3:(t=e.sent)&&((a=new FormData).append("group_name",t),fetch("/api/group",{method:"POST",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&r.setState({groups:r.state.groups.concat([{group_name:t,id:e.body.group_id,projects:[]}])})})).catch((function(e){alert('Server Error: Group name taken, use a different name instead of "'+t+'"!')})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteGroup",value:function(){var e=Object(b.a)(g.a.mark((function e(t,a){var r,n=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting group"),e.next=3,Object(T.a)('Are you sure you want to delete "'.concat(a,'"?'),"Delete Group");case 3:e.sent&&((r=new FormData).append("group_id",t),fetch("/api/group",{method:"DELETE",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(x.a)(n.state.groups).filter((function(e){return e.id!==t}));n.setState({groups:a}),Re.emit("broadcast update groups")}})));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"renameGroup",value:function(){var e=Object(b.a)(g.a.mark((function e(t,a){var r,n,s=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming group"),e.next=3,Object(T.f)("Rename Your Group",{defaultValue:a});case 3:(r=e.sent)&&((n=new FormData).append("new_name",r),n.append("group_id",t),fetch("/api/group",{method:"PUT",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(x.a)(s.state.groups).map((function(e){return e.id===t?Object(he.a)(Object(he.a)({},e),{},{group_name:r}):e}));s.setState({groups:a}),Re.emit("broadcast update groups")}})));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.isLoaded?Object(r.jsxs)("div",{children:[Object(r.jsxs)("h2",{style:{marginBottom:"-30px"},children:["REHEARSAL GROUPS",Object(r.jsx)(w.a,{title:"Refresh latest groups",arrow:!0,placement:"right",children:Object(r.jsx)(_.a,{style:{marginTop:"-3px"},disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,children:Object(r.jsx)(ue.a,{style:{fontSize:25}})})})]}),this.state.groups&&this.state.groups.map((function(t,a){return Object(r.jsx)("div",{children:Object(r.jsx)(Se,{id:t.id,name:t.group_name,projects:t.projects,renameGroup:e.renameGroup,deleteGroup:e.deleteGroup,refresh:e.state.refresh})},"group_".concat(a))})),Object(r.jsx)("button",{style:{marginTop:"30px"},className:"stitched",onClick:this.createNewGroup,children:"+ New Rehearsal Group"})]}):Object(r.jsx)("div",{children:"Loading..."})}}]),a}(n.Component),we=a(125);var Ce=function(e){var t=e.component,a=e.authed,n=Object(we.a)(e,["component","authed"]);return Object(r.jsx)(d.b,Object(he.a)(Object(he.a)({},n),{},{render:function(e){return!0===a?Object(r.jsx)(t,Object(he.a)({},e)):Object(r.jsx)(d.a,{to:{pathname:"/",state:{from:e.location}}})}}))},Pe=a(124),Re=a.n(Pe)()(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_CLIENT_ID:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com"}).ROOT_URL),Le=Object(h.b)(),Ie=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).handleSuccessfulLogin=function(t){var a=t.profileObj,r=new FormData;r.append("google_auth_id",a.googleId),r.append("google_email",a.email),r.append("user_name",a.name),fetch("/auth/login",{method:"POST",body:r}).then((function(e){return e.json()})).then((function(t){console.log(t.message),localStorage.setItem("userDetails",JSON.stringify(a)),localStorage.setItem("isUserLoggedIn",!0),e.setState({userDetails:a,isUserLoggedIn:!0})}))},e.handleSuccessfulLogout=function(){fetch("/auth/logout",{method:"POST"}).then((function(e){return e.json()})).then((function(t){console.log(t.message),localStorage.clear(),e.setState({userDetails:{},isUserLoggedIn:!1})}))},e.state={userDetails:{},isUserLoggedIn:!1},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){"/"===Le.location.pathname&&Le.replace("/home");var e=JSON.parse(localStorage.getItem("userDetails")),t="true"===localStorage.getItem("isUserLoggedIn");t&&!this.state.isUserLoggedIn&&this.setState({userDetails:e,isUserLoggedIn:t})}},{key:"componentDidUpdate",value:function(e){!this.state.isUserLoggedIn&&e.isUserLoggedIn&&"/"===Le.location.pathname&&Le.replace("/home")}},{key:"render",value:function(){var e=Le.location.pathname;return Object(r.jsx)(p.a,{history:Le,children:Object(r.jsxs)("div",{children:[Object(r.jsx)("h1",{children:"JamNSync"}),Object(r.jsxs)("div",{style:{position:"absolute",right:20,top:35},children:[!this.state.isUserLoggedIn&&Object(r.jsx)(f,{onSuccessfulLogin:this.handleSuccessfulLogin}),this.state.isUserLoggedIn&&Object(r.jsxs)("div",{style:{display:"flex"},children:[Object(r.jsx)("div",{children:Object(r.jsxs)("p",{children:["Welcome, ",this.state.userDetails.givenName,"!"]})}),Object(r.jsx)("div",{style:{marginLeft:"5px"},children:Object(r.jsx)(O,{onSuccessfulLogout:this.handleSuccessfulLogout})})]})]}),Object(r.jsxs)("ul",{className:"header",children:[Object(r.jsx)("li",{children:Object(r.jsx)(p.b,{to:"/home",children:"Home"})}),this.state.isUserLoggedIn&&Object(r.jsx)("li",{children:Object(r.jsx)(p.b,{to:"/groups",children:"Groups"})}),this.state.isUserLoggedIn&&Object(r.jsx)("li",{children:Object(r.jsx)(p.b,{to:"/projects",children:"Projects"})})]}),Object(r.jsxs)("div",{className:"content",children:[Object(r.jsx)(d.b,{exact:!0,path:"/",children:this.state.isUserLoggedIn&&"/"!==e?Object(r.jsx)(d.a,{to:e}):Object(r.jsx)(de,{authed:this.state.isUserLoggedIn})}),Object(r.jsx)(d.b,{path:"/home",children:Object(r.jsx)(de,{authed:this.state.isUserLoggedIn})}),Object(r.jsx)(Ce,{path:"/projects",component:Oe,authed:this.state.isUserLoggedIn}),Object(r.jsx)(Ce,{path:"/groups",component:_e,authed:this.state.isUserLoggedIn}),Object(r.jsx)(Ce,{path:"/project/",component:pe,authed:this.state.isUserLoggedIn})]})]})})}}]),a}(n.Component);a(183);o.a.render(Object(r.jsx)(Ie,{}),document.getElementById("root"))}},[[184,1,2]]]);
//# sourceMappingURL=main.884ee7ce.chunk.js.map