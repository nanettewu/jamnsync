(this.webpackJsonpjamnsync=this.webpackJsonpjamnsync||[]).push([[0],{115:function(e,t,a){},117:function(e,t,a){},123:function(e,t,a){},124:function(e,t,a){},145:function(e,t,a){},146:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a(0),r=a(6),o=a.n(r),c=a(13),i=a(14),l=a(29),u=a(28),d=a(43),p=a(11),h=a(33),j=a(64),m=a(7),f=a.n(m),b=a(24);var g=function(e){return Object(n.jsx)("div",{children:Object(n.jsx)(j.GoogleLogin,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Login",onSuccess:function(t){!function(e){var t=1e3*(e.tokenObj.expires_in||3300),a=function(){var n=Object(b.a)(f.a.mark((function n(){var s;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.reloadAuthResponse();case 2:s=n.sent,t=1e3*(s.expires_in||3300),console.log("newAuthRes:",s),localStorage.setItem("authToken",s.id_token),setTimeout(a,t);case 7:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();setTimeout(a,t)}(t),e.onSuccessfulLogin(t)},onFailure:function(e){console.log("Attempt to login failed: res:",e)},cookiePolicy:"single_host_origin",style:{marginTop:"100px"},isSignedIn:!0})})};var k=function(e){return Object(n.jsx)("div",{children:Object(n.jsx)(j.GoogleLogout,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:function(){e.onSuccessfulLogout()}})})},O=a(19),v=a(42),x=(a(115),a(54)),y=a(69),T=(a(85),a(117),a(95)),S=a.n(T),w=(a(118),a(32)),_=a(170),R=a(177),P=a(174),D=a(176),L=a(50),I=a.n(L),F=a(77),M=a.n(F),C=a(76),U=a.n(C),E="+ Upload File",N="Rename Track",G="Delete Track",A=[E,N,G],B=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;if(Object(c.a)(this,a),(n=t.call(this,e)).playPauseAudio=function(){n.state.playing?(n.state.audioFile.pause(),n.setState({playing:!1})):(n.state.audioFile.play(),n.setState({playing:!0}))},n.stop=function(){n.state.audioFile.stop(),n.setState({playing:!1})},n.changeVolume=function(e){var t=e;n.state.audioFile.volume(n.props.masterVolume*t/100),n.setState({volume:t})},n.seek=function(e){n.state.audioFile.pause(),n.state.audioFile.seek(e),n.state.playing&&n.state.audioFile.play()},n.fastForward=function(){n.state.audioFile.pause();var e=n.state.audioFile.duration(),t=n.state.audioFile.seek(),a=t+5;a>=e?n.state.audioFile.stop():(console.log("ff: "+t+" -> "+a),n.state.audioFile.seek(a),n.state.playing&&n.state.audioFile.play())},n.rewind=function(){n.state.audioFile.pause();var e=n.state.audioFile.seek(),t=e-5;t<=0&&(t=0),console.log("rewind: "+e+" -> "+t),n.state.audioFile.seek(t),n.state.playing&&n.state.audioFile.play()},n.mute=function(){n.state.audioFile.mute(!n.state.muted),n.setState({muted:!n.state.muted})},n.solo=function(){n.props.updateSoloTracks(n.props.trackId),n.state.soloing?n.setState({soloing:!1}):(n.state.audioFile.mute(!1),n.setState({soloing:!0,muted:!1}))},n.selectToRecord=function(){var e=n.state.selected?null:n.props.trackId;n.props.setSelectedTrack(e),n.setState({selected:!n.state.selected})},n._onSelect=function(e){console.log("Selected "+e.label),n.state.audioFile.stop();var t=n.props.takes[e.value].s3_info;n.setState({playing:!1,selectedTake:e.value,audioFile:new x.Howl({src:[t],volume:.5,format:["mp3","wav"],preload:!0}),s3URL:t})},n.clickThreeDotsMenu=function(e){n.setState({threeDotsAnchorElement:e.currentTarget})},n.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===E?document.getElementById("file-upload").click():t===N?n.props.renameTrack(n.props.trackId,n.props.trackName):t===G&&n.props.deleteTrack(n.props.trackId,n.props.trackName),n.setState({threeDotsAnchorElement:null})},n.state={selected:!1,playing:!1,muted:!1,audioFile:null,s3URL:null,selectedTake:null,latestTake:0,soloing:!1,volume:84.95,threeDotsAnchorElement:null},0!==Object.keys(e.takes).length){var s=Object.keys(e.takes).pop(),r=e.takes[s].s3_info;r&&(n.state.audioFile=new x.Howl({src:[r],volume:.5,format:["mp3","wav"],preload:!0}),n.state.s3URL=r,n.state.selectedTake=s)}return n.deleteTake=n.deleteTake.bind(Object(O.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){if(0!==Object.keys(this.props.takes).length){var e=Object.keys(this.props.takes).pop(),t=this.props.takes[e].s3_info;t&&this.setState({audioFile:new x.Howl({src:[t],volume:.5,format:["mp3","wav"],preload:!0}),s3URL:t,selectedTake:e,latestTake:e})}else this.setState({selectedTake:null,audioFile:null,s3URL:null,latestTake:0})}},{key:"componentDidUpdate",value:function(e){if(this.state.selected&&this.props.selectedTrackId!==this.props.trackId&&this.setState({selected:!1}),null!==this.state.selectedTake&&this.state.latestTake===Object.keys(this.props.takes).pop()||0===Object.keys(this.props.takes).length)0===Object.keys(this.props.takes).length&&this.state.audioFile&&this.setState({selectedTake:null,audioFile:null,s3URL:null,latestTake:0});else{var t=Object.keys(this.props.takes).pop(),a=this.props.takes[t].s3_info;a&&(console.log("updated take to take "+t),this.setState({latestTake:t,selectedTake:t,audioFile:new x.Howl({src:[a],volume:.5,format:["mp3","wav"],preload:!0}),s3URL:a}))}this.props.masterPlay&&this.state.audioFile&&!this.state.playing&&(!this.state.selected||this.state.selected&&!this.props.masterRecord)?(console.log("[".concat(this.props.trackName,"] playing 1: ").concat(this.state.s3URL)),this.state.audioFile.seek(0),this.state.audioFile.play(),this.setState({playing:!0})):this.props.masterStop&&this.state.audioFile&&this.state.playing&&(this.state.audioFile.stop(),this.setState({playing:!1})),this.state.soloing||0===this.props.soloTracks.length||this.state.muted||!this.state.audioFile?0===this.props.soloTracks.length&&this.state.muted&&0!==e.soloTracks.length&&(this.state.audioFile.mute(!1),this.setState({muted:!1})):(this.state.audioFile.mute(!0),this.setState({muted:!0})),this.state.audioFile&&e.masterVolume!==this.props.masterVolume&&this.state.audioFile.volume(this.props.masterVolume*this.state.volume/100)}},{key:"componentWillUnmount",value:function(){this.state.audioFile&&this.state.audioFile.stop()}},{key:"deleteTake",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,a,n,s,r,o,c,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting take"),t=this.state.selectedTake,a=this.props.takes[t],n=new Date(a.date_uploaded.substr(0,a.date_uploaded.lastIndexOf(" ")+1)),s=n.toLocaleString("en-US"),r="Take ".concat(t," - ").concat(s),e.next=8,Object(w.a)('Are you sure you want to delete "'.concat(r,'"?'),"Delete Take");case 8:if(!e.sent){e.next=15;break}return this.state.audioFile.stop(),e.next=13,this.props.deleteTake(this.props.trackId,t,a.id);case 13:o=null,Object.keys(this.props.takes).length>1?(console.log("selecting existing take"),(c=Object.keys(this.props.takes)).splice(c.indexOf(t),1),o=Math.max.apply(Math,c),i=this.props.takes[o].s3_info,this.setState({playing:!1,selectedTake:o,audioFile:new x.Howl({src:[i],volume:.5*this.props.masterVolume,format:["mp3","wav"],preload:!0}),s3URL:i,latestTake:o})):(console.log("unsetting audio file"),this.setState({playing:!1,selectedTake:o,audioFile:null,s3URL:null,latestTake:0}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t={value:this.state.selectedTake},a=Object.keys(this.props.takes).reduce((function(a,n){if(parseInt(n)<=parseInt(e.state.latestTake)){var s=e.props.takes[n].date_uploaded,r=new Date(s.substr(0,s.lastIndexOf(" ")+1)).toLocaleString("en-US");n===e.state.selectedTake&&(t.label="Take ".concat(n," - ").concat(r)),a.push({value:n,label:"Take ".concat(n," - ").concat(r)})}return a}),[]).reverse();return Object(n.jsxs)("div",{style:{marginLeft:"5px"},children:[Object(n.jsx)("hr",{}),Object(n.jsxs)("div",{children:[this.state.selected?Object(n.jsxs)("div",{style:{display:"inline-block"},children:[Object(n.jsx)("img",{src:"images/daw/selected.png",alt:"selected",width:"10",height:"10"})," ",Object(n.jsxs)("b",{children:["Track: ",this.props.trackName]})," "]}):Object(n.jsxs)("div",{style:{display:"inline-block"},children:["Track: ",this.props.trackName," "]}),Object(n.jsx)("button",{title:"Select/unselect track for recording",onClick:this.selectToRecord,style:{marginLeft:"5px"},children:this.state.selected?"Unselect":"Select to Record"}),Object(n.jsx)(_.a,{"aria-label":"more","aria-controls":"track-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"5px"},children:Object(n.jsx)(I.a,{})}),Object(n.jsx)("input",{type:"file",id:"file-upload",hidden:!0,onChange:function(t){return e.props.handleFileUpload(t.target.files,e.props.trackId)}}),Object(n.jsx)(P.a,{id:"track-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:A.map((function(t){return Object(n.jsx)(D.a,{onClick:e.closeThreeDotsMenu,children:t},t)}))})]}),this.state.audioFile&&Object.keys(this.props.takes).length>0&&Object(n.jsxs)("div",{style:{marginBottom:"20px"},children:[Object(n.jsx)(R.a,{title:"Mute",arrow:!0,children:Object(n.jsx)(_.a,{disableRipple:!0,"aria-label":"Mute this track",onClick:this.mute,children:this.state.muted?Object(n.jsx)(U.a,{color:"secondary"}):Object(n.jsx)(U.a,{})})}),Object(n.jsx)(R.a,{title:"Solo",arrow:!0,children:Object(n.jsx)(_.a,{disableRipple:!0,"aria-label":"Solo this track",onClick:this.solo,children:this.state.soloing?Object(n.jsx)(M.a,{color:"secondary"}):Object(n.jsx)(M.a,{})})}),Object(n.jsxs)("div",{style:{display:"inline-block",marginLeft:"10px",marginRight:"10px",width:"100px"},children:["Volume",Object(n.jsx)(y.a,{min:0,max:100,defaultValue:50,onChange:this.changeVolume})]}),Object(n.jsx)("div",{style:{marginLeft:"10px",display:"inline-flex",width:310},children:Object(n.jsx)(S.a,{options:a,onChange:this._onSelect,value:t,placeholder:"Select an option"})}),Object(n.jsxs)("div",{style:{display:"inline-flex"},children:[Object(n.jsx)("form",{method:"get",action:this.state.s3URL,children:Object(n.jsx)("button",{type:"submit",children:"Download Take"})}),Object(n.jsx)("button",{onClick:this.deleteTake,children:"Delete Take"})]})]})]})}}]),a}(s.Component),V=a(97),H=a(98),q=a(100),J=a.n(q),Y=a(99),W=a.n(Y),z=a(78),$=a.n(z),K=new H.a.Recorder({wasmURL:"https://unpkg.com/vmsg@0.3.0/vmsg.wasm"}),Q=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).createTrack=function(){e.props.createTrack()},e.renameTrack=function(t,a){e.props.renameTrack(t,a)},e.deleteTrack=function(t,a){e.props.deleteTrack(t,a)&&e.setState({selectedTrackId:null})},e.createTake=function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.props.createTake(t,a,n)},e.deleteTake=function(t,a,n){e.props.deleteTake(t,a,n)},e.toggleMasterPlay=function(){console.log("master play"),e.setState((function(t){var a=Date.now()-e.state.runningTime;return e.timer=setInterval((function(){e.setState({runningTime:Date.now()-a})})),{masterPlay:!0}}))},e.handleFileUpload=function(t,a){console.log("handling file upload"),null!==t&&null!==t[0]&&"undefined"!==typeof t[0]&&(/\.(mp3|ogg|wav|flac|aac|aiff|m4a)$/i.test(t[0].name)?(console.log("> validated file: ",t[0].name),e.createTake(a,t[0])):alert("Please upload valid audio file type (mp3, ogg, wav, flac, aac, aiff, m4a)"))},e.setSelectedTrack=function(t){var a=null!==t?t:null;console.log("selecting track to record: "+a),e.setState({selectedTrackId:a})},e.formattedTime=function(e){var t=Math.floor(e/6e4),a=(e%6e4/1e3).toFixed(2);return t+":"+(a<10?"0":"")+a},e.updateSoloTracks=function(t){var a=Object(v.a)(e.state.soloTracks),n=a.indexOf(t);-1!==n?a.splice(n,1):a.push(t),console.log("new solo tracks:",a),e.setState({soloTracks:a})},e.changeVolume=function(t){e.setState({masterVolume:t/75})},e.state={masterPlay:!1,masterStop:!1,masterRecord:!1,isRecording:!1,selectedTrackId:null,isBlocked:!1,showCountdown:!1,runningTime:0,soloTracks:[],masterVolume:.5},e.toggleMasterRecord=e.toggleMasterRecord.bind(Object(O.a)(e)),e.toggleMasterStop=e.toggleMasterStop.bind(Object(O.a)(e)),e}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(){this.state.masterPlay&&this.state.masterStop&&this.setState({masterPlay:!1,masterStop:!1,runningTime:0})}},{key:"componentDidMount",value:function(){var e=this;console.log("reloading DAW"),navigator.mediaDevices.getUserMedia({audio:!0},(function(){console.log("Permission Granted"),e.setState({isBlocked:!1})}),(function(){console.log("Permission Denied"),e.setState({isBlocked:!0})})),this.setState({isRecording:!1,masterRecord:!1,selectedTrackId:null,soloTracks:[]})}},{key:"toggleMasterStop",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("master stop"),this.state.masterPlay){e.next=3;break}return e.abrupt("return");case 3:if(clearInterval(this.timer),this.setState({masterStop:!0,runningTime:0}),!this.state.isRecording){e.next=16;break}return e.next=8,K.stopRecording();case 8:t=e.sent,a=new File([t],"recording_track_".concat(this.state.selectedTrackId,".mp3")),n=URL.createObjectURL(a),console.log(n),-1,Object.keys(this.props.trackMetadata).length,this.createTake(this.state.selectedTrackId,a,-1),this.setState({isRecording:!1,masterRecord:!1});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleMasterRecord",value:function(){var e=Object(b.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("master record!"),!this.state.isBlocked){e.next=6;break}console.log("Permission Denied"),alert("Permission Denied!"),e.next=17;break;case 6:if(null!==this.state.selectedTrackId){e.next=10;break}alert("Select a track to record!"),e.next=17;break;case 10:return console.log("recording"+this.state.selectedTrackId),e.next=13,K.initAudio();case 13:return e.next=15,K.initWorker();case 15:K.startRecording(),this.setState((function(e){return{masterRecord:!0,showCountdown:!0,isRecording:!0}}));case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{children:this.props.trackMetadata&&Object.keys(this.props.trackMetadata).length>0?Object.keys(this.props.trackMetadata).map((function(t){var a=e.props.trackMetadata[t];return Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{children:Object(n.jsx)(B,{trackName:a.track_name,trackId:t,takes:a.takes,masterPlay:e.state.masterPlay,masterStop:e.state.masterStop,masterRecord:e.state.masterRecord,selectedTrackId:e.state.selectedTrackId,setSelectedTrack:e.setSelectedTrack,deleteTake:e.deleteTake,soloTracks:e.state.soloTracks,updateSoloTracks:e.updateSoloTracks,masterVolume:e.state.masterVolume,renameTrack:e.renameTrack,deleteTrack:e.deleteTrack,handleFileUpload:e.handleFileUpload})}),0===Object.keys(e.props.trackMetadata[t].takes).length&&Object(n.jsx)("div",{style:{marginTop:"-20px"},children:Object(n.jsx)("input",{style:{marginLeft:"20px",marginTop:"25px",marginBottom:"20px"},type:"file",onChange:function(a){return e.handleFileUpload(a.target.files,t)}})})]},"track_".concat(t))})):Object(n.jsx)("div",{style:{marginTop:"10px"}})}),Object(n.jsx)("button",{style:{marginTop:"10px",marginLeft:"5px"},className:"stitched",onClick:this.createTrack,children:"+ New Track"}),Object(n.jsx)("p",{children:Object(n.jsx)("b",{children:"Master Controls"})}),Object(n.jsx)(_.a,{disableRipple:!0,"aria-label":"Stop",onClick:this.toggleMasterRecord,disabled:this.state.masterPlay,children:this.state.masterPlay?Object(n.jsx)($.a,{style:{fontSize:28}}):Object(n.jsx)($.a,{style:{fontSize:28},color:"secondary"})}),Object(n.jsx)(_.a,{disableRipple:!0,"aria-label":"Stop",onClick:this.toggleMasterStop,disabled:!this.state.masterPlay,children:Object(n.jsx)(W.a,{style:{fontSize:35}})}),Object(n.jsx)(_.a,{disableRipple:!0,"aria-label":"Play",onClick:this.toggleMasterPlay,disabled:this.state.masterPlay,style:{marginLeft:"-5px"},children:Object(n.jsx)(J.a,{style:{fontSize:35}})})," ",this.formattedTime(this.state.runningTime),Object(n.jsxs)("div",{style:{position:"absolute",marginLeft:"245px",marginTop:"-45px",width:"100px"},children:["Volume",Object(n.jsx)(y.a,{min:0,max:100,defaultValue:50,onChange:this.changeVolume})]}),this.state.showCountdown&&Object(n.jsxs)("div",{className:"timer",style:{marginTop:"10px"},children:[Object(n.jsx)(V.CountdownCircleTimer,{isPlaying:!0,duration:3,colors:[["#0f52bd",1]],onComplete:function(){var t=Date.now()-e.state.runningTime;e.timer=setInterval((function(){e.setState({runningTime:Date.now()-t})})),e.setState({showCountdown:!1,masterPlay:!0})},children:function(e){return e.remainingTime}}),Object(n.jsx)("button",{onClick:function(){e.setState({showCountdown:!1}),e.toggleMasterStop()},style:{marginTop:"10px"},children:"Ahh I'm not ready!"})]})]})}}]),a}(s.Component),X=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).retrieveProject=function(){console.log("retrieving project: "+n.state.project_hash),null!==n.state.project_hash&&""!==n.state.project_hash&&fetch("/api/project?"+new URLSearchParams({project_hash:n.state.project_hash})).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){var t=e.body.tracks?e.body.tracks.reduce((function(e,t){var a=t.takes.reduce((function(e,t){return e[t.take]={date_uploaded:t.date_uploaded,id:t.id,s3_info:t.s3_info,track_id:t.track_id},e}),{});return e[t.id]={takes:a,track_name:t.track_name},e}),{}):{};200===e.status&&n.setState({project_name:e.body.project_name,group_name:e.body.group.group_name,project_id:e.body.id,track_metadata:t})}))},n.state={project_name:null,group_name:null,project_id:null,track_metadata:null,project_hash:e.location.pathname.split("/").pop()},"project"===n.state.project_hash&&(n.state.project_hash=null),n.createTrack=n.createTrack.bind(Object(O.a)(n)),n.deleteTrack=n.deleteTrack.bind(Object(O.a)(n)),n.renameTrack=n.renameTrack.bind(Object(O.a)(n)),n.createTake=n.createTake.bind(Object(O.a)(n)),n.deleteTake=n.deleteTake.bind(Object(O.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.retrieveProject()}},{key:"createTrack",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new track"),e.next=3,Object(w.b)("Name Your Track",{isRequired:!0});case 3:(t=e.sent)&&((a=new FormData).append("track_name",t),a.append("project_id",this.state.project_id),fetch("/api/track",{method:"POST",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(400!==e.status){console.log("added new track");var a=Object.assign({},n.state.track_metadata);a[e.body.track_id]={id:parseInt(e.body.track_id),project_id:n.state.projectId,takes:{},track_name:t},n.setState({track_metadata:a})}})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renameTrack",value:function(){var e=Object(b.a)(f.a.mark((function e(t,a){var n,s,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming track"),e.next=3,Object(w.b)("Rename Your Track",{isRequired:!0,defaultValue:a});case 3:(n=e.sent)&&((s=new FormData).append("track_id",t),s.append("new_name",n),fetch("/api/track",{method:"PUT",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object.assign({},r.state.track_metadata);a[t].track_name=n,r.setState({track_metadata:a})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"deleteTrack",value:function(){var e=Object(b.a)(f.a.mark((function e(t,a){var n,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)('Are you sure you want to delete "'.concat(a,'"?'),"Delete Track");case 2:return e.sent&&((n=new FormData).append("track_id",t),fetch("/api/track",{method:"DELETE",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object.assign({},s.state.track_metadata);return delete a[t],s.setState({track_metadata:a}),!0}}))),e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"createTake",value:function(e,t,a){var n=this;console.log("creating new take for",e);var s=new FormData;s.append("track_id",e),s.append("file",t),s.append("latency",a),fetch("/api/take",{method:"POST",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){if(400!==t.status){var a=Object.assign({},n.state.track_metadata);a[parseInt(e)].takes[parseInt(t.body.take)]={id:parseInt(t.body.take_id),track_id:parseInt(e),s3_info:t.body.s3_info,date_uploaded:new Date(t.body.timestamp).toString()},n.setState({track_metadata:a})}}))}},{key:"deleteTake",value:function(e,t,a){var n=this,s=new FormData;s.append("take_id",a),fetch("/api/take",{method:"DELETE",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(a){if(200===a.status){var s=Object.assign({},n.state.track_metadata);delete s[e].takes[t],n.setState({track_metadata:s})}}))}},{key:"render",value:function(){var e=this.props.location.pathname.split("/").pop();return this.state.project_hash&&"project"!==e&&""!==e&&Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:this.state.project_name}),Object(n.jsx)("div",{style:{marginTop:"20px"},children:Object(n.jsx)(Q,{trackMetadata:this.state.track_metadata,retrieveProject:this.retrieveProject,createTrack:this.createTrack,deleteTrack:this.deleteTrack,renameTrack:this.renameTrack,createTake:this.createTake,deleteTake:this.deleteTake})})]})}}]),a}(s.Component),Z=a(20);var ee=function(){var e=Object(s.useState)(""),t=Object(Z.a)(e,2),a=t[0],r=t[1],o=Object(s.useState)(!1),c=Object(Z.a)(o,2),i=c[0],l=c[1];return i?Object(n.jsx)(p.a,{to:"/project/".concat(a)}):Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:"Find a Project"}),Object(n.jsx)("br",{}),Object(n.jsxs)("form",{style:{marginLeft:10},children:[Object(n.jsx)("input",{style:{width:250},type:"text",value:a,onChange:function(e){e.target.value.startsWith("http")?r(e.target.value.split("/").pop()):r(e.target.value)},placeholder:"Enter Project ID or URL"}),Object(n.jsx)("input",{type:"submit",hidden:!0}),Object(n.jsx)("button",{onClick:function(){console.log("projectId",a),fetch("/api/project?"+new URLSearchParams({project_hash:a})).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){console.log(e),200===e.status&&l(!0)})).catch((function(e){alert("Cannot find project ID or URL: "+a,e)}))},children:"Go!"})]})]})},te=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:"HOMEPAGE"}),Object(n.jsx)("p",{children:"Let's jam in sync! \ud83c\udfb6"})]})}}]),a}(s.Component),ae=a(39),ne="Rename Project",se="Delete Project",re=[ne,se];var oe=function(e){var t=Object(p.f)(),a=Object(s.useState)(null),r=Object(Z.a)(a,2),o=r[0],c=r[1],i=function(t){var a=t.target.innerText;a===ne?e.renameProject(e.project.id,e.project.project_name):a===se&&e.deleteProject(e.project.id,e.project.project_name),c(null)};return Object(n.jsxs)("li",{children:["Project: ",e.project.project_name," ",Object(n.jsx)("button",{onClick:function(){t.push({pathname:"/project/".concat(e.project.project_hash),state:{project:e.project,group_name:e.group_name,group_id:e.group_id}})},children:"Rehearse!"}),Object(n.jsx)(_.a,{"aria-label":"more","aria-controls":"project-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},style:{marginLeft:"5px"},children:Object(n.jsx)(I.a,{})}),Object(n.jsx)(P.a,{id:"project-menu",anchorEl:o,keepMounted:!0,open:null!==o,onClose:i,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:re.map((function(e){return Object(n.jsx)(D.a,{onClick:i,children:e},e)}))})]})},ce=(a(123),"Rename Group"),ie="Delete Group",le=[ce,ie],ue=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).clickThreeDotsMenu=function(e){n.setState({threeDotsAnchorElement:e.currentTarget})},n.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===ce?n.props.renameGroup(n.props.id,n.props.name):t===ie&&n.props.deleteGroup(n.props.id,n.props.name),n.setState({threeDotsAnchorElement:null})},n.state={projects:e.projects,threeDotsAnchorElement:null},n.createNewProject=n.createNewProject.bind(Object(O.a)(n)),n.deleteProject=n.deleteProject.bind(Object(O.a)(n)),n.renameProject=n.renameProject.bind(Object(O.a)(n)),n}return Object(i.a)(a,[{key:"createNewProject",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.b)("Name Your Project",{isRequired:!0});case 2:(t=e.sent)&&((a=new FormData).append("project_name",t),a.append("group_id",this.props.id),fetch("/api/project",{method:"POST",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&n.setState({projects:n.state.projects.concat([{project_name:t,id:e.body.project_id,project_hash:e.body.project_hash}])})})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteProject",value:function(){var e=Object(b.a)(f.a.mark((function e(t,a){var n,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)('Are you sure you want to delete "'.concat(a,'"?'),"Delete Project");case 2:e.sent&&((n=new FormData).append("project_id",t),fetch("/api/project",{method:"DELETE",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(v.a)(s.state.projects).filter((function(e){return e.id!==t}));s.setState({projects:a})}})));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"renameProject",value:function(){var e=Object(b.a)(f.a.mark((function e(t,a){var n,s,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.b)("Rename Your Project",{isRequired:!0,defaultValue:a});case 2:(n=e.sent)&&((s=new FormData).append("project_id",t),s.append("new_name",n),fetch("/api/project",{method:"PUT",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(v.a)(r.state.projects).map((function(e){return e.id===t?Object(ae.a)(Object(ae.a)({},e),{},{project_name:n}):e}));r.setState({projects:a})}})));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsxs)("h3",{children:["Group Name: ",this.props.name," ",Object(n.jsx)("button",{onClick:this.createNewProject,children:"+ New Project"}),Object(n.jsx)(_.a,{"aria-label":"more","aria-controls":"group-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"5px"},children:Object(n.jsx)(I.a,{})}),Object(n.jsx)(P.a,{id:"group-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:le.map((function(t){return Object(n.jsx)(D.a,{onClick:e.closeThreeDotsMenu,children:t},t)}))})]}),Object(n.jsx)("div",{style:{marginTop:"-25px"},children:Object(n.jsxs)("ul",{children:[this.state.projects&&0===this.state.projects.length&&Object(n.jsx)("p",{className:"text-muted",style:{marginTop:"25px"},children:"No projects created yet!"}),this.state.projects.map((function(t,a){return Object(n.jsx)("div",{children:Object(n.jsx)("div",{style:{marginTop:"-20px",marginBottom:"-10px"},children:Object(n.jsx)(oe,{project:t,group_name:e.props.name,group_id:e.props.id,renameProject:e.renameProject,deleteProject:e.deleteProject})})},"project_".concat(a))}))]})})]})}}]),a}(s.Component),de=(a(124),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).state={groups:[]},fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status&&e.setState({groups:t.body})})),e.createNewGroup=e.createNewGroup.bind(Object(O.a)(e)),e.deleteGroup=e.deleteGroup.bind(Object(O.a)(e)),e.renameGroup=e.renameGroup.bind(Object(O.a)(e)),e}return Object(i.a)(a,[{key:"createNewGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new group!"),e.next=3,Object(w.b)("Name Your Group",{isRequired:!0});case 3:(t=e.sent)&&((a=new FormData).append("group_name",t),fetch("/api/group",{method:"POST",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&n.setState({groups:n.state.groups.concat([{group_name:t,id:e.body.group_id,projects:[]}])})})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(t,a){var n,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting group"),e.next=3,Object(w.a)('Are you sure you want to delete "'.concat(a,'"?'),"Delete Group");case 3:e.sent&&((n=new FormData).append("group_id",t),fetch("/api/group",{method:"DELETE",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(v.a)(s.state.groups).filter((function(e){return e.id!==t}));s.setState({groups:a})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"renameGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(t,a){var n,s,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming group"),e.next=3,Object(w.b)("Rename Your Group",{isRequired:!0,defaultValue:a});case 3:(n=e.sent)&&((s=new FormData).append("new_name",n),s.append("group_id",t),fetch("/api/group",{method:"PUT",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var a=Object(v.a)(r.state.groups).map((function(e){return e.id===t?Object(ae.a)(Object(ae.a)({},e),{},{group_name:n}):e}));r.setState({groups:a})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:"GROUPS"}),this.state.groups&&this.state.groups.map((function(t,a){return Object(n.jsx)("div",{children:Object(n.jsx)(ue,{id:t.id,name:t.group_name,projects:t.projects,renameGroup:e.renameGroup,deleteGroup:e.deleteGroup})},"group_".concat(a))})),Object(n.jsx)("button",{className:"stitched",onClick:this.createNewGroup,children:"+ New Group"})]})}}]),a}(s.Component)),pe=a(101),he=function(){var e=Object(s.useState)(""),t=Object(Z.a)(e,2),a=t[0],r=t[1],o=Object(s.useState)(""),c=Object(Z.a)(o,2),i=c[0],l=c[1],u=Object(s.useState)(""),d=Object(Z.a)(u,2),p=d[0],h=d[1],j=Object(s.useState)(!1),m=Object(Z.a)(j,2),f=m[0],b=m[1];return Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:"Jitsi"}),Object(n.jsx)("br",{}),f?Object(n.jsx)(pe.a,{containerStyles:{width:"800px",height:"400px"},roomName:i,displayName:a,password:p,onMeetingEnd:function(){return console.log("Meeting has ended")},loadingComponent:Object(n.jsx)("p",{children:"Loading ..."}),errorComponent:Object(n.jsx)("p",{children:"Oops, something went wrong"})}):Object(n.jsxs)("form",{children:[Object(n.jsx)("p",{children:"Create a Room"}),Object(n.jsx)("input",{id:"room",type:"text",placeholder:"Room Name",value:i,onChange:function(e){return l(e.target.value)}}),Object(n.jsx)("input",{id:"name",type:"text",placeholder:"Name",value:a,onChange:function(e){return r(e.target.value)}}),Object(n.jsx)("input",{id:"password",type:"text",placeholder:"Password (optional)",value:p,onChange:function(e){return h(e.target.value)}}),Object(n.jsx)("button",{onClick:function(e){e.preventDefault(),i&&a&&b(!0)},type:"submit",children:"Start / Join"})]})]})},je=a(102),me=function(){function e(t){Object(c.a)(this,e),this.config={sampleRate:44100,bitRate:128},Object.assign(this.config,t),this.mp3Encoder=new je.Mp3Encoder(1,this.config.sampleRate,this.config.bitRate),this.maxSamples=1152,this.samplesMono=null,this.clearBuffer()}return Object(i.a)(e,[{key:"clearBuffer",value:function(){this.dataBuffer=[]}},{key:"appendToBuffer",value:function(e){this.dataBuffer.push(new Int8Array(e))}},{key:"floatTo16BitPCM",value:function(e,t){for(var a=0;a<e.length;a++){var n=Math.max(-1,Math.min(1,e[a]));t[a]=n<0?32768*n:32767*n}}},{key:"convertBuffer",value:function(e){var t=new Float32Array(e),a=new Int16Array(e.length);return this.floatTo16BitPCM(t,a),a}},{key:"encode",value:function(e){this.samplesMono=this.convertBuffer(e);for(var t=this.samplesMono.length,a=0;t>=0;a+=this.maxSamples){var n=this.samplesMono.subarray(a,a+this.maxSamples),s=this.mp3Encoder.encodeBuffer(n);this.appendToBuffer(s),t-=this.maxSamples}}},{key:"finish",value:function(){return this.appendToBuffer(this.mp3Encoder.flush()),this.dataBuffer}}]),e}(),fe=new(function(){function e(t){Object(c.a)(this,e),this.getMediaStream=function(){},this.mediaRecorder=null,this.mediaChunks=[],this.mediaStream=null}return Object(i.a)(e,[{key:"componentDidMount",value:function(){}},{key:"addMicrophoneListener",value:function(e){var t=this;this.activeStream=e,this.microphone=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(0,1,1),this.processor.onaudioprocess=function(e){t.lameEncoder.encode(e.inputBuffer.getChannelData(0))},this.microphone.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"stop",value:function(){return this.processor&&this.microphone&&(this.microphone.disconnect(),this.processor.disconnect(),this.context&&"closed"!==this.context.state&&this.context.close(),this.processor.onaudioprocess=null,this.activeStream.getAudioTracks().forEach((function(e){return e.stop()}))),this}},{key:"start",value:function(){var e=this;this.context=new AudioContext,this.config.sampleRate=this.context.sampleRate,this.lameEncoder=new me(this.config);var t=!this.config.deviceId||{deviceId:{exact:this.config.deviceId}};navigator.mediaDevices.getUserMedia({audio:t}).then((function(t){e.addMicrophoneListener(t)}))}},{key:"getMp3",value:function(){var e=this,t=this.lameEncoder.finish();return new Promise((function(a,n){0===t.length?n(new Error("No buffer to send")):(a([t,new Blob(t,{type:"audio/mp3"})]),e.lameEncoder.clearBuffer())}))}}]),e}())({bitRate:128}),be=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).handleRecord=function(){console.log("recording now"),fe.start(),e.setState({recording:!0})},e.handleStopRecord=function(){console.log("stopped now"),fe.stop().getMp3().then((function(t){var a=Object(Z.a)(t,2),n=(a[0],a[1]),s=URL.createObjectURL(n);console.log(s);var r=e.state.recordings.concat([s]);e.setState({recording:!1,recordings:r})})).catch((function(e){return console.log(e)}))},e.convertBuffer=function(){},e.state={recording:!1,recordings:[]},e}return Object(i.a)(a,[{key:"saveAudio",value:function(){var e=new Blob(this.chunks,{type:"audio/mp3"});console.log(e);var t=URL.createObjectURL(e);console.log(t);var a=this.state.recordings.concat([t]);this.setState({recordings:a})}},{key:"deleteRecording",value:function(e){var t=this.state.recordings.filter((function(t){return t!==e}));this.setState({recordings:t})}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsxs)("div",{children:[Object(n.jsx)("p",{children:"test mic with web audio"}),Object(n.jsx)("button",{disabled:this.state.recording,onClick:this.handleRecord,children:"record"}),Object(n.jsx)("button",{disabled:!this.state.recording,onClick:this.handleStopRecord,children:"stop"})]}),Object(n.jsxs)("div",{children:[Object(n.jsx)("p",{children:"Recordings:"}),this.state.recordings.map((function(t,a){return Object(n.jsxs)("div",{children:[Object(n.jsx)("audio",{controls:!0,style:{width:300},src:t}),Object(n.jsx)("div",{children:Object(n.jsx)("button",{onClick:function(){return e.deleteRecording(t)},children:"Delete"})})]},"recording_".concat(a))}))]})]})}}]),a}(s.Component),ge=a(103);var ke=function(e){var t=e.component,a=e.authed,s=Object(ge.a)(e,["component","authed"]);return Object(n.jsx)(p.b,Object(ae.a)(Object(ae.a)({},s),{},{render:function(e){return!0===a?Object(n.jsx)(t,Object(ae.a)({},e)):Object(n.jsx)(p.a,{to:{pathname:"/",state:{from:e.location}}})}}))},Oe=Object(h.b)(),ve=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).handleSuccessfulLogin=function(t){var a=t.profileObj,n=new FormData;n.append("google_auth_id",a.googleId),n.append("google_email",a.email),n.append("user_name",a.name),fetch("/auth/login",{method:"POST",body:n}).then((function(e){return e.json()})).then((function(e){console.log(e)})),localStorage.setItem("userDetails",JSON.stringify(a)),localStorage.setItem("isUserLoggedIn",!0),e.setState({userDetails:a,isUserLoggedIn:!0})},e.handleSuccessfulLogout=function(){fetch("/auth/logout",{method:"POST"}).then((function(e){return e.json()})).then((function(e){console.log(e)})),localStorage.clear(),e.setState({userDetails:{},isUserLoggedIn:!1})},e.state={userDetails:{},isUserLoggedIn:!1},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=JSON.parse(localStorage.getItem("userDetails")),t="true"===localStorage.getItem("isUserLoggedIn");t&&!this.state.isUserLoggedIn&&this.setState({userDetails:e,isUserLoggedIn:t})}},{key:"render",value:function(){var e=Oe.location.pathname;return this.state.isUserLoggedIn&&"/"===Oe.location.pathname&&(e="/groups"),Object(n.jsx)(d.a,{history:Oe,children:Object(n.jsxs)("div",{children:[Object(n.jsx)("h1",{children:"JamNSync"}),Object(n.jsxs)("div",{style:{position:"absolute",right:20,top:35},children:[!this.state.isUserLoggedIn&&Object(n.jsx)(g,{onSuccessfulLogin:this.handleSuccessfulLogin}),this.state.isUserLoggedIn&&Object(n.jsxs)("div",{style:{display:"flex"},children:[Object(n.jsx)("div",{children:Object(n.jsxs)("p",{children:["Welcome, ",this.state.userDetails.givenName,"!"]})}),Object(n.jsx)("div",{style:{marginLeft:"5px"},children:Object(n.jsx)(k,{onSuccessfulLogout:this.handleSuccessfulLogout})})]})]}),Object(n.jsxs)("ul",{className:"header",children:[!this.state.isUserLoggedIn&&Object(n.jsx)("li",{children:Object(n.jsx)(d.b,{exact:!0,to:"/",children:"Home"})}),this.state.isUserLoggedIn&&Object(n.jsxs)("div",{children:[Object(n.jsx)("li",{children:Object(n.jsx)(d.b,{to:"/groups",children:"Groups"})}),Object(n.jsx)("li",{children:Object(n.jsx)(d.b,{to:"/project",children:"Project"})})]})]}),Object(n.jsxs)("div",{className:"content",children:[Object(n.jsx)(p.b,{exact:!0,path:"/",children:this.state.isUserLoggedIn?Object(n.jsx)(p.a,{to:e}):Object(n.jsx)(te,{})}),Object(n.jsx)(ke,{path:"/groups",component:de,authed:this.state.isUserLoggedIn}),Object(n.jsx)(ke,{exact:!0,path:["/project","/project/"],component:ee,authed:this.state.isUserLoggedIn}),Object(n.jsx)(ke,{path:"/project",component:X,authed:this.state.isUserLoggedIn}),Object(n.jsx)(ke,{path:"/jitsi",component:he,authed:this.state.isUserLoggedIn}),Object(n.jsx)(ke,{path:"/webaudio",component:be,authed:this.state.isUserLoggedIn})]})]})})}}]),a}(s.Component);a(145);o.a.render(Object(n.jsx)(ve,{}),document.getElementById("root"))}},[[146,1,2]]]);
//# sourceMappingURL=main.1a2ac97b.chunk.js.map