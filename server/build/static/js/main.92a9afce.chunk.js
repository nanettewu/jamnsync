(this.webpackJsonpjamnsync=this.webpackJsonpjamnsync||[]).push([[0],{123:function(e,t,n){},124:function(e,t,n){},129:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},137:function(e,t,n){},138:function(e,t,n){},159:function(e,t,n){},160:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(0),s=n(7),o=n.n(s),c=n(14),i=n(15),u=n(22),l=n(21),d=n(46),p=n(18),h=n(33),j=n(66),m=n(6),f=n.n(m),b=n(13);var g=function(e){return Object(a.jsx)("div",{children:Object(a.jsx)(j.GoogleLogin,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Login",onSuccess:function(t){!function(e){var t=1e3*(e.tokenObj.expires_in||3300),n=function(){var a=Object(b.a)(f.a.mark((function a(){var r;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.reloadAuthResponse();case 2:r=a.sent,t=1e3*(r.expires_in||3300),console.log("newAuthRes:",r),localStorage.setItem("authToken",r.id_token),setTimeout(n,t);case 7:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();setTimeout(n,t)}(t),e.onSuccessfulLogin(t)},onFailure:function(e){console.log("Attempt to login failed. Error:",e),alert("Error: "+e.error+". "+e.details)},cookiePolicy:"single_host_origin",style:{marginTop:"100px"},isSignedIn:!0})})};var O=function(e){return Object(a.jsx)("div",{children:Object(a.jsx)(j.GoogleLogout,{clientId:"248637884136-0bql8665umlks4j2t0nhvajgnb7lgfdh.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:function(){e.onSuccessfulLogout()}})})},k=n(12),x=n(34),v=(n(123),n(90),n(124),n(68)),y=n.n(v),T=(n(91),n(8)),S=n(183),w=n(189),_=n(187),R=n(190),D=n(51),L=n.n(D),M=n(79),C=n.n(M),I=n(78),P=n.n(I),F="+ Upload File",U="Rename Track",E="Delete Track",G=[F,U,E],A=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;if(Object(c.a)(this,n),(a=t.call(this,e)).stop=function(){a.audioFile.currentTime=0,a.audioFile.pause(),a.setState({playing:!1})},a.changeVolume=function(e){var t=e;console.log(e),a.audioFile.volume=a.props.masterVolume*t/80,a.setState({volume:t})},a.seek=function(e){a.audioFile.currentTime=e,a.audioFile.pause(),a.state.playing&&a.audioFile.play()},a.fastForward=function(){a.audioFile.pause();var e=a.audioFile.duration(),t=a.audioFile.currentTime,n=t+5;if(n>=e)return a.audioFile.currentTime=0,void a.audioFile.pause();console.log("ff: "+t+" -> "+n),a.audioFile.currentTime=n,a.state.playing&&a.audioFile.play()},a.rewind=function(){a.audioFile.pause();var e=a.audioFile.currentTime,t=e-5;t<=0&&(t=0),console.log("rewind: "+e+" -> "+t),a.audioFile.currentTime=t,a.state.playing&&a.audioFile.play()},a.mute=function(){a.audioFile.muted=!a.state.muted,a.setState({muted:!a.state.muted})},a.solo=function(){a.props.updateSoloTracks(a.props.trackId),a.state.soloing?a.setState({soloing:!1}):(a.audioFile.muted=!1,a.setState({soloing:!0,muted:!1}))},a.selectToRecord=function(){var e=a.state.selected?null:a.props.trackId;a.props.setSelectedTrack(e),a.setState({selected:!a.state.selected})},a._onSelect=function(e){console.log("Selected "+e.label),a.audioFile.currentTime=0,a.audioFile.pause();var t=a.props.takes[e.value].s3_info;a.setState({playing:!1,selectedTake:e.value,s3URL:t}),a.audioFile=document.getElementById("audio-file-".concat(a.props.trackId))},a.clickThreeDotsMenu=function(e){a.setState({threeDotsAnchorElement:e.currentTarget})},a.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===F?document.getElementById("file-upload-".concat(a.props.trackId)).click():t===U?a.props.renameTrack(a.props.trackId,a.props.trackName):t===E&&a.props.deleteTrack(a.props.trackId,a.props.trackName),a.setState({threeDotsAnchorElement:null})},a.state={selected:!1,playing:!1,muted:!1,s3URL:null,selectedTake:null,latestTake:0,soloing:!1,volume:84.95,threeDotsAnchorElement:null},a.audioFile=null,0!==Object.keys(e.takes).length){var r=Object.keys(e.takes).pop(),s=e.takes[r].s3_info;s&&(a.state.s3URL=s,a.state.selectedTake=r,a.audioFile=document.getElementById("audio-file-".concat(a.props.trackId)))}return a.deleteTake=a.deleteTake.bind(Object(k.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){if(0!==Object.keys(this.props.takes).length){var e=Object.keys(this.props.takes).pop(),t=this.props.takes[e].s3_info;t&&(this.setState({s3URL:t,selectedTake:e,latestTake:e}),this.audioFile=document.getElementById("audio-file-".concat(this.props.trackId)))}else this.setState({selectedTake:null,s3URL:null,latestTake:0})}},{key:"componentDidUpdate",value:function(e){if(this.state.s3URL&&null===this.audioFile?this.audioFile=document.getElementById("audio-file-".concat(this.props.trackId)):null===this.state.s3URL&&null!==this.audioFile&&(this.audioFile=null),this.state.selected&&this.props.selectedTrackId!==this.props.trackId&&this.setState({selected:!1}),null!==this.state.selectedTake&&this.state.latestTake===Object.keys(this.props.takes).pop()||0===Object.keys(this.props.takes).length)0===Object.keys(this.props.takes).length&&this.state.s3URL&&this.setState({selectedTake:null,s3URL:null,latestTake:0});else{var t=Object.keys(this.props.takes).pop(),n=this.props.takes[t].s3_info;n&&this.setState({latestTake:t,selectedTake:t,s3URL:n})}this.props.masterPlay&&this.audioFile&&!this.state.playing&&(!this.state.selected||this.state.selected&&!this.props.masterRecord)?(console.log("[".concat(this.props.trackName,"] playing 1: ").concat(this.state.s3URL)),this.audioFile.currentTime=0,this.audioFile.play(),this.setState({playing:!0})):this.props.masterStop&&this.audioFile&&this.state.playing&&(this.audioFile.pause(),this.setState({playing:!1})),this.state.soloing||0===this.props.soloTracks.length||this.state.muted||!this.state.s3URL?0===this.props.soloTracks.length&&this.state.muted&&this.state.s3URL&&0!==e.soloTracks.length&&(this.audioFile.muted=!1,this.setState({muted:!1})):(this.audioFile.muted=!0,this.setState({muted:!0})),this.state.s3URL&&e.masterVolume!==this.props.masterVolume&&(console.log(this.audioFile.volume),console.log(this.props.masterVolume),this.audioFile.volume=Math.min(1,this.props.masterVolume))}},{key:"componentWillUnmount",value:function(){this.audioFile&&this.audioFile.pause()}},{key:"deleteTake",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,n,a,r,s,o,c,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting take"),t=this.state.selectedTake,n=this.props.takes[t],a=-1!==n.date_uploaded.lastIndexOf(" ")?new Date(n.date_uploaded.substr(0,n.date_uploaded.lastIndexOf(" ")+1)):new Date(n.date_uploaded),r=a.toLocaleString("en-US"),s="Take ".concat(t," - ").concat(r),e.next=8,Object(T.a)('Are you sure you want to delete "'.concat(s,'"?'),"Delete Take");case 8:if(!e.sent){e.next=15;break}return this.audioFile&&(this.audioFile.currentTime=0,this.audioFile.pause()),e.next=13,this.props.deleteTake(this.props.trackId,t,n.id);case 13:o=null,Object.keys(this.props.takes).length>1?((c=Object.keys(this.props.takes)).splice(c.indexOf(t),1),o=Math.max.apply(Math,c),i=this.props.takes[o].s3_info,this.setState({playing:!1,selectedTake:o,s3URL:i,latestTake:o})):(console.log("unsetting audio file"),this.setState({playing:!1,selectedTake:o,s3URL:null,latestTake:0}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t={value:this.state.selectedTake},n=Object.keys(this.props.takes).reduce((function(n,a){if(parseInt(a)<=parseInt(e.state.latestTake)){var r=e.props.takes[a].date_uploaded,s=new Date(r).toLocaleString("en-US");a===e.state.selectedTake&&(t.label="Take ".concat(a," - ").concat(s)),n.push({value:a,label:"Take ".concat(a," - ").concat(s)})}return n}),[]).reverse();return Object(a.jsxs)("div",{style:{marginLeft:"5px"},children:[Object(a.jsx)("hr",{}),Object(a.jsxs)("div",{children:[this.state.selected?Object(a.jsxs)("div",{style:{display:"inline-block"},children:[Object(a.jsx)("img",{src:"images/daw/selected.png",alt:"selected",width:"10",height:"10"})," ",Object(a.jsxs)("b",{children:["Track: ",this.props.trackName]})," "]}):Object(a.jsxs)("div",{style:{display:"inline-block"},children:["Track: ",this.props.trackName," "]}),Object(a.jsx)("button",{title:"Select/unselect track for recording",onClick:this.selectToRecord,style:{marginLeft:"5px"},children:this.state.selected?"Unselect":"Select to Record"}),Object(a.jsx)(S.a,{"aria-label":"more","aria-controls":"track-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"5px"},children:Object(a.jsx)(L.a,{})}),Object(a.jsx)("input",{type:"file",id:"file-upload-".concat(this.props.trackId),hidden:!0,onChange:function(t){e.props.handleFileUpload(t.target.files,e.props.trackId)}}),Object(a.jsx)(_.a,{id:"track-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:G.map((function(t){return Object(a.jsx)(R.a,{onClick:e.closeThreeDotsMenu,children:t},t)}))})]}),this.state.s3URL&&Object.keys(this.props.takes).length>0&&Object(a.jsxs)("div",{style:{marginBottom:"20px"},children:[Object(a.jsx)(w.a,{title:"Mute",arrow:!0,children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Mute this track",onClick:this.mute,children:this.state.muted?Object(a.jsx)(P.a,{style:{fontSize:20},color:"secondary"}):Object(a.jsx)(P.a,{style:{fontSize:20}})})}),Object(a.jsx)(w.a,{title:"Solo",arrow:!0,children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Solo this track",onClick:this.solo,children:this.state.soloing?Object(a.jsx)(C.a,{style:{fontSize:20},color:"secondary"}):Object(a.jsx)(C.a,{style:{fontSize:20}})})}),Object(a.jsx)("audio",{id:"audio-file-".concat(this.props.trackId),src:this.state.s3URL,controls:!0,preload:"auto",autobuffer:"true"}),Object(a.jsx)("div",{style:{marginLeft:"10px",display:"inline-flex",width:310},children:Object(a.jsx)(y.a,{options:n,onChange:this._onSelect,value:t,placeholder:"Select an option"})}),Object(a.jsxs)("div",{style:{display:"inline-flex"},children:[Object(a.jsx)("form",{method:"get",action:this.state.s3URL,children:Object(a.jsx)("button",{type:"submit",children:"Download Take"})}),Object(a.jsx)("button",{onClick:this.deleteTake,children:"Delete Take"})]})]})]})}}]),n}(r.Component),B=n(103),N=n(10),V=(n(129),n(80)),z=n.n(V),J=n(81),W=n.n(J),Y=n(104),H=n.n(Y);function q(e){var t=new H.a,n=Object(T.g)(),s=Object(r.useState)(!1),o=Object(N.a)(s,2),c=o[0],i=o[1],u=Object(r.useState)(null),l=Object(N.a)(u,2),d=l[0],p=l[1],h=Object(r.useState)(null),j=Object(N.a)(h,2),m=j[0],f=j[1],b=Object(r.useState)(!1),g=Object(N.a)(b,2),O=g[0],k=g[1],v=Object(r.useState)(0),y=Object(N.a)(v,2),S=y[0],w=y[1],_=Object(r.useState)(0),R=Object(N.a)(_,2),D=R[0],L=R[1],M=Object(r.useCallback)((function(e,t){console.log("stopped:",t.x);var n=12.5053*t.x+7.3617;console.log(n),w(t.x),L(n)}),[]);return Object(r.useEffect)((function(){p(z.a.create({container:"#bg_waveform",waveColor:"#D9DCFF",progressColor:"#4353FF",cursorColor:"#4353FF",cursorWidth:1,height:200,width:1e3,interact:!1,hideScrollbar:!0})),f(z.a.create({container:"#rec_waveform",waveColor:"#D9DCFF",progressColor:"#4353FF",cursorColor:"#4353FF",cursorWidth:1,height:200,width:1e3,interact:!1,hideScrollbar:!0}))}),[]),Object(r.useEffect)((function(){d&&m&&n&&!n.isOpen&&(d.stop(),m.stop())}),[d,m,O,n]),Object(r.useEffect)((function(){if(d&&m&&!O){var n=Object.keys(e.trackMetadata).filter((function(t){return t!==e.recordedTrackId})).map((function(t){var n=Object.keys(e.trackMetadata[t].takes).pop();return e.trackMetadata[t].takes[n].s3_info}));console.log(n),t.fetchAudio.apply(t,Object(x.a)(n)).then((function(e){return t.mergeAudio(e)})).then((function(e){return t.export(e,"audio/mp3")})).then((function(t){d.load(t.url),m.load(e.recordedURL),d.setVolume(.3),m.setVolume(.2),d.zoom(80),m.zoom(80),k(!0)})),d.setVolume(.3),m.setVolume(.2),d.zoom(80),m.zoom(80),k(!0)}}),[d,m,O,t,e]),Object(a.jsxs)("div",{className:"outerDiv",children:[Object(a.jsx)(W.a,{axis:"x",bounds:{left:-285,right:285},children:Object(a.jsxs)("div",{className:"cursor",children:[Object(a.jsx)("div",{className:"point"}),Object(a.jsx)("div",{className:"startLine"})]})}),Object(a.jsxs)(T.d,{children:[Object(a.jsx)("p",{children:"Drag your recording left/right to align it, and move the red cursor as a ruler to align peaks in the waveforms!"}),Object(a.jsx)("p",{children:Object(a.jsx)("b",{children:"Backing"})}),Object(a.jsx)("div",{id:"bg_waveform"}),Object(a.jsx)("p",{children:Object(a.jsx)("b",{children:"Recording"})}),Object(a.jsx)(W.a,{axis:"x",onStop:M,children:Object(a.jsx)("div",{id:"rec_waveform",style:{marginLeft:"-240px"}})})]}),Object(a.jsxs)(T.e,{children:[Object(a.jsx)(T.c,{onClick:function(){if(console.log("offset:",S),d.params.scrollParent=!1,m.params.scrollParent=!1,d.seekTo(0),m.seekAndCenter(3/m.getDuration()),S>0)console.log("[recorded early]: user wants to playback later"),console.log(D),d.play(null,7),setTimeout((function(){m.play(3,10-D/1e3)}),D);else if(S<0){console.log("[recorded late]: user wants to playback earlier");var e=-D;console.log(e),d.play(null,7),m.play(3+e/1e3,10+e/1e3)}else d.play(null,7),m.play(3,10)},children:"Play"}),Object(a.jsx)(T.c,{onClick:function(){d.pause(),m.pause(),i(!c)},children:"Stop"}),Object(a.jsx)(T.c,{onClick:function(){d.stop(),m.stop(),console.log("returning value:",D),n.close(Math.round(D))},children:"Submit"})]})]})}var K=n(110),$=n(107),Q=n.n($),X=n(106),Z=n.n(X),ee=n(83),te=n.n(ee),ne=window.AudioContext||window.webkitAudioContext,ae=window.WebAudioRecorder,re=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).createTrack=function(){e.props.createTrack()},e.renameTrack=function(t,n){e.props.renameTrack(t,n)},e.deleteTrack=function(t,n){e.props.deleteTrack(t,n)&&e.setState({selectedTrackId:null})},e.createTake=function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.props.createTake(t,n,a,r)},e.deleteTake=function(t,n,a){e.props.deleteTake(t,n,a)},e.toggleMasterPlay=function(){console.log("> master play"),e.setState((function(t){var n=Date.now()-e.state.runningTime;return e.timer=setInterval((function(){e.setState({runningTime:Date.now()-n})})),{masterPlay:!0}}))},e.startMicrophone=function(){console.log("begin start recording"),e.audioContext=new ne,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){console.log("getUserMedia() success, stream created, initializing WebAudioRecorder..."),e.gumStream=t,e.input=e.audioContext.createMediaStreamSource(t),e.recorder=new ae(e.input,{workerDir:"js/",encoding:"mp3",numChannels:2}),e.recorder.setOptions({timeLimit:600,encodeAfterRecord:!0,mp3:{bitRate:320}}),e.recorder.onComplete=function(){var t=Object(b.a)(f.a.mark((function t(n,a){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("encoding complete"),e.gumStream.getAudioTracks()[0].stop(),t.next=4,e.stopMicrophone(a);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.recorder.startRecording()}))},e.handleFileUpload=function(t,n){if(console.log("handling file upload for target track id",n),null!==t&&null!==t[0]&&"undefined"!==typeof t[0])if(/\.(mp3|ogg|wav|flac|aac|aiff|m4a)$/i.test(t[0].name)){console.log("> validated file: ",t[0].name);e.createTake(n,t[0],!0)}else alert("Please upload valid audio file type (mp3, ogg, wav, flac, aac, aiff, m4a)")},e.setSelectedTrack=function(t){var n=null!==t?t:null;console.log("selecting track to record: "+n),e.setState({selectedTrackId:n})},e.formattedTime=function(e){var t=Math.floor(e/6e4),n=(e%6e4/1e3).toFixed(2);return t+":"+(n<10?"0":"")+n},e.updateSoloTracks=function(t){var n=Object(x.a)(e.state.soloTracks),a=n.indexOf(t);-1!==a?n.splice(a,1):n.push(t),console.log("new solo tracks:",n),e.setState({soloTracks:n})},e.changeVolume=function(t){e.setState({masterVolume:t/75})},e.rehearse=function(){console.log("currently rehearsing:",e.state.isRehearsing),e.setState({isRehearsing:!e.state.isRehearsing})},e.state={masterPlay:!1,masterStop:!1,masterRecord:!1,isRecording:!1,selectedTrackId:null,isBlocked:!0,showCountdown:!1,runningTime:0,soloTracks:[],masterVolume:.5,initialLoad:!0,isRehearsing:!1},e.audioContext=null,e.gumStream=null,e.input=null,e.recorder=null,e.toggleMasterRecord=e.toggleMasterRecord.bind(Object(k.a)(e)),e.toggleMasterStop=e.toggleMasterStop.bind(Object(k.a)(e)),e.stopMicrophone=e.stopMicrophone.bind(Object(k.a)(e)),e}return Object(i.a)(n,[{key:"componentDidUpdate",value:function(){this.state.initialLoad&&(0===Object.keys(this.props.trackMetadata).length&&this.createTrack(),this.setState({initialLoad:!1})),this.state.masterPlay&&this.state.masterStop&&this.setState({masterPlay:!1,masterStop:!1,runningTime:0})}},{key:"componentDidMount",value:function(){var e=this;console.log("reloading DAW"),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){console.log("mic permission granted"),e.setState({isBlocked:!1})})).catch((function(){console.log("MIC PERMISSIOM DENIED"),e.setState({isBlocked:!0})})),this.setState({isRecording:!1,masterRecord:!1,selectedTrackId:null,soloTracks:[]})}},{key:"toggleMasterStop",value:function(){var e=Object(b.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("> master stop"),this.state.masterPlay){e.next=3;break}return e.abrupt("return");case 3:clearInterval(this.timer),this.setState({masterStop:!0,runningTime:0}),this.state.isRecording&&(this.gumStream.getAudioTracks()[0].stop(),this.recorder.finishRecording());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleMasterRecord",value:function(){var e=Object(b.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("> master record"),null===this.state.selectedTrackId?alert("Select a track to record!"):(console.log("recording track "+this.state.selectedTrackId),this.startMicrophone(),this.setState((function(e){return{masterRecord:!0,showCountdown:!0,isRecording:!0}})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopMicrophone",value:function(){var e=Object(b.a)(f.a.mark((function e(t){var n,r,s,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("stopping microphone with blob",t),n=new File([t],"recording_track_".concat(this.state.selectedTrackId,".mp3")),r=URL.createObjectURL(n),s=-1,!(Object.keys(this.props.trackMetadata).length>1)){e.next=9;break}return e.next=7,Object(T.b)(Object(a.jsx)(q,{recordedURL:r,recordedTrackId:this.state.selectedTrackId,trackMetadata:this.props.trackMetadata}),{title:"Check Recording",showCloseIcon:!0});case 7:s=e.sent,console.log("latency:",s);case 9:o=1===Object.keys(this.props.trackMetadata).length,this.createTake(this.state.selectedTrackId,n,o,s),this.setState({isRecording:!1,masterRecord:!1});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{children:this.props.trackMetadata&&Object.keys(this.props.trackMetadata).length>0?Object.keys(this.props.trackMetadata).map((function(t){var n=e.props.trackMetadata[t];return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{children:Object(a.jsx)(A,{trackName:n.track_name,trackId:t,takes:n.takes,masterPlay:e.state.masterPlay,masterStop:e.state.masterStop,masterRecord:e.state.masterRecord,selectedTrackId:e.state.selectedTrackId,setSelectedTrack:e.setSelectedTrack,deleteTake:e.deleteTake,soloTracks:e.state.soloTracks,updateSoloTracks:e.updateSoloTracks,masterVolume:e.state.masterVolume,renameTrack:e.renameTrack,deleteTrack:e.deleteTrack,handleFileUpload:e.handleFileUpload})}),0===Object.keys(e.props.trackMetadata[t].takes).length&&Object(a.jsx)("div",{style:{marginTop:"-20px"},children:Object(a.jsx)("input",{style:{marginLeft:"20px",marginTop:"25px",marginBottom:"20px"},type:"file",onChange:function(n){return e.handleFileUpload(n.target.files,t)}})})]},"track_".concat(t))})):Object(a.jsx)("div",{style:{marginTop:"10px"}})}),Object(a.jsx)("button",{style:{marginTop:"10px",marginLeft:"5px",marginBottom:"20px"},className:"stitched",onClick:this.createTrack,children:"+ New Track"}),Object(a.jsx)("p",{style:{marginBottom:"5px"},children:Object(a.jsx)("b",{children:"Master Controls"})}),this.state.isBlocked&&Object(a.jsx)("p",{style:{marginBottom:"5px"},children:"Please allow access to your mic to record!"}),Object(a.jsx)(w.a,{title:"Record selected track",arrow:!0,children:Object(a.jsx)("span",{children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Record",onClick:this.toggleMasterRecord,disabled:this.state.masterPlay||this.state.isBlocked,children:this.state.masterPlay||this.state.isBlocked?Object(a.jsx)(te.a,{style:{fontSize:28}}):Object(a.jsx)(te.a,{style:{fontSize:28},color:"secondary"})})})}),Object(a.jsx)(w.a,{title:this.state.masterPlay?"Stop all tracks":"",arrow:!0,children:Object(a.jsx)("span",{children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Stop",onClick:this.toggleMasterStop,disabled:!this.state.masterPlay,children:Object(a.jsx)(Z.a,{style:{fontSize:35}})})})}),Object(a.jsx)(w.a,{title:"Play all tracks",arrow:!0,children:Object(a.jsx)("span",{children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Play",onClick:this.toggleMasterPlay,disabled:this.state.masterPlay||0===Object.keys(this.props.trackMetadata).length,style:{marginLeft:"-5px"},children:Object(a.jsx)(Q.a,{style:{fontSize:35}})})})})," ",Object(a.jsx)("button",{onClick:this.rehearse,children:this.state.isRehearsing?"Stop Rehearsing":"Start Rehearsing!"})," ",this.formattedTime(this.state.runningTime),Object(a.jsxs)("div",{style:{position:"absolute",marginLeft:"360px",marginTop:"-45px",width:"100px"},children:["Volume",Object(a.jsx)(K.a,{min:0,max:100,defaultValue:50,onChange:this.changeVolume})]}),this.state.showCountdown&&Object(a.jsxs)("div",{className:"timer",style:{position:"absolute",marginLeft:"480px",marginTop:"-110px"},children:[Object(a.jsx)(B.CountdownCircleTimer,{isPlaying:!0,duration:3,colors:[["#0f52bd",1]],size:90,onComplete:function(){var t=Date.now()-e.state.runningTime;e.timer=setInterval((function(){e.setState({runningTime:Date.now()-t})})),e.setState({showCountdown:!1,masterPlay:!0})},children:function(e){return e.remainingTime}}),Object(a.jsx)("button",{onClick:function(){e.setState({showCountdown:!1}),e.toggleMasterStop()},style:{marginTop:"10px",marginBottom:"10px"},children:"Ahh I'm not ready!"})]})]})}}]),n}(r.Component),se=n(53),oe=n.n(se),ce=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).retrieveProject=function(e){console.log("retrieving project: "+e),null!==e&&""!==e&&fetch("/api/project?"+new URLSearchParams({project_hash:e})).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){var n=t.body.tracks?t.body.tracks.reduce((function(e,t){var n=t.takes.reduce((function(e,t){return e[t.take]={date_uploaded:t.date_uploaded,id:t.id,s3_info:t.s3_info,track_id:t.track_id},e}),{});return e[t.id]={takes:n,track_name:t.track_name},e}),{}):{};200===t.status&&a.setState({project_hash:e,project_name:t.body.project_name,group_name:t.body.group.group_name,project_id:t.body.id,track_metadata:n})}))},a.refresh=function(){console.log("refreshing project"),a.retrieveProject(a.state.project_hash)},a.state={project_name:null,group_name:null,project_id:null,track_metadata:null,project_hash:e.location.pathname.split("/").pop()},"project"===a.state.project_hash&&(a.state.project_hash=null),a.createTrack=a.createTrack.bind(Object(k.a)(a)),a.deleteTrack=a.deleteTrack.bind(Object(k.a)(a)),a.renameTrack=a.renameTrack.bind(Object(k.a)(a)),a.createTake=a.createTake.bind(Object(k.a)(a)),a.deleteTake=a.deleteTake.bind(Object(k.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.retrieveProject(this.state.project_hash)}},{key:"componentDidUpdate",value:function(e){var t=this.props.location.pathname.split("/").pop();"project"!==t&&null!==t&&this.props.location.pathname!==e.location.pathname?this.retrieveProject(t):"project"===t&&null!==this.state.project_hash&&this.setState({project_hash:null,project_name:null,group_name:null,project_id:null,track_metadata:null})}},{key:"createTrack",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,n,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new track"),e.next=3,Object(T.f)("Name Your Track");case 3:(t=e.sent)&&((n=new FormData).append("track_name",t),n.append("project_id",this.state.project_id),fetch("/api/track",{method:"POST",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(400!==e.status){console.log("added new track");var n=Object.assign({},a.state.track_metadata);n[e.body.track_id]={id:parseInt(e.body.track_id),project_id:a.state.projectId,takes:{},track_name:t},a.setState({track_metadata:n})}})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renameTrack",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming track"),e.next=3,Object(T.f)("Rename Your Track",{defaultValue:n});case 3:(a=e.sent)&&((r=new FormData).append("track_id",t),r.append("new_name",a),fetch("/api/track",{method:"PUT",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object.assign({},s.state.track_metadata);n[t].track_name=a,s.setState({track_metadata:n})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteTrack",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.a)('Are you sure you want to delete "'.concat(n,'"?'),"Delete Track");case 2:return e.sent&&((a=new FormData).append("track_id",t),fetch("/api/track",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object.assign({},r.state.track_metadata);return delete n[t],r.setState({track_metadata:n}),!0}}))),e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createTake",value:function(e,t,n,a){var r=this;console.log("creating new take for",e);var s=new FormData;s.append("track_id",e),s.append("file",t),s.append("latency",a),s.append("tz_offset",(new Date).getTimezoneOffset()/60),s.append("is_aligned",n),fetch("/api/take",{method:"POST",body:s}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){if(400!==t.status){console.log("CREATED TAKE:",t);var n=Object.assign({},r.state.track_metadata);n[parseInt(e)].takes[parseInt(t.body.take)]={id:parseInt(t.body.take_id),track_id:parseInt(e),s3_info:t.body.s3_info,date_uploaded:new Date(t.body.timestamp).toString()},r.setState({track_metadata:n})}}))}},{key:"deleteTake",value:function(e,t,n){var a=this,r=new FormData;r.append("take_id",n),fetch("/api/take",{method:"DELETE",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(n){if(200===n.status){var r=Object.assign({},a.state.track_metadata);delete r[e].takes[t],a.setState({track_metadata:r})}}))}},{key:"render",value:function(){var e=this.props.location.pathname.split("/").pop();return null===this.state.project_name&&"project"!==e?Object(a.jsx)("div",{children:"Loading..."}):this.state.project_hash&&"project"!==e&&""!==e&&Object(a.jsxs)("div",{children:[Object(a.jsxs)("h2",{style:{marginBottom:"-20px"},children:[this.state.project_name,Object(a.jsx)(w.a,{title:"Refresh latest project info",arrow:!0,children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,children:Object(a.jsx)(oe.a,{style:{fontSize:30}})})})]}),Object(a.jsx)("div",{style:{marginTop:"20px"},children:Object(a.jsx)(re,{trackMetadata:this.state.track_metadata,retrieveProject:this.retrieveProject,createTrack:this.createTrack,deleteTrack:this.deleteTrack,renameTrack:this.renameTrack,createTake:this.createTake,deleteTake:this.deleteTake})})]})}}]),n}(r.Component);var ie=function(e){var t=Object(r.useState)(""),n=Object(N.a)(t,2),s=n[0],o=n[1];return Object(a.jsxs)("div",{children:[Object(a.jsx)("h2",{children:"Find a Project"}),Object(a.jsx)("br",{}),Object(a.jsxs)("form",{style:{marginLeft:10},children:[Object(a.jsx)("input",{style:{width:250},type:"text",value:s,onChange:function(e){e.preventDefault(),e.target.value.startsWith("http")?o(e.target.value.split("/").pop()):o(e.target.value)},placeholder:"Enter Project ID or URL"}),Object(a.jsx)("input",{type:"submit",hidden:!0}),Object(a.jsx)("button",{onClick:function(t){console.log("projectId",s),t.preventDefault(),fetch("/api/project?"+new URLSearchParams({project_hash:s})).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){console.log(t),200===t.status&&e.history.push("/project/".concat(s))})).catch((function(e){alert("Cannot find project ID or URL: "+s,e)}))},children:"Go!"})]})]})},ue=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)("h2",{children:"HOMEPAGE"}),this.props.authed?Object(a.jsxs)("p",{children:['Click on "Groups" to create a rehearsal group first, then "Projects" to create a project.'," "]}):Object(a.jsx)("p",{children:"Login to get started! \ud83c\udfb6"})]})}}]),n}(r.Component),le=n(35),de="Rename Project",pe="Delete Project",he=[de,pe];var je=function(e){var t=Object(p.f)(),n=Object(r.useState)(null),s=Object(N.a)(n,2),o=s[0],c=s[1],i=function(t){var n=t.target.innerText;n===de?e.renameProject(e.project.id,e.project.project_name):n===pe&&e.deleteProject(e.project.id,e.project.project_name),c(null)};return Object(a.jsxs)("li",{children:["Project: ",e.project.project_name," ",Object(a.jsx)("button",{onClick:function(){t.push({pathname:"/project/".concat(e.project.project_hash),state:{project:e.project,group_name:e.group_name,group_id:e.group_id}})},children:"Rehearse!"}),Object(a.jsx)(S.a,{"aria-label":"more","aria-controls":"project-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},style:{marginLeft:"5px"},children:Object(a.jsx)(L.a,{})}),Object(a.jsx)(_.a,{id:"project-menu",anchorEl:o,keepMounted:!0,open:null!==o,onClose:i,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:he.map((function(e){return Object(a.jsx)(R.a,{onClick:i,children:e},e)}))})]})},me=(n(135),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).clickThreeDotsMenu=function(e){a.setState({threeDotsAnchorElement:e.currentTarget})},a.closeThreeDotsMenu=function(e){var t=e.target.innerText;"Rename Group"===t?a.props.renameGroup(a.props.id,a.props.name):"Delete Group"===t&&a.props.deleteGroup(a.props.id,a.props.name),a.setState({threeDotsAnchorElement:null})},a.state={projects:e.projects,threeDotsAnchorElement:null},a.createNewProject=a.createNewProject.bind(Object(k.a)(a)),a.deleteProject=a.deleteProject.bind(Object(k.a)(a)),a.renameProject=a.renameProject.bind(Object(k.a)(a)),a}return Object(i.a)(n,[{key:"componentDidUpdate",value:function(e){this.props.projects!==e.projects&&this.setState({projects:this.props.projects})}},{key:"createNewProject",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,n,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.f)("Name Your Project");case 2:(t=e.sent)&&((n=new FormData).append("project_name",t),n.append("group_id",this.props.id),fetch("/api/project",{method:"POST",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&a.setState({projects:a.state.projects.concat([{project_name:t,id:e.body.project_id,project_hash:e.body.project_hash}])})})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteProject",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.a)('Are you sure you want to delete "'.concat(n,'"?'),"Delete Project");case 2:e.sent&&((a=new FormData).append("project_id",t),fetch("/api/project",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object(x.a)(r.state.projects).filter((function(e){return e.id!==t}));r.setState({projects:n})}})));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renameProject",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.f)("Rename Your Project",{defaultValue:n});case 2:(a=e.sent)&&((r=new FormData).append("project_id",t),r.append("new_name",a),fetch("/api/project",{method:"PUT",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object(x.a)(s.state.projects).map((function(e){return e.id===t?Object(le.a)(Object(le.a)({},e),{},{project_name:a}):e}));s.setState({projects:n})}})));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.projects.sort((function(e,t){return e.id>t.id?1:-1}));return Object(a.jsxs)("div",{style:{marginTop:"25px",marginBottom:"-10px"},children:[Object(a.jsxs)("p",{children:["Group: ",this.props.name,"  ",Object(a.jsx)("button",{onClick:this.createNewProject,children:"+ Project"})]}),Object(a.jsx)("div",{style:{marginTop:"20px"},children:Object(a.jsxs)("ul",{children:[this.state.projects&&0===this.state.projects.length&&Object(a.jsx)("p",{className:"text-muted",style:{marginTop:"-10px",marginBottom:"20px"},children:"No projects created yet!"}),t.map((function(t,n){return Object(a.jsx)("div",{children:Object(a.jsx)("div",{style:{marginTop:"-20px",marginBottom:"-10px"},children:Object(a.jsx)(je,{project:t,group_name:e.props.name,group_id:e.props.id,renameProject:e.renameProject,deleteProject:e.deleteProject})})},"project_".concat(n))}))]})})]})}}]),n}(r.Component)),fe=(n(136),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).fetchGroups=function(){fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status&&e.setState({groups:t.body,isLoaded:!0})}))},e.refresh=function(){console.log("refreshing"),e.fetchGroups()},e.state={groups:[],isLoaded:!1},e.fetchGroups(),e.createNewGroup=e.createNewGroup.bind(Object(k.a)(e)),e.deleteGroup=e.deleteGroup.bind(Object(k.a)(e)),e.renameGroup=e.renameGroup.bind(Object(k.a)(e)),e}return Object(i.a)(n,[{key:"createNewGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,n,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new group!"),e.next=3,Object(T.f)("Name Your Group");case 3:(t=e.sent)&&((n=new FormData).append("group_name",t),fetch("/api/group",{method:"POST",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&a.setState({groups:a.state.groups.concat([{group_name:t,id:e.body.group_id,projects:[]}])})})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting group"),e.next=3,Object(T.a)('Are you sure you want to delete "'.concat(n,'"?'),"Delete Group");case 3:e.sent&&((a=new FormData).append("group_id",t),fetch("/api/group",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object(x.a)(r.state.groups).filter((function(e){return e.id!==t}));r.setState({groups:n})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renameGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming group"),e.next=3,Object(T.f)("Rename Your Group",{defaultValue:n});case 3:(a=e.sent)&&((r=new FormData).append("new_name",a),r.append("group_id",t),fetch("/api/group",{method:"PUT",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object(x.a)(s.state.groups).map((function(e){return e.id===t?Object(le.a)(Object(le.a)({},e),{},{group_name:a}):e}));s.setState({groups:n})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.isLoaded?Object(a.jsxs)("div",{style:{marginBottom:"10px"},children:[Object(a.jsxs)("h2",{style:{marginBottom:"-25px"},children:["PROJECTS",Object(a.jsx)(w.a,{title:"Refresh latest project info",arrow:!0,children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,children:Object(a.jsx)(oe.a,{style:{fontSize:30}})})})]}),this.state.groups&&0===this.state.groups.length&&Object(a.jsx)("p",{style:{marginTop:"20px"},class:"text-muted",children:"Create a group first!"}),this.state.groups&&this.state.groups.map((function(t,n){return Object(a.jsx)("div",{children:Object(a.jsx)(me,{id:t.id,name:t.group_name,projects:t.projects,renameGroup:e.renameGroup,deleteGroup:e.deleteGroup})},"group_".concat(n))}))]}):Object(a.jsx)("div",{children:"Loading..."})}}]),n}(r.Component)),be=(n(137),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).removeMember=function(){a.props.removeMember(a.props.id)},a}return Object(i.a)(n,[{key:"render",value:function(){var e=!this.props.onlyMemberInGroup;return Object(a.jsx)("div",{children:Object(a.jsxs)("li",{children:["Member: ",this.props.name," ",e&&Object(a.jsx)("button",{onClick:this.removeMember,children:"Remove"})]})})}}]),n}(r.Component));n(138);function ge(e){var t=Object(T.g)(),n=Object(r.useState)(null),s=Object(N.a)(n,2),o=s[0],c=s[1],i=Object(r.useState)(null),u=Object(N.a)(i,2),l=u[0],d=u[1],p=Object.keys(e.users).reduce((function(t,n){return t.push({value:n,label:e.users[n]}),t}),[]);return Object(a.jsxs)("div",{children:[Object(a.jsxs)(T.d,{children:[Object(a.jsx)("p",{children:"The dropdown lists all members on JamNSync:"}),Object(a.jsx)("div",{style:{height:250,width:300},children:Object(a.jsx)(y.a,{options:p,onChange:function(e){console.log("Selected "+e.label),c(e.value),d(e.label)},placeholder:"Select a name"})})]}),Object(a.jsxs)(T.e,{children:[Object(a.jsx)(T.c,{onClick:function(){t.close([o,l])},children:"OK"}),Object(a.jsx)(T.c,{onClick:function(){t.close([o,l])},type:"light",children:"Cancel"})]})]})}var Oe="Rename Group",ke="Delete Group",xe=[Oe,ke],ve=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).clickThreeDotsMenu=function(e){a.setState({threeDotsAnchorElement:e.currentTarget})},a.closeThreeDotsMenu=function(e){var t=e.target.innerText;t===Oe?a.props.renameGroup(a.props.id,a.props.name):t===ke&&a.props.deleteGroup(a.props.id,a.props.name),a.setState({threeDotsAnchorElement:null})},a.state={group_membership:{},threeDotsAnchorElement:null},fetch("/api/group/members?group_id="+a.props.id,{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&a.setState({group_membership:e.body})})),a.addMember=a.addMember.bind(Object(k.a)(a)),a.removeMember=a.removeMember.bind(Object(k.a)(a)),a}return Object(i.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.refresh!==e.refresh&&fetch("/api/group/members?group_id="+this.props.id,{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&t.setState({group_membership:e.body})}))}},{key:"addMember",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,n,r,s,o,c,i=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("adding member"),e.next=3,fetch("/api/users",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){return console.log(e),e.body}));case 3:return t=e.sent,console.log(t),e.next=7,Object(T.b)(Object(a.jsx)(ge,{users:t}),{title:"Add Member to "+this.props.name,showCloseIcon:!0});case 7:n=e.sent,r=Object(N.a)(n,2),s=r[0],o=r[1],s&&o&&((c=new FormData).append("group_id",this.props.id),c.append("user_id",s),fetch("/api/group/members",{method:"POST",body:c}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var t=Object.assign({},i.state.group_membership);t[s]=o,i.setState({group_membership:t})}})));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(b.a)(f.a.mark((function e(t){var n,a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("removing member id:",t),n=this.state.group_membership[t],e.next=4,Object(T.a)('Are you sure you want to remove "'.concat(n,'" from "').concat(this.props.name,'"?'),"Remove Member");case 4:e.sent&&((a=new FormData).append("group_id",this.props.id),a.append("user_id",t),fetch("/api/group/members",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object.assign({},r.state.group_membership);delete n[t],r.setState({group_membership:n})}})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{style:{marginBottom:"-10px"},children:[Object(a.jsxs)("p",{style:{marginTop:"20px",marginBottom:"-20px"},children:["Group: ",this.props.name,"  ",Object(a.jsx)("button",{onClick:this.addMember,children:"+ Member"}),Object(a.jsx)(S.a,{"aria-label":"more","aria-controls":"group-menu","aria-haspopup":"true",onClick:this.clickThreeDotsMenu,style:{marginLeft:"5px"},children:Object(a.jsx)(L.a,{})}),Object(a.jsx)(_.a,{id:"group-menu",anchorEl:this.state.threeDotsAnchorElement,keepMounted:!0,open:null!==this.state.threeDotsAnchorElement,onClose:this.closeThreeDotsMenu,PaperProps:{style:{maxHeight:180,width:"20ch"}},children:xe.map((function(t){return Object(a.jsx)(R.a,{onClick:e.closeThreeDotsMenu,children:t},t)}))})]}),Object(a.jsx)("ul",{children:Object.keys(this.state.group_membership).map((function(t){var n=e.state.group_membership[t];return Object(a.jsx)("div",{children:Object(a.jsx)("div",{children:Object(a.jsx)(be,{id:t,name:n,removeMember:e.removeMember,onlyMemberInGroup:1===Object.keys(e.state.group_membership).length})})},"member_".concat(t))}))})]})}}]),n}(r.Component),ye=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).fetchGroups=function(){fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status&&e.setState({groups:t.body,isLoaded:!0})}))},e.refresh=function(){console.log("refreshing groups"),fetch("/api/groups",{method:"GET"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(t){400!==t.status?e.setState({groups:t.body,isLoaded:!0,refresh:e.state.refresh+1}):e.setState({refresh:e.state.refresh+1})}))},e.state={groups:[],isLoaded:!1,refresh:0},e.fetchGroups(),e.createNewGroup=e.createNewGroup.bind(Object(k.a)(e)),e.deleteGroup=e.deleteGroup.bind(Object(k.a)(e)),e.renameGroup=e.renameGroup.bind(Object(k.a)(e)),e}return Object(i.a)(n,[{key:"createNewGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(){var t,n,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating new group!"),e.next=3,Object(T.f)("Name Your Group");case 3:(t=e.sent)&&((n=new FormData).append("group_name",t),fetch("/api/group",{method:"POST",body:n}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){400!==e.status&&a.setState({groups:a.state.groups.concat([{group_name:t,id:e.body.group_id,projects:[]}])})})).catch((function(e){alert('Server Error: Group name taken, use a different name instead of "'+t+'"!')})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting group"),e.next=3,Object(T.a)('Are you sure you want to delete "'.concat(n,'"?'),"Delete Group");case 3:e.sent&&((a=new FormData).append("group_id",t),fetch("/api/group",{method:"DELETE",body:a}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object(x.a)(r.state.groups).filter((function(e){return e.id!==t}));r.setState({groups:n})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renameGroup",value:function(){var e=Object(b.a)(f.a.mark((function e(t,n){var a,r,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renaming group"),e.next=3,Object(T.f)("Rename Your Group",{defaultValue:n});case 3:(a=e.sent)&&((r=new FormData).append("new_name",a),r.append("group_id",t),fetch("/api/group",{method:"PUT",body:r}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))})).then((function(e){if(200===e.status){var n=Object(x.a)(s.state.groups).map((function(e){return e.id===t?Object(le.a)(Object(le.a)({},e),{},{group_name:a}):e}));s.setState({groups:n})}})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.isLoaded?Object(a.jsxs)("div",{children:[Object(a.jsxs)("h2",{style:{marginBottom:"-30px"},children:["REHEARSAL GROUPS",Object(a.jsx)(w.a,{title:"Refresh latest group info",arrow:!0,children:Object(a.jsx)(S.a,{disableRipple:!0,"aria-label":"Sync",onClick:this.refresh,children:Object(a.jsx)(oe.a,{style:{fontSize:30}})})})]}),this.state.groups&&this.state.groups.map((function(t,n){return Object(a.jsx)("div",{children:Object(a.jsx)(ve,{id:t.id,name:t.group_name,projects:t.projects,renameGroup:e.renameGroup,deleteGroup:e.deleteGroup,refresh:e.state.refresh})},"group_".concat(n))})),Object(a.jsx)("button",{style:{marginTop:"30px"},className:"stitched",onClick:this.createNewGroup,children:"+ New Rehearsal Group"})]}):Object(a.jsx)("div",{children:"Loading..."})}}]),n}(r.Component),Te=n(108),Se=function(){var e=Object(r.useState)(""),t=Object(N.a)(e,2),n=t[0],s=t[1],o=Object(r.useState)(""),c=Object(N.a)(o,2),i=c[0],u=c[1],l=Object(r.useState)(""),d=Object(N.a)(l,2),p=d[0],h=d[1],j=Object(r.useState)(!1),m=Object(N.a)(j,2),f=m[0],b=m[1];return Object(a.jsxs)("div",{children:[Object(a.jsx)("h2",{children:"Jitsi"}),Object(a.jsx)("br",{}),f?Object(a.jsx)(Te.a,{containerStyles:{width:"800px",height:"400px"},roomName:i,displayName:n,password:p,onMeetingEnd:function(){return console.log("Meeting has ended")},loadingComponent:Object(a.jsx)("p",{children:"Loading ..."}),errorComponent:Object(a.jsx)("p",{children:"Oops, something went wrong"})}):Object(a.jsxs)("form",{children:[Object(a.jsx)("p",{children:"Create a Room"}),Object(a.jsx)("input",{id:"room",type:"text",placeholder:"Room Name",value:i,onChange:function(e){return u(e.target.value)}}),Object(a.jsx)("input",{id:"name",type:"text",placeholder:"Name",value:n,onChange:function(e){return s(e.target.value)}}),Object(a.jsx)("input",{id:"password",type:"text",placeholder:"Password (optional)",value:p,onChange:function(e){return h(e.target.value)}}),Object(a.jsx)("button",{onClick:function(e){e.preventDefault(),i&&n&&b(!0)},type:"submit",children:"Start / Join"})]})]})},we=n(109),_e=function(){function e(t){Object(c.a)(this,e),this.config={sampleRate:44100,bitRate:128},Object.assign(this.config,t),this.mp3Encoder=new we.Mp3Encoder(1,this.config.sampleRate,this.config.bitRate),this.maxSamples=1152,this.samplesMono=null,this.clearBuffer()}return Object(i.a)(e,[{key:"clearBuffer",value:function(){this.dataBuffer=[]}},{key:"appendToBuffer",value:function(e){this.dataBuffer.push(new Int8Array(e))}},{key:"floatTo16BitPCM",value:function(e,t){for(var n=0;n<e.length;n++){var a=Math.max(-1,Math.min(1,e[n]));t[n]=a<0?32768*a:32767*a}}},{key:"convertBuffer",value:function(e){var t=new Float32Array(e),n=new Int16Array(e.length);return this.floatTo16BitPCM(t,n),n}},{key:"encode",value:function(e){this.samplesMono=this.convertBuffer(e);for(var t=this.samplesMono.length,n=0;t>=0;n+=this.maxSamples){var a=this.samplesMono.subarray(n,n+this.maxSamples),r=this.mp3Encoder.encodeBuffer(a);this.appendToBuffer(r),t-=this.maxSamples}}},{key:"finish",value:function(){return this.appendToBuffer(this.mp3Encoder.flush()),this.dataBuffer}}]),e}(),Re=new(function(){function e(t){Object(c.a)(this,e),this.getMediaStream=function(){},this.mediaRecorder=null,this.mediaChunks=[],this.mediaStream=null}return Object(i.a)(e,[{key:"componentDidMount",value:function(){}},{key:"addMicrophoneListener",value:function(e){var t=this;this.activeStream=e,this.microphone=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(0,1,1),this.processor.onaudioprocess=function(e){t.lameEncoder.encode(e.inputBuffer.getChannelData(0))},this.microphone.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"stop",value:function(){return this.processor&&this.microphone&&(this.microphone.disconnect(),this.processor.disconnect(),this.context&&"closed"!==this.context.state&&this.context.close(),this.processor.onaudioprocess=null,this.activeStream.getAudioTracks().forEach((function(e){return e.stop()}))),this}},{key:"start",value:function(){var e=this;this.context=new AudioContext,this.config.sampleRate=this.context.sampleRate,this.lameEncoder=new _e(this.config);var t=!this.config.deviceId||{deviceId:{exact:this.config.deviceId}};navigator.mediaDevices.getUserMedia({audio:t}).then((function(t){e.addMicrophoneListener(t)}))}},{key:"getMp3",value:function(){var e=this,t=this.lameEncoder.finish();return new Promise((function(n,a){0===t.length?a(new Error("No buffer to send")):(n([t,new Blob(t,{type:"audio/mp3"})]),e.lameEncoder.clearBuffer())}))}}]),e}())({bitRate:128}),De=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).handleRecord=function(){console.log("recording now"),Re.start(),e.setState({recording:!0})},e.handleStopRecord=function(){console.log("stopped now"),Re.stop().getMp3().then((function(t){var n=Object(N.a)(t,2),a=(n[0],n[1]),r=URL.createObjectURL(a);console.log(r);var s=e.state.recordings.concat([r]);e.setState({recording:!1,recordings:s})})).catch((function(e){return console.log(e)}))},e.convertBuffer=function(){},e.state={recording:!1,recordings:[]},e}return Object(i.a)(n,[{key:"saveAudio",value:function(){var e=new Blob(this.chunks,{type:"audio/mp3"});console.log(e);var t=URL.createObjectURL(e);console.log(t);var n=this.state.recordings.concat([t]);this.setState({recordings:n})}},{key:"deleteRecording",value:function(e){var t=this.state.recordings.filter((function(t){return t!==e}));this.setState({recordings:t})}},{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("p",{children:"test mic with web audio"}),Object(a.jsx)("button",{disabled:this.state.recording,onClick:this.handleRecord,children:"record"}),Object(a.jsx)("button",{disabled:!this.state.recording,onClick:this.handleStopRecord,children:"stop"})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("p",{children:"Recordings:"}),this.state.recordings.map((function(t,n){return Object(a.jsxs)("div",{children:[Object(a.jsx)("audio",{controls:!0,style:{width:300},src:t}),Object(a.jsx)("div",{children:Object(a.jsx)("button",{onClick:function(){return e.deleteRecording(t)},children:"Delete"})})]},"recording_".concat(n))}))]})]})}}]),n}(r.Component),Le=n(111);var Me=function(e){var t=e.component,n=e.authed,r=Object(Le.a)(e,["component","authed"]);return Object(a.jsx)(p.b,Object(le.a)(Object(le.a)({},r),{},{render:function(e){return!0===n?Object(a.jsx)(t,Object(le.a)({},e)):Object(a.jsx)(p.a,{to:{pathname:"/",state:{from:e.location}}})}}))},Ce=Object(h.b)(),Ie=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).handleSuccessfulLogin=function(t){var n=t.profileObj,a=new FormData;a.append("google_auth_id",n.googleId),a.append("google_email",n.email),a.append("user_name",n.name),fetch("/auth/login",{method:"POST",body:a}).then((function(e){return e.json()})).then((function(t){console.log(t.message),localStorage.setItem("userDetails",JSON.stringify(n)),localStorage.setItem("isUserLoggedIn",!0),e.setState({userDetails:n,isUserLoggedIn:!0})}))},e.handleSuccessfulLogout=function(){fetch("/auth/logout",{method:"POST"}).then((function(e){return e.json()})).then((function(t){console.log(t.message),localStorage.clear(),e.setState({userDetails:{},isUserLoggedIn:!1})}))},e.state={userDetails:{},isUserLoggedIn:!1},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){"/"===Ce.location.pathname&&Ce.replace("/home");var e=JSON.parse(localStorage.getItem("userDetails")),t="true"===localStorage.getItem("isUserLoggedIn");t&&!this.state.isUserLoggedIn&&this.setState({userDetails:e,isUserLoggedIn:t})}},{key:"componentDidUpdate",value:function(e){!this.state.isUserLoggedIn&&e.isUserLoggedIn&&"/"===Ce.location.pathname&&Ce.replace("/home")}},{key:"render",value:function(){var e=Ce.location.pathname;return Object(a.jsx)(d.a,{history:Ce,children:Object(a.jsxs)("div",{children:[Object(a.jsx)("h1",{children:"JamNSync"}),Object(a.jsxs)("div",{style:{position:"absolute",right:20,top:35},children:[!this.state.isUserLoggedIn&&Object(a.jsx)(g,{onSuccessfulLogin:this.handleSuccessfulLogin}),this.state.isUserLoggedIn&&Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)("div",{children:Object(a.jsxs)("p",{children:["Welcome, ",this.state.userDetails.givenName,"!"]})}),Object(a.jsx)("div",{style:{marginLeft:"5px"},children:Object(a.jsx)(O,{onSuccessfulLogout:this.handleSuccessfulLogout})})]})]}),Object(a.jsxs)("ul",{className:"header",children:[Object(a.jsx)("li",{children:Object(a.jsx)(d.b,{to:"/home",children:"Home"})}),this.state.isUserLoggedIn&&Object(a.jsx)("li",{children:Object(a.jsx)(d.b,{to:"/groups",children:"Groups"})}),this.state.isUserLoggedIn&&Object(a.jsx)("li",{children:Object(a.jsx)(d.b,{to:"/projects",children:"Projects"})})]}),Object(a.jsxs)("div",{className:"content",children:[Object(a.jsx)(p.b,{exact:!0,path:"/",children:this.state.isUserLoggedIn&&"/"!==e?Object(a.jsx)(p.a,{to:e}):Object(a.jsx)(ue,{authed:this.state.isUserLoggedIn})}),Object(a.jsx)(p.b,{path:"/home",children:Object(a.jsx)(ue,{authed:this.state.isUserLoggedIn})}),Object(a.jsx)(Me,{path:"/projects",component:fe,authed:this.state.isUserLoggedIn}),Object(a.jsx)(Me,{path:"/groups",component:ye,authed:this.state.isUserLoggedIn}),Object(a.jsx)(Me,{exact:!0,path:"/project",component:ie,authed:this.state.isUserLoggedIn}),Object(a.jsx)(Me,{path:"/project/",component:ce,authed:this.state.isUserLoggedIn}),Object(a.jsx)(Me,{path:"/jitsi",component:Se,authed:this.state.isUserLoggedIn}),Object(a.jsx)(Me,{path:"/webaudio",component:De,authed:this.state.isUserLoggedIn})]})]})})}}]),n}(r.Component);n(159);o.a.render(Object(a.jsx)(Ie,{}),document.getElementById("root"))}},[[160,1,2]]]);
//# sourceMappingURL=main.92a9afce.chunk.js.map